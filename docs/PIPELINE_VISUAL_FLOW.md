# ğŸ“Š Pipeline Visual Flow - Drag & Drop con Visibilidad Completa

## ğŸ¨ Interfaz Visual - Context Management Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Context Management                                                    [X]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚                                             â”‚
â”‚  ğŸ“¤ DRAG & DROP ZONE        â”‚  ğŸ“‹ SOURCE DETAILS                          â”‚
â”‚                             â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  documento.pdf                              â”‚
â”‚  â”‚     ğŸ“¤              â”‚    â”‚  Status: active                             â”‚
â”‚  â”‚                     â”‚    â”‚                                             â”‚
â”‚  â”‚  Arrastra PDFs aquÃ­ â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  â”‚   o haz click       â”‚    â”‚                                             â”‚
â”‚  â”‚                     â”‚    â”‚  ğŸ“Š Pipeline de Procesamiento               â”‚
â”‚  â”‚ MÃºltiples archivos  â”‚    â”‚                                             â”‚
â”‚  â”‚ Extractâ†’Chunkâ†’Embed â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     â”‚    â”‚  â”‚  âœ…  ğŸ“¤ Upload                       â”‚   â”‚
â”‚  â”‚  âš¡ Flash â€¢ Auto    â”‚    â”‚  â”‚      Archivo guardado               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚      â€¢ 2.5 MB                       â”‚   â”‚
â”‚                             â”‚  â”‚      â€¢ â±ï¸  1.2s                      â”‚   â”‚
â”‚  ğŸ“¥ UPLOAD QUEUE            â”‚  â”‚  â”ƒ                                   â”‚   â”‚
â”‚                             â”‚  â”‚  âœ…  ğŸ“„ Extract Text                 â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚      12,543 caracteres extraÃ­dos   â”‚   â”‚
â”‚  â”‚ ğŸ“„ doc1.pdf         â”‚    â”‚  â”‚      â€¢ Flash                        â”‚   â”‚
â”‚  â”‚ Extracting... 45%   â”‚    â”‚  â”‚      â€¢ 45,231 â†’ 3,456 tokens       â”‚   â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘      â”‚    â”‚  â”‚      â€¢ $0.000234                   â”‚   â”‚
â”‚  â”‚ âš¡ Flash            â”‚    â”‚  â”‚      â€¢ â±ï¸  8.7s                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”ƒ                                   â”‚   â”‚
â”‚                             â”‚  â”‚  âœ…  ğŸ”² Chunk Document               â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚      23 chunks creados             â”‚   â”‚
â”‚  â”‚ ğŸ“„ doc2.pdf         â”‚    â”‚  â”‚      â€¢ Promedio: 512 tokens        â”‚   â”‚
â”‚  â”‚ Queued              â”‚    â”‚  â”‚      â€¢ â±ï¸  0.3s                      â”‚   â”‚
â”‚  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘      â”‚    â”‚  â”‚  â”ƒ                                   â”‚   â”‚
â”‚  â”‚ âš¡ Flash            â”‚    â”‚  â”‚  âœ…  âš¡ Generate Embeddings          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚      23 embeddings generados       â”‚   â”‚
â”‚                             â”‚  â”‚      â€¢ embedding-001                â”‚   â”‚
â”‚  ALL SOURCES (12)           â”‚  â”‚      â€¢ â±ï¸  3.2s                      â”‚   â”‚
â”‚                             â”‚  â”‚  â”ƒ                                   â”‚   â”‚
â”‚  â˜‘ doc1.pdf âœ“              â”‚  â”‚  âœ…  âœ“ Complete                      â”‚   â”‚
â”‚  â˜‘ doc2.pdf                â”‚  â”‚      Pipeline completado            â”‚   â”‚
â”‚  â˜ manual.pdf              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â˜ contrato.pdf            â”‚  â”‚                                             â”‚
â”‚  ...                        â”‚  â”‚  âœ… Pipeline Completo                      â”‚
â”‚                             â”‚  â”‚  Tiempo total: 13.4s                       â”‚
â”‚                             â”‚  â”‚  Costo total: $0.000234                    â”‚
â”‚                             â”‚  â”‚                                             â”‚
â”‚                             â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                             â”‚  â”‚                                             â”‚
â”‚                             â”‚  â”‚  Asignar a Agentes (3 selected)            â”‚
â”‚                             â”‚  â”‚  â˜‘ Agent 1                                 â”‚
â”‚                             â”‚  â”‚  â˜‘ Agent 2                                 â”‚
â”‚                             â”‚  â”‚  â˜ Agent 3                                 â”‚
â”‚                             â”‚  â”‚                                             â”‚
â”‚                             â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                             â”‚  â”‚                                             â”‚
â”‚                             â”‚  â”‚  ğŸ“„ Extracted Data Preview                 â”‚
â”‚                             â”‚  â”‚  [texto extraÃ­do aquÃ­...]                  â”‚
â”‚                             â”‚  â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo TÃ©cnico Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TECHNICAL FLOW                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Frontend: ContextManagementDashboard.tsx                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚                                                                          â”‚
â”‚  1. User drags PDF â†’ Drag & Drop Zone                                   â”‚
â”‚     â”œâ”€ onDragOver: setIsDragging(true)                                  â”‚
â”‚     â”œâ”€ Visual: zona azul, scale-105, shadow-lg                          â”‚
â”‚     â””â”€ onDrop: handleFileSelect(files)                                  â”‚
â”‚                                                                          â”‚
â”‚  2. Staging Area                                                         â”‚
â”‚     â”œâ”€ Preview de archivos                                              â”‚
â”‚     â”œâ”€ Tags (opcional)                                                   â”‚
â”‚     â”œâ”€ Modelo (Flash/Pro)                                               â”‚
â”‚     â””â”€ Confirmar â†’ processQueue()                                       â”‚
â”‚                                                                          â”‚
â”‚  3. processQueue() - Per File                                           â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ Progress: 0% â†’ "Queued"                                          â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ POST /api/extract-document                                       â”‚
â”‚     â”‚  â”œâ”€ FormData: { file, userId, model }                             â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Backend: extract-document.ts                                  â”‚
â”‚     â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 1: Upload to Cloud Storage                               â”‚
â”‚     â”‚  â”‚  â”œâ”€ uploadFile(buffer, name, type)                             â”‚
â”‚     â”‚  â”‚  â”œâ”€ Log: { step: 'upload', status: 'in_progress' }             â”‚
â”‚     â”‚  â”‚  â”œâ”€ Save to gs://...                                           â”‚
â”‚     â”‚  â”‚  â”œâ”€ Duration: ~1.2s                                            â”‚
â”‚     â”‚  â”‚  â””â”€ Log: { status: 'success', details: { fileSize, path } }   â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 2: Extract with Gemini                                   â”‚
â”‚     â”‚  â”‚  â”œâ”€ Log: { step: 'extract', status: 'in_progress' }            â”‚
â”‚     â”‚  â”‚  â”œâ”€ genAI.models.generateContent({ model, contents })          â”‚
â”‚     â”‚  â”‚  â”œâ”€ Prompt: Extrae TODO con mÃ¡xima fidelidad                  â”‚
â”‚     â”‚  â”‚  â”œâ”€ Duration: ~8.7s                                            â”‚
â”‚     â”‚  â”‚  â”œâ”€ Calculate tokens & cost                                    â”‚
â”‚     â”‚  â”‚  â””â”€ Log: { status: 'success', details: {                       â”‚
â”‚     â”‚  â”‚       model, inputTokens, outputTokens, cost                   â”‚
â”‚     â”‚  â”‚     }}                                                          â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â””â”€ Response: {                                                   â”‚
â”‚     â”‚       success: true,                                              â”‚
â”‚     â”‚       extractedText: "...",                                       â”‚
â”‚     â”‚       metadata: { ... },                                          â”‚
â”‚     â”‚       pipelineLogs: [ upload, extract ]                           â”‚
â”‚     â”‚     }                                                              â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ Progress: 35% â†’ "Processing" (extraction in progress)            â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ POST /api/context-sources                                        â”‚
â”‚     â”‚  â”œâ”€ Body: {                                                       â”‚
â”‚     â”‚  â”‚    userId, name, type: 'pdf',                                  â”‚
â”‚     â”‚  â”‚    extractedData,                                              â”‚
â”‚     â”‚  â”‚    metadata,                                                   â”‚
â”‚     â”‚  â”‚    pipelineLogs  â† LOGS GUARDADOS                             â”‚
â”‚     â”‚  â”‚  }                                                             â”‚
â”‚     â”‚  â””â”€ Response: { source: { id } }                                 â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ Progress: 90% â†’ "Saving to database"                             â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â”œâ”€ POST /api/context-sources/:id/enable-rag                         â”‚
â”‚     â”‚  â”œâ”€ Auto-triggered after source creation                          â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Backend: enable-rag.ts                                        â”‚
â”‚     â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 3: Chunk the text                                        â”‚
â”‚     â”‚  â”‚  â”œâ”€ Log: { step: 'chunk', status: 'in_progress' }              â”‚
â”‚     â”‚  â”‚  â”œâ”€ chunkTextSmart(text, 500, 50)                              â”‚
â”‚     â”‚  â”‚  â”œâ”€ Duration: ~0.3s                                            â”‚
â”‚     â”‚  â”‚  â””â”€ Log: { status: 'success', details: {                       â”‚
â”‚     â”‚  â”‚       chunkCount: 23, avgChunkSize: 512                        â”‚
â”‚     â”‚  â”‚     }}                                                          â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 4: Generate Embeddings                                   â”‚
â”‚     â”‚  â”‚  â”œâ”€ Log: { step: 'embed', status: 'in_progress' }              â”‚
â”‚     â”‚  â”‚  â”œâ”€ generateEmbeddingsBatch(chunkTexts, 5)                     â”‚
â”‚     â”‚  â”‚  â”œâ”€ Parallel processing (5 at a time)                          â”‚
â”‚     â”‚  â”‚  â”œâ”€ Duration: ~3.2s                                            â”‚
â”‚     â”‚  â”‚  â””â”€ Log: { status: 'success', details: {                       â”‚
â”‚     â”‚  â”‚       embeddingCount: 23, embeddingModel                       â”‚
â”‚     â”‚  â”‚     }}                                                          â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 5: Store in Firestore                                    â”‚
â”‚     â”‚  â”‚  â”œâ”€ Batches of 500 chunks                                      â”‚
â”‚     â”‚  â”‚  â”œâ”€ Collection: document_chunks                                â”‚
â”‚     â”‚  â”‚  â””â”€ Duration: ~0.8s                                            â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â”‚  Step 6: Update source metadata                                â”‚
â”‚     â”‚  â”‚  â”œâ”€ ragEnabled: true                                           â”‚
â”‚     â”‚  â”‚  â”œâ”€ ragMetadata: { chunks, model, ... }                        â”‚
â”‚     â”‚  â”‚  â”œâ”€ pipelineLogs: [...existingLogs, chunk, embed, complete]   â”‚
â”‚     â”‚  â”‚  â””â”€ Save to Firestore                                          â”‚
â”‚     â”‚  â”‚                                                                 â”‚
â”‚     â”‚  â””â”€ Response: {                                                   â”‚
â”‚     â”‚       success: true,                                              â”‚
â”‚     â”‚       chunksCreated: 23,                                          â”‚
â”‚     â”‚       pipelineLogs: [ upload, extract, chunk, embed, complete ]   â”‚
â”‚     â”‚     }                                                              â”‚
â”‚     â”‚                                                                    â”‚
â”‚     â””â”€ Progress: 100% â†’ "Complete" âœ…                                   â”‚
â”‚                                                                          â”‚
â”‚  4. User clicks on source                                               â”‚
â”‚     â””â”€ Right panel shows PipelineStatusPanel                            â”‚
â”‚        â””â”€ Visual timeline with all 5 steps                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Estados Visuales del Drag & Drop

### Estado 1: Normal (Esperando archivo)

```css
border: 2px dashed gray-300
background: white
hover: border-gray-400, bg-gray-50
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ“¤                        â”‚
â”‚    Arrastra PDFs aquÃ­ o haz click   â”‚
â”‚                                     â”‚
â”‚    MÃºltiples archivos â€¢             â”‚
â”‚    Extract â†’ Chunk â†’ Embed          â”‚
â”‚                                     â”‚
â”‚    âš¡ Flash  â€¢  Pipeline automÃ¡tico â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estado 2: Dragging (Archivo sobre la zona)

```css
border: 2px dashed blue-500
background: blue-50
transform: scale(1.05)
shadow: shadow-lg
```

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           ğŸ“¤  (AZUL, GRANDE)        â•‘
â•‘   Â¡Suelta los archivos aquÃ­!        â•‘
â•‘                                     â•‘
â•‘    (Zona azul, mÃ¡s grande)          â•‘
â•‘    (AnimaciÃ³n de escala)            â•‘
â•‘                                     â•‘
â•‘    âš¡ Flash  â€¢  Pipeline automÃ¡tico â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Estado 3: Processing (Archivo en cola)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ documento.pdf        ğŸ”„ 8.5s    â”‚
â”‚  Extracting...                      â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 45%             â”‚
â”‚  âš¡ Flash                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estado 4: Complete (Pipeline finalizado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ documento.pdf        âœ“ 13.4s   â”‚
â”‚  Complete                           â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%            â”‚
â”‚  âš¡ Flash                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Pipeline Status Panel - Visual Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ Pipeline de Procesamiento                                 â”‚
â”‚     documento.pdf                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ…  ğŸ“¤ Upload                               â±ï¸  1.2s    â”‚ â”‚
â”‚  â”‚      Archivo guardado exitosamente en Cloud Storage     â”‚ â”‚
â”‚  â”‚      â€¢ TamaÃ±o: 2.5 MB                                   â”‚ â”‚
â”‚  â”‚      â€¢ Storage: uploads/abc123.pdf                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”ƒ (lÃ­nea verde conectora)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ…  ğŸ“„ Extract Text                         â±ï¸  8.7s    â”‚ â”‚
â”‚  â”‚      Texto extraÃ­do: 12,543 caracteres                  â”‚ â”‚
â”‚  â”‚      â€¢ Modelo: Flash                                    â”‚ â”‚
â”‚  â”‚      â€¢ Input: 45,231 tokens                             â”‚ â”‚
â”‚  â”‚      â€¢ Output: 3,456 tokens                             â”‚ â”‚
â”‚  â”‚      â€¢ ğŸ’² Costo: $0.000234                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”ƒ                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ…  ğŸ”² Chunk Document                       â±ï¸  0.3s    â”‚ â”‚
â”‚  â”‚      Documento dividido en 23 chunks                    â”‚ â”‚
â”‚  â”‚      â€¢ Chunks: 23                                       â”‚ â”‚
â”‚  â”‚      â€¢ Promedio: 512 tokens                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”ƒ                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ…  âš¡ Generate Embeddings                  â±ï¸  3.2s    â”‚ â”‚
â”‚  â”‚      23 embeddings generados exitosamente               â”‚ â”‚
â”‚  â”‚      â€¢ Embeddings: 23                                   â”‚ â”‚
â”‚  â”‚      â€¢ Modelo: embedding-001                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”ƒ                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ…  âœ“ Complete                                          â”‚ â”‚
â”‚  â”‚      Pipeline completado exitosamente                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  âœ… Pipeline Completo                                    â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Tiempo total: 13.4s                                    â”‚ â”‚
â”‚  â”‚  Costo total: $0.000234                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Paleta de Colores por Estado

### Upload Step
```css
â€¢ Icon: Upload (blue-600)
â€¢ Border success: green-500
â€¢ Background success: green-50
â€¢ In progress: blue-500, blue-50, animate-pulse
```

### Extract Step
```css
â€¢ Icon: FileText (purple-600)
â€¢ Model Flash: green-700, green-100
â€¢ Model Pro: purple-700, purple-100
â€¢ Cost: gray-900 (destacado)
```

### Chunk Step
```css
â€¢ Icon: Grid (indigo-600)
â€¢ Metrics: gray-700
â€¢ Success: green indicators
```

### Embed Step
```css
â€¢ Icon: Zap (yellow-600)
â€¢ Progress: blue-500
â€¢ Success: green-500
```

### Complete Step
```css
â€¢ Icon: CheckCircle (green-600)
â€¢ Background: gradient green-50 to emerald-50
â€¢ Border: green-200
```

---

## ğŸ“ Responsive Design

### Desktop (>1024px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sources   â”‚  Details   â”‚
â”‚  (50%)     â”‚  (50%)     â”‚
â”‚            â”‚            â”‚
â”‚  Drag Zone â”‚  Pipeline  â”‚
â”‚  Upload Q  â”‚  Status    â”‚
â”‚  Sources   â”‚  Preview   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tablet (768-1024px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sources   â”‚  Details   â”‚
â”‚  (40%)     â”‚  (60%)     â”‚
â”‚            â”‚            â”‚
â”‚  Compact   â”‚  Pipeline  â”‚
â”‚  List      â”‚  Expanded  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mobile (<768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sources (full)      â”‚
â”‚                      â”‚
â”‚  Drag Zone           â”‚
â”‚  Upload Queue        â”‚
â”‚  Sources List        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ (tap on source)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Details (modal)     â”‚
â”‚                      â”‚
â”‚  Pipeline Status     â”‚
â”‚  Preview             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Interacciones del Usuario

### 1. Drag & Drop

```javascript
Event: onDragOver
â”œâ”€ e.preventDefault()
â”œâ”€ setIsDragging(true)
â””â”€ Visual: zona se pone azul y crece

Event: onDragLeave
â”œâ”€ setIsDragging(false)
â””â”€ Visual: zona vuelve a normal

Event: onDrop
â”œâ”€ e.preventDefault()
â”œâ”€ setIsDragging(false)
â”œâ”€ files = e.dataTransfer.files
â””â”€ handleFileSelect(files)
```

### 2. Revisar Staging

```javascript
handleFileSelect(files)
â”œâ”€ setStagedFiles([...files])
â”œâ”€ setShowUploadStaging(true)
â””â”€ Modal muestra:
    â”œâ”€ Preview de archivos (nombre, tamaÃ±o)
    â”œâ”€ Input de tags
    â”œâ”€ Selector de modelo
    â””â”€ Botones: [Cancelar] [Upload]
```

### 3. Confirmar Upload

```javascript
handleSubmitUpload()
â”œâ”€ Para cada archivo staged:
â”‚  â”œâ”€ Crear UploadQueueItem
â”‚  â”œâ”€ Agregar a uploadQueue
â”‚  â””â”€ mostrar en UI
â”œâ”€ setShowUploadStaging(false)
â””â”€ processQueue(queueItems)
```

### 4. Ver Pipeline Details

```javascript
Click en source card
â”œâ”€ setSelectedSourceIds([sourceId])
â””â”€ Panel derecho muestra:
    â”œâ”€ Source metadata
    â”œâ”€ Pipeline Status Panel â† NUEVO
    â”‚  â””â”€ Timeline de 5 pasos
    â”œâ”€ Agent assignment
    â””â”€ Extracted data preview
```

---

## ğŸ’¾ Persistencia en Firestore

### Collection: context_sources

```typescript
{
  id: 'source-abc123',
  userId: 'user-456',
  name: 'documento.pdf',
  type: 'pdf',
  status: 'active',
  extractedData: '...',
  
  // âœ… NUEVO: Pipeline execution logs
  pipelineLogs: [
    {
      step: 'upload',
      status: 'success',
      startTime: Timestamp,
      endTime: Timestamp,
      duration: 1200, // ms
      message: 'Archivo guardado exitosamente',
      details: {
        fileSize: 2621440,
        storagePath: 'uploads/abc123.pdf'
      }
    },
    {
      step: 'extract',
      status: 'success',
      startTime: Timestamp,
      endTime: Timestamp,
      duration: 8700,
      message: 'Texto extraÃ­do: 12,543 caracteres',
      details: {
        model: 'gemini-2.5-flash',
        inputTokens: 45231,
        outputTokens: 3456,
        charactersExtracted: 12543,
        cost: 0.000234
      }
    },
    {
      step: 'chunk',
      status: 'success',
      startTime: Timestamp,
      endTime: Timestamp,
      duration: 300,
      message: 'Documento dividido en 23 chunks',
      details: {
        chunkCount: 23,
        avgChunkSize: 512
      }
    },
    {
      step: 'embed',
      status: 'success',
      startTime: Timestamp,
      endTime: Timestamp,
      duration: 3200,
      message: '23 embeddings generados',
      details: {
        embeddingCount: 23,
        embeddingModel: 'embedding-001'
      }
    },
    {
      step: 'complete',
      status: 'success',
      startTime: Timestamp,
      endTime: Timestamp,
      duration: 0,
      message: 'Pipeline completado exitosamente'
    }
  ],
  
  ragEnabled: true,
  ragMetadata: {
    totalChunks: 23,
    embeddingModel: 'text-embedding-004',
    indexedAt: Timestamp,
    // ...
  }
}
```

---

## ğŸš€ Performance Optimizations

### Upload Phase
- ValidaciÃ³n local antes de enviar (tipo, tamaÃ±o)
- Progress updates cada 200ms (smooth)
- Retry automÃ¡tico en caso de fallo

### Extraction Phase
- Dynamic `maxOutputTokens` basado en tamaÃ±o de archivo
- Parallel processing si mÃºltiples archivos
- Timeout de 60s (Cloud Run)

### Chunking Phase
- Algoritmo optimizado O(n)
- Respeta lÃ­mites de pÃ¡rrafos
- Overlap configurable

### Embedding Phase
- Batch processing (5 embeddings en paralelo)
- Rate limiting incorporado
- Firestore batches de 500 (performance)

---

## ğŸ“ˆ MÃ©tricas TÃ­picas

### PDF PequeÃ±o (1-2 MB, ~10 pÃ¡ginas)

```
Upload:    ~1s
Extract:   ~5-8s (Flash) / ~8-12s (Pro)
Chunk:     ~0.2s (10-20 chunks)
Embed:     ~1-2s
Total:     ~7-12s

Costo:     ~$0.0001-$0.0003 (Flash)
           ~$0.002-$0.005 (Pro)
```

### PDF Mediano (5-10 MB, ~50 pÃ¡ginas)

```
Upload:    ~2s
Extract:   ~15-25s (Flash) / ~20-35s (Pro)
Chunk:     ~0.5s (40-80 chunks)
Embed:     ~4-8s
Total:     ~22-35s

Costo:     ~$0.0005-$0.001 (Flash)
           ~$0.008-$0.015 (Pro)
```

### PDF Grande (>10 MB, 100+ pÃ¡ginas)

```
Upload:    ~3-5s
Extract:   ~30-50s (Flash) / ~40-60s (Pro)
Chunk:     ~1s (100-200 chunks)
Embed:     ~10-20s
Total:     ~45-75s

Costo:     ~$0.001-$0.003 (Flash)
           ~$0.015-$0.030 (Pro)

âš ï¸  RecomendaciÃ³n: Usar Pro para mejor calidad
```

---

## ğŸ¯ UX Highlights

### Feedback Inmediato
- âœ… Drag visual feedback (<50ms)
- âœ… Progress bar smooth (updates cada 200ms)
- âœ… Elapsed time en tiempo real
- âœ… Estado de cada paso visible

### InformaciÃ³n Transparente
- âœ… Modelo usado mostrado
- âœ… Tokens y costos calculados
- âœ… DuraciÃ³n de cada paso
- âœ… MÃ©tricas detalladas

### Error Handling
- âœ… Mensajes de error claros
- âœ… Sugerencias de soluciÃ³n
- âœ… BotÃ³n de retry
- âœ… Logs de error persistidos

---

**Ãšltima ActualizaciÃ³n**: 2025-10-18  
**Implementado por**: Alec  
**Testeado**: Pendiente (prÃ³ximo paso: testing en localhost)

