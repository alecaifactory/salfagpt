# ğŸ“Š SalfaCorp Analytics Dashboard

**Page:** `/salfa-analytics`  
**Created:** November 29, 2025  
**Status:** âœ… Implemented  
**Access:** SuperAdmin + SalfaCorp Admin/Expert only

---

## ğŸ¯ Purpose

Dedicated analytics dashboard for SalfaCorp organization with multi-dimensional filtering and advanced insights into the 4 main production agents.

---

## ğŸ” Access Control

### Who Can Access:

âœ… **SuperAdmin** (alec@getaifactory.com)
- Full access to all SalfaCorp data
- Can see all organizations
- Badge: "ğŸ‘‘ SuperAdmin"

âœ… **SalfaCorp Admin**
- Full access to SalfaCorp data only
- Users with role='admin' from SalfaCorp domains
- Domains: salfagestion.cl, salfa.cl, maqsa.cl, salfacloud.cl, novatec.cl, inoval.cl
- Badge: "ğŸ”‘ admin"

âœ… **SalfaCorp Expert**
- Read-only access to SalfaCorp data
- Users with role='expert' from SalfaCorp domains
- Same domains as admin
- Badge: "ğŸ”‘ expert"

âŒ **Others**
- No access
- HTTP 403 Forbidden
- Redirected or shown error

### Access Logic:

```typescript
const isSuperAdmin = userRole === 'superadmin';
const isSalfaCorpDomain = [
  'salfagestion.cl', 
  'salfa.cl', 
  'maqsa.cl', 
  'salfacloud.cl', 
  'novatec.cl', 
  'inoval.cl'
].includes(userDomain);
const isSalfaCorpUser = organizationId === 'salfa-corp' || isSalfaCorpDomain;
const isAdminOrExpert = ['admin', 'expert'].includes(userRole);

const hasAccess = isSuperAdmin || (isSalfaCorpUser && isAdminOrExpert);
```

---

## ğŸ“Š Data Source

**File:** `/public/data/analytics-complete.json` (215 KB)

**Generated by:** `scripts/export-complete-granular-data.ts`

**Period:** Last 30 days (configurable)

**Update Frequency:** Manual (can be automated)

---

## ğŸ¨ Features

### 1. Global Filters

**Agent Filter:**
- All Agents
- Production Only (5)
- Private Only (36)
- Individual agents (M3-v2, S1-v2, S2-v2, M1-v2)

**Domain Filter:**
- All Domains
- @salfagestion.cl
- @maqsa.cl
- @salfacloud.cl
- @novatec.cl
- @inoval.cl

**Date Range:**
- Last 7 days
- Last 30 days
- All period

**User Search:**
- Filter by email

### 2. KPI Cards (4)

- **Total Messages** - Total interactions in period
- **Active Users** - Unique users who engaged
- **Agents in Production** - Shared agents count
- **Conversations** - Unique chat sessions

### 3. Main Agents Cards (4)

**M3-v2: GOP GPT** (Purple)
- Total messages
- Unique users
- Shared with count

**S1-v2: GestiÃ³n Bodegas** (Green)
- Total messages
- Unique users
- Shared with count

**S2-v2: Maqsa Mantenimiento** (Blue)
- Total messages
- Unique users
- Shared with count

**M1-v2: Legal Territorial** (Orange)
- Total messages
- Unique users
- Shared with count

### 4. Charts (4)

**Daily Activity Chart**
- Line chart showing daily message trends
- Can filter by agent/domain

**Agent Comparison Chart**
- Bar chart comparing the 4 main agents
- Messages, users, adoption rate

**Hourly Pattern Chart**
- Shows peak usage hours
- Can filter by agent

**Domain Distribution Chart**
- Pie chart of user distribution by domain

### 5. Top 10 Users Table

| # | User | Domain | Messages | Days Active |
|---|------|--------|----------|-------------|
| 1 | Name (email) | domain | count | days |

### 6. Recent Conversations List

- Last 20 conversations
- Shows: Agent code, title, user, date, message count
- Color-coded by agent

### 7. Export Button

- Download current analytics data as JSON
- Filename: `salfacorp-analytics-YYYY-MM-DD.json`

---

## ğŸ“ˆ Data Structure

The page consumes: `analytics-complete.json`

```json
{
  "metadata": { ... },
  "summary": { totalMessages, uniqueUsers, ... },
  "agents": [ { agentId, agentCode, title, isShared, ... } ],
  "users": [ { userId, userEmail, userName, domain } ],
  "domains": [ { domain, userCount } ],
  "dailyInteractions": [
    {
      "date": "2025-11-25",
      "agentCode": "M3-v2",
      "userEmail": "user@domain.com",
      "questions": 25,
      "responses": 25,
      ...
    }
  ],
  "hourlyInteractions": [ ... ],
  "conversations": [ ... ]
}
```

---

## ğŸ”§ Technical Details

### File: `src/pages/salfa-analytics.astro`

**Dependencies:**
- Astro 5.1+
- Tailwind CSS v3.4.17
- Firestore (for user auth check)
- Public JSON file

**No external libraries:**
- No Chart.js (can add later)
- No React (pure HTML/JS)
- Vanilla JavaScript for interactivity

### Update Data:

```bash
# Regenerate analytics data
npx tsx scripts/export-complete-granular-data.ts --days=30

# Copy to public folder
cp exports/salfa-analytics/analytics-complete.json public/data/
```

### Automate Updates:

```bash
# Add to cron (daily at 2 AM)
0 2 * * * cd /Users/alec/aifactory && npx tsx scripts/export-complete-granular-data.ts --days=30 && cp exports/salfa-analytics/analytics-complete.json public/data/
```

---

## ğŸ¨ Design

**Color Scheme:**
- M3-v2 (GOP GPT): Purple (#a855f7)
- S1-v2 (Gestion Bodegas): Green (#10b981)
- S2-v2 (Maqsa Mantenimiento): Blue (#3b82f6)
- M1-v2 (Legal Territorial): Orange (#f97316)

**Layout:**
- Responsive (mobile, tablet, desktop)
- Max-width: 7xl (1280px)
- Spacing: 8 (2rem)
- Cards: rounded-xl with shadow-sm

---

## ğŸš€ Usage

### Access the Page:

```
https://your-domain.com/salfa-analytics
```

or

```
http://localhost:3000/salfa-analytics
```

### As SuperAdmin:
- See all data
- Full filtering capabilities
- Export functionality

### As SalfaCorp Admin/Expert:
- See SalfaCorp data only
- Same filtering and export
- Restricted to organization data

### As Other Users:
- HTTP 403 Forbidden
- "Access restricted" message

---

## ğŸ“‹ Filtering Examples

### Example 1: M3-v2 usage last week

```javascript
Filters:
- Agent: M3-v2
- Date Range: Last 7 days
- Domain: All

Result: 
Shows M3-v2 activity for all users in last week
```

### Example 2: salfagestion.cl domain activity

```javascript
Filters:
- Agent: All
- Domain: @salfagestion.cl
- Date Range: Last 30 days

Result:
Shows all agent usage by salfagestion.cl users
```

### Example 3: Production agents only

```javascript
Filters:
- Agent: Production Only
- Date Range: All period

Result:
Shows only the 5 shared agents (M3, S1, S2, M1, SSOMA)
```

---

## ğŸ¯ Key Insights Visible

### Agent Performance:
- Which agents are most used
- Adoption rate (users using / shared with)
- Daily/hourly patterns

### User Engagement:
- Most active users
- Domain distribution
- Days active per user

### Temporal Patterns:
- Peak days for each agent
- Peak hours during the day
- Day-of-week patterns

### Conversations:
- Most recent chats
- Who's creating what conversations
- Agent usage distribution

---

## ğŸ”„ Future Enhancements

### Phase 1 (Next):
- [ ] Add Chart.js for better visualizations
- [ ] Implement advanced filters (multi-select)
- [ ] Add date range picker
- [ ] Export to Excel/PDF

### Phase 2:
- [ ] Real-time data (direct Firestore queries)
- [ ] Comparison with previous period
- [ ] Alerts and notifications
- [ ] Custom report builder

### Phase 3:
- [ ] AI Assistant for querying data
- [ ] Scheduled email reports
- [ ] Dashboard sharing
- [ ] Custom KPI builder

---

## ğŸ“š Related Files

**Page Implementation:**
- `src/pages/salfa-analytics.astro` (main page)

**Data Files:**
- `public/data/analytics-complete.json` (215 KB)
- `exports/salfa-analytics/` (all exports)

**Scripts:**
- `scripts/export-complete-granular-data.ts` (data generation)
- `scripts/export-salfagpt-dashboard.ts` (CSV exports)

**Documentation:**
- `exports/salfa-analytics/ANALYTICS_COMPLETE_GUIDE.md`
- `exports/salfa-analytics/INDICE_COMPLETO.md`

---

## âœ… Success Criteria

A successful analytics dashboard should:

1. **Security** âœ…
   - Only accessible by authorized roles
   - Proper authentication check
   - Organization-level data isolation

2. **Performance** ğŸ”„
   - Load in <3 seconds
   - Filter updates in <2 seconds
   - Smooth scrolling

3. **Functionality** âœ…
   - All 4 main agents visible
   - KPIs accurate
   - Filters work
   - Export works

4. **Design** âœ…
   - Professional look
   - Responsive design
   - Clear data visualization
   - Intuitive navigation

---

## ğŸš€ Deployment

### Copy Data File:

```bash
# Ensure analytics data is in public folder
cp exports/salfa-analytics/analytics-complete.json public/data/
```

### Test Locally:

```bash
npm run dev
# Open: http://localhost:3000/salfa-analytics
```

### Deploy to Production:

```bash
# Build
npm run build

# Deploy
# (your deployment command)
```

---

## ğŸ“ Support

**Questions:** alec@getaifactory.com  
**Documentation:** This file + ANALYTICS_COMPLETE_GUIDE.md  
**Data Updates:** Run export scripts and copy to public/data/

---

**Status:** âœ… Page created and ready for use  
**Next Step:** Test the page and add Chart.js visualizations


