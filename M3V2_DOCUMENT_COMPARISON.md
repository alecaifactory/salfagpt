# üìä M3-v2 Document Upload - Detailed Comparison

**Date:** November 25, 2025  
**Purpose:** Show exactly what will change for M3-v2 agent

---

## üìã **CURRENT STATE**

### Agent: GOP GPT (M3-v2)
- **Agent ID:** `vStojK73ZKbjNsEnqANJ`
- **Owner:** usr_uhwqffaqag1wrryd82tw (alec@getaifactory.com)

### Currently Assigned Documents

**Total: 1 document**

| # | Document Name | RAG | Chunks |
|---|---------------|-----|--------|
| 1 | GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF | Yes | 3 |

---

## üì• **NEW DOCUMENTS IN QUEUE**

### Total Files to Upload: 62 PDFs

### Analysis by Filename

Looking at unique base filenames, we have **approximately 47 unique documents** with some appearing in both uppercase (.PDF) and lowercase (.pdf) extensions.

### Duplicates by Extension

Documents appearing in both Primera and Segunda carga:

| Base Filename | Primera (.PDF) | Segunda (.pdf) | Action |
|---------------|----------------|----------------|--------|
| 6.5 MAQ-LOG-CBO-P-001 Gesti√≥n de Bodegas de Obras Rev.07 | ‚úì | ‚úì | Upload both (different case) |
| CONTRATACION DE SUBCONTRATISTAS | ‚úì | ‚úì | Upload both |
| GOP-D-PCO-2.PLAN DE CALIDAD Y OPERACION-(V.1) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.ANEXO RESUMEN REVISIONES MITO-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.EVALUACION SUBCONTRATOS-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.INSTRUCTIVO CALCULO DE STOCK CRITICO-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.INSTRUCTIVO MODULADOR DE BODEGAS-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.MATRIZ DE OBJETIVOS DE CONTROL DE OBRA-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.1.PROCEDIMIENTO ENTREGA OBRA A POST VENTA-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.2.PROCEDIMIENTO ELABORACION Y CONTROL CH-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.2.TRAZABILIDAD, CERTIFICADOS Y ENSAYOS-(V.4) | ‚úì | ‚úì | Upload both |
| GOP-P-PCO-2.5.RESPONSABILIDADES EN PORTERIA-(V.0) | ‚úì | - | Upload once |
| GOP-P-PF-3.1.ANEXO 1 MANO DE OBRA-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PF-3.1.ANEXO 2 MANO DE OBRA-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PF-3.1.ANEXO 3 EQUIPOS-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-PF-3.1.ANEXO 4 EQUIPOS-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-CE-5.PROCEDIMIENTO CONTROL DE ETAPA DS49-(V.0) | ‚úì | ‚úì | Upload both |
| GOP-P-EV-4.ENTORNO VECINOS Y RELACIONAMIENTO COMUNITARIO-(V.4) | ‚úì | ‚úì | Upload both |

**Note:** System treats .PDF and .pdf as different files, so both will be uploaded. This is actually beneficial for version tracking.

---

## üÜï **TRULY NEW DOCUMENTS**

Documents that don't exist in current agent:

### New Sections (Not Previously Covered)

**Section 2.6: Pol√≠ticas Calidad (5 docs)** ‚≠ê
1. GOP-P-PCO-2.6.BRISAS DE BATUCO-(V.1).pdf
2. GOP-P-PCO-2.6.GEOMAR V-(V.1).pdf
3. GOP-P-PCO-2.6.NOVAL-(V.1).pdf
4. GOP-P-PCO-2.6.NOVATEC EDIFICIOS-(V.1).pdf
5. GOP-P-PCO-2.6.NOVATEC-(V.1).pdf

**Section 6: AFE Log√≠stica (1 doc)** ‚≠ê
6. AFE Log y adm de bodega Rev 5.2.pdf

### New Documents in Existing Sections

**Planificaci√≥n Inicial:**
7. GOP-D-PI-1.PLANIFICACION INICIAL DE OBRA-(V.1) (1).PDF (Primera)
8. GOP-D-PI-1.PLANIFICACION INICIAL DE OBRA-(V.2).pdf (Segunda) ‚≠ê **VERSION 2**

**Plan de Calidad:**
9. GOP-P-PCO-2.1.MATRIZ DE RIESGOS Y OPORTUNIDADES.pdf ‚≠ê
10. GOP-P-PCO-2.1.DETECCION DE HALLAZGOS Y NO CONFORMIDADES-(V.5).PDF
11. GOP-P-PCO-2.1.PROCEDIMIENTO DE GESTION DE CONSTRUCCION EN OBRA-(V.2).PDF
12. GOP-P-PCO-2.1.PROCEDIMIENTO INICIO DE OBRAS DE EDIFICACION-(V.0).PDF
13. GOP-P-PCO-2.2.TRAZABILIDAD, CERTIFICADOS Y ENSAYOS-(V.4)(1).PDF
14. GOP-R-PCO-2.4.MINUTA_DE_REUNION-(V.0).DOCX.pdf
15. GOP-P-PCO-2.ELABORACION DE DOCUMENTOS-(V.0).PDF
16. RESUMEN Y PREGUNTAS.docx.pdf

**Panel Financiero:**
17. GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS EXENTOS-(V.1) (1).PDF
18. GOP-D-PF-3.PROCESO PANEL FINANCIERO PROYECTOS EXENTOS-(V.1).pdf
19. 20240222-BODEGA NEWS! NUEVO Paso a Paso MAQ-LOG-CBO-PP-019... ‚≠ê
20. MAQ-LOG-CBO-PP-019 Manejo de Stock Cr√≠tico-PEP Nivel 4.pdf

**Entorno Vecino:**
21. Presentacion Manual Relacionamiento Comunitario 2024 13-08.pdf ‚≠ê

Plus ~26 more documents with duplicate extensions (.PDF and .pdf versions)

---

## üîÑ **DOCUMENT MATCHING ANALYSIS**

### Exact Match with Current Document

**1 potential match:**

| Current | New File | Match Type |
|---------|----------|------------|
| GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF | GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF | Exact filename match |

**Action:** The upload script has `--skip-existing` flag, so this will be **skipped** (not re-uploaded).

**Result:** The existing document will remain unchanged.

### Version Updates

| Document | V.1 (existing in queue) | V.2 (newer) | Action |
|----------|-------------------------|-------------|--------|
| GOP-D-PI-1.PLANIFICACION INICIAL DE OBRA | (V.1) (1).PDF | (V.2).pdf | Upload both (different versions) |

**Result:** Agent will have access to both V.1 and V.2.

---

## üìä **FINAL COUNT ANALYSIS**

### Upload Behavior with --skip-existing

The script checks if a document with the **exact same filename** already exists in:
```sql
SELECT * FROM context_sources 
WHERE assignedToAgents CONTAINS 'vStojK73ZKbjNsEnqANJ'
AND name = '{exact_filename}'
```

### Expected Upload Results

| Category | Count | Skipped | Uploaded |
|----------|-------|---------|----------|
| Total files in queue | 62 | 1 | **61** |
| Exact filename match | 1 | 1 | 0 |
| New/different filenames | 61 | 0 | 61 |

**Breakdown:**
- **1 file skipped:** GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF (exact match)
- **61 files uploaded:** All other files (new or different versions/extensions)

---

## üìç **FINAL STATE AFTER UPLOAD**

### Documents Assigned to M3-v2

| Metric | Before | After | Change |
|--------|--------|-------|--------|
| Total Documents | 1 | **62** | **+61** |
| RAG-Enabled | 1 | 62 | +61 |
| Total Chunks | 3 | **~312-622** | **~+309-619** |
| Embeddings | 3 | ~312-622 | ~+309-619 |

**Corrected from initial estimate:** 62 total (not 63) because 1 file will be skipped.

### Document Coverage

**Sections covered after upload:**

1. ‚úÖ **Planificaci√≥n Inicial** (2 docs: V.1 and V.2)
2. ‚úÖ **Plan de Calidad y Operaci√≥n** (33 docs)
   - Calidad y Operaci√≥n de Obra
   - Control Materiales y Ensayos
   - Control de Documentos
   - Control Porter√≠a
   - **Pol√≠ticas Calidad** (NEW)
3. ‚úÖ **Panel Financiero** (14 docs - both Afectos and Exentos)
4. ‚úÖ **Entorno Vecino** (3 docs)
5. ‚úÖ **Control de Etapa** (2 docs)
6. ‚úÖ **AFE Log√≠stica** (1 doc) NEW
7. ‚úÖ **Varios** (7 docs - instructivos, matrices, etc.)

---

## üéØ **CORRECTED EXPECTATIONS**

### Upload Statistics

- **Files processed:** 62
- **Files skipped:** 1 (existing match)
- **Files uploaded:** **61**
- **Final document count:** **62 documents**

### Cost & Time (Adjusted)

**Cost:**
- Gemini extraction: 61 files √ó $0.001-0.005 = $0.061-0.305
- Embeddings: ~305-610 chunks √ó $0.0001 = $0.003-0.006
- **Total: ~$0.06-0.31**

**Time:**
- Per file: ~30-60s
- Total: 61 files √ó 30-60s = 30.5-61 minutes
- With delays: **40-70 minutes**

---

## ‚úÖ **FINAL VERIFICATION CHECKLIST**

After upload, you should see:

### Firestore (`context_sources`)
- [ ] **62 total documents** assigned to vStojK73ZKbjNsEnqANJ
- [ ] 1 old document (ID: 1EnH6gTnM6a33W4aUeNp)
- [ ] 61 new documents (tag: M3-v2-20251125)
- [ ] All have `ragEnabled: true`
- [ ] All have `assignedToAgents: ['vStojK73ZKbjNsEnqANJ']`

### Firestore (`document_chunks`)
- [ ] **~312-622 total chunks** for this agent
- [ ] All chunks have embeddings (768-dimensional arrays)
- [ ] All chunks reference source documents

### BigQuery (`flow_analytics_east4.document_embeddings`)
- [ ] **~312-622 rows** for user usr_uhwqffaqag1wrryd82tw
- [ ] All rows have `embedding` array (768 dimensions)
- [ ] All rows have `full_text` populated
- [ ] Vector index operational

### GCS (`salfagpt-context-documents`)
- [ ] **61 PDF files** in path: usr_uhwqffaqag1wrryd82tw/vStojK73ZKbjNsEnqANJ/
- [ ] All files accessible
- [ ] Metadata tags correct

### Agent Configuration
- [ ] `activeContextSourceIds` updated with 61 new IDs
- [ ] Agent responds to queries using new documents
- [ ] UI shows 62 documents in context panel

---

## üö® **IMPORTANT NOTES**

### About Duplicates

You have several files with the same content but different extensions:
- `.PDF` (uppercase) - from Primera carga
- `.pdf` (lowercase) - from Segunda carga

**What will happen:**
- Both versions will be uploaded as separate documents
- Each will have its own chunks and embeddings
- Both will be searchable
- This adds redundancy but also ensures both batches are tracked

**Impact:**
- Slightly higher storage cost (negligible)
- Slightly higher chunk count
- Better traceability (can see both batches)
- No negative impact on search quality

### Recommendation

If you want to avoid duplicates, you have two options:

**Option A: Upload both batches** (recommended)
- Pros: Complete traceability, both batches documented
- Cons: Some redundancy
- Command: Use existing `./upload-m3v2-docs.sh`

**Option B: Deduplicate before upload**
- Pros: Cleaner, no duplicates
- Cons: Lose traceability of which batch files came from
- Would require: Custom script to remove duplicates

**My recommendation:** **Option A** - Upload everything. The redundancy is minimal and the traceability is valuable.

---

## üéØ **READY TO PROCEED**

### Everything Needed Is In Place

1. ‚úÖ **Infrastructure:** GCS (us-east4), Firestore (us-central1), BigQuery (us-east4)
2. ‚úÖ **Scripts:** Upload script ready (`./upload-m3v2-docs.sh`)
3. ‚úÖ **Verification:** Automated verification ready (`./verify-m3v2-after-upload.sh`)
4. ‚úÖ **Documentation:** Complete analysis in this file
5. ‚úÖ **Rollback plan:** Can reverse if needed

### What You'll Get

After successful upload:
- **62 documents** (1 existing kept + 61 new uploaded)
- **~312-622 chunks** indexed for search
- **Comprehensive coverage** of all Portal Edificaci√≥n procedures
- **Fast search** (<2s) via BigQuery vector similarity
- **Full UI integration** with source citations
- **CLI/API access** for programmatic queries

### Cost & Time

- **One-time cost:** ~$0.06-0.31
- **Time:** 40-70 minutes
- **Monthly storage:** <$0.01

---

**Ready when you are.** Say "proceed" to start the upload.


