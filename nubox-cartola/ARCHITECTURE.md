# Nubox Cartola Extraction - Architecture
## AWS Lambda Serverless System

**Version:** 1.0.0  
**Last Updated:** November 27, 2025  
**Status:** Production-Ready Design

---

## ğŸ¯ System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NUBOX CARTOLA EXTRACTION SYSTEM                   â”‚
â”‚                         AWS Lambda Architecture                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER/CLIENT
    â”‚
    â”‚ 1. Upload PDF
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                          â”‚
    â–¼                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WEB INTERFACE     â”‚                              â”‚  API CLIENT  â”‚
â”‚   (Nubox Frontend)  â”‚                              â”‚  (External)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                                 â”‚
           â”‚ 2. HTTP POST                                    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    API GATEWAY (AWS)    â”‚
                    â”‚  - REST API             â”‚
                    â”‚  - CORS enabled         â”‚
                    â”‚  - Rate limiting        â”‚
                    â”‚  - API key auth         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ 3. Invoke Lambda
                                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   LAMBDA: ProcessCartolaExtraction   â”‚
              â”‚   Runtime: Node.js 20.x              â”‚
              â”‚   Memory: 2GB                        â”‚
              â”‚   Timeout: 15 min                    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚            â”‚
          4. Download PDF â”‚            â”‚ 8. Save results
                          â”‚            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     S3 BUCKET    â”‚     â””â”€â”€â”€â”€â”€â–¶   DYNAMODB      â”‚
              â”‚  cartola-uploads â”‚           â”‚  extractions    â”‚
              â”‚                  â”‚           â”‚  - Primary: id  â”‚
              â”‚  - AES-256       â”‚           â”‚  - GSI: userId  â”‚
              â”‚  - 7-day TTL     â”‚           â”‚  - TTL: 90 days â”‚
              â”‚  - Private       â”‚           â”‚  - On-demand    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          5. Base64 encodeâ”‚
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   GEMINI AI API     â”‚
                â”‚   (External)        â”‚
                â”‚                     â”‚
                â”‚  - Flash: $0.0008   â”‚
                â”‚  - Pro: $0.013      â”‚
                â”‚  - Smart parsing    â”‚
                â”‚  - Column detect    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            6. JSON responseâ”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  VALIDATION LAYER      â”‚
              â”‚  - Parse JSON          â”‚
              â”‚  - Validate balance    â”‚
              â”‚  - Quality metrics     â”‚
              â”‚  - Error detection     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            7. Validated    â”‚
                  result    â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RESPONSE    â”‚
                    â”‚  - JSON      â”‚
                    â”‚  - Metadata  â”‚
                    â”‚  - Insights  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ CLOUDWATCH   â”‚
                    â”‚ - Logs       â”‚
                    â”‚ - Metrics    â”‚
                    â”‚ - Alarms     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ GCP to AWS Service Mapping

### **Complete Migration Map**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GCP SERVICE          â”‚   AWS SERVICE          â”‚   CHANGES       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cloud Run              â”‚ Lambda + API Gateway   â”‚ Handler rewrite â”‚
â”‚ Cloud Storage (GCS)    â”‚ S3                     â”‚ API calls only  â”‚
â”‚ Firestore              â”‚ DynamoDB               â”‚ Query syntax    â”‚
â”‚ Cloud Logging          â”‚ CloudWatch Logs        â”‚ Auto-integrated â”‚
â”‚ Cloud Monitoring       â”‚ CloudWatch Metrics     â”‚ Auto-integrated â”‚
â”‚ Secret Manager         â”‚ Systems Manager (SSM)  â”‚ Env var pattern â”‚
â”‚ IAM Service Account    â”‚ IAM Execution Role     â”‚ Permission modelâ”‚
â”‚ Gemini AI (Files API)  â”‚ Gemini AI (Base64)     â”‚ Encoding method â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Code Reusability**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CODE COMPONENT          â”‚ REUSE %  â”‚ CHANGES REQUIRED       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Extraction logic        â”‚  100%    â”‚ None                   â”‚
â”‚ Validation logic        â”‚  100%    â”‚ None                   â”‚
â”‚ Prompt engineering      â”‚  100%    â”‚ None                   â”‚
â”‚ JSON parsing            â”‚  100%    â”‚ None                   â”‚
â”‚ Business logic          â”‚  100%    â”‚ None                   â”‚
â”‚ Storage API calls       â”‚   0%     â”‚ GCS â†’ S3 APIs          â”‚
â”‚ Database API calls      â”‚   0%     â”‚ Firestore â†’ DynamoDB   â”‚
â”‚ HTTP handler            â”‚   0%     â”‚ Server â†’ Lambda event  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Overall code reuse: ~80%
Migration effort: Low (API adapters only)
```

---

## ğŸ“ Component Architecture

### **1. API Gateway**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API GATEWAY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Resource: /cartola                                        â”‚
â”‚  â”œâ”€ POST /extract                                          â”‚
â”‚  â”‚  â”œâ”€ Request: multipart/form-data or JSON               â”‚
â”‚  â”‚  â”œâ”€ Auth: API Key or Cognito                           â”‚
â”‚  â”‚  â”œâ”€ Rate Limit: 100 req/min                            â”‚
â”‚  â”‚  â”œâ”€ Timeout: 29 seconds (async processing)             â”‚
â”‚  â”‚  â””â”€ Response: { extractionId, status: "processing" }   â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ GET /{id}                                              â”‚
â”‚  â”‚  â”œâ”€ Request: Path parameter (extraction ID)            â”‚
â”‚  â”‚  â”œâ”€ Auth: API Key or Cognito                           â”‚
â”‚  â”‚  â””â”€ Response: { status, result, metadata }             â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€ GET /list                                              â”‚
â”‚     â”œâ”€ Request: Query params (userId, limit, status)       â”‚
â”‚     â”œâ”€ Auth: API Key or Cognito                           â”‚
â”‚     â””â”€ Response: { items[], count, nextToken }            â”‚
â”‚                                                            â”‚
â”‚  CORS Configuration:                                        â”‚
â”‚  â”œâ”€ Allowed Origins: * (or specific domains)               â”‚
â”‚  â”œâ”€ Allowed Methods: GET, POST, OPTIONS                    â”‚
â”‚  â”œâ”€ Allowed Headers: Content-Type, Authorization           â”‚
â”‚  â””â”€ Max Age: 3600 seconds                                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Features:**
- **Regional endpoint** (lower latency than edge-optimized)
- **API key authentication** (simple, effective)
- **Request validation** (schema enforcement)
- **Rate limiting** (prevent abuse)
- **CORS enabled** (web browser support)

---

### **2. Lambda Functions**

#### **ProcessCartolaExtraction (Main Function)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LAMBDA: ProcessCartolaExtraction                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Configuration:                                            â”‚
â”‚  â”œâ”€ Runtime: Node.js 20.x                                 â”‚
â”‚  â”œâ”€ Memory: 2048 MB (2 GB)                                â”‚
â”‚  â”œâ”€ Timeout: 900 seconds (15 minutes)                     â”‚
â”‚  â”œâ”€ Ephemeral Storage: 512 MB (default)                   â”‚
â”‚  â””â”€ Concurrency: 100 (unreserved)                         â”‚
â”‚                                                            â”‚
â”‚  Environment Variables:                                    â”‚
â”‚  â”œâ”€ GEMINI_API_KEY (encrypted at rest)                    â”‚
â”‚  â”œâ”€ S3_BUCKET                                             â”‚
â”‚  â”œâ”€ DYNAMODB_TABLE                                        â”‚
â”‚  â””â”€ LOG_LEVEL (info/debug)                                â”‚
â”‚                                                            â”‚
â”‚  Execution Flow:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 1. Parse Event (API Gateway payload)         â”‚         â”‚
â”‚  â”‚    â”œâ”€ Extract s3Key, userId, bankName        â”‚         â”‚
â”‚  â”‚    â””â”€ Validate required fields               â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 2. Create DynamoDB Record                    â”‚         â”‚
â”‚  â”‚    â”œâ”€ Generate extractionId                  â”‚         â”‚
â”‚  â”‚    â”œâ”€ Status: "processing"                   â”‚         â”‚
â”‚  â”‚    â””â”€ TTL: now + 90 days                     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 3. Download PDF from S3                      â”‚         â”‚
â”‚  â”‚    â”œâ”€ GetObject(bucket, key)                 â”‚         â”‚
â”‚  â”‚    â”œâ”€ Verify file size (<500MB)              â”‚         â”‚
â”‚  â”‚    â””â”€ Convert to Buffer                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 4. Encode PDF to Base64                      â”‚         â”‚
â”‚  â”‚    â””â”€ Required for Gemini AI API             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 5. Call Gemini AI                            â”‚         â”‚
â”‚  â”‚    â”œâ”€ Model: gemini-2.5-flash or pro         â”‚         â”‚
â”‚  â”‚    â”œâ”€ Prompt: Bank statement extraction      â”‚         â”‚
â”‚  â”‚    â”œâ”€ Response format: JSON                  â”‚         â”‚
â”‚  â”‚    â””â”€ Track token usage                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 6. Parse & Validate JSON                     â”‚         â”‚
â”‚  â”‚    â”œâ”€ Parse AI response                      â”‚         â”‚
â”‚  â”‚    â”œâ”€ Validate structure                     â”‚         â”‚
â”‚  â”‚    â”œâ”€ Verify balance equation                â”‚         â”‚
â”‚  â”‚    â””â”€ Calculate quality metrics              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 7. Update DynamoDB                           â”‚         â”‚
â”‚  â”‚    â”œâ”€ Status: "completed" or "failed"        â”‚         â”‚
â”‚  â”‚    â”œâ”€ Save extraction result                 â”‚         â”‚
â”‚  â”‚    â”œâ”€ Record processing time                 â”‚         â”‚
â”‚  â”‚    â””â”€ Calculate cost                         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 8. Send Webhook (Optional)                   â”‚         â”‚
â”‚  â”‚    â””â”€ POST to configured URL                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                     â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ 9. Return Response                           â”‚         â”‚
â”‚  â”‚    â”œâ”€ Success: { extractionId, result }      â”‚         â”‚
â”‚  â”‚    â””â”€ Error: { error, details }              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Error Handling:                                           â”‚
â”‚  â”œâ”€ Try-catch at each step                                â”‚
â”‚  â”œâ”€ Update DynamoDB status on error                       â”‚
â”‚  â”œâ”€ Log to CloudWatch                                     â”‚
â”‚  â””â”€ Return user-friendly error message                    â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **GetCartolaStatus (Query Function)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAMBDA: GetCartolaStatus                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Configuration:                                            â”‚
â”‚  â”œâ”€ Runtime: Node.js 20.x                                 â”‚
â”‚  â”œâ”€ Memory: 512 MB                                        â”‚
â”‚  â”œâ”€ Timeout: 30 seconds                                   â”‚
â”‚  â””â”€ Concurrency: 100                                      â”‚
â”‚                                                            â”‚
â”‚  Flow:                                                     â”‚
â”‚  1. Parse event â†’ Extract extractionId                    â”‚
â”‚  2. Query DynamoDB by primary key (id)                    â”‚
â”‚  3. Return result                                         â”‚
â”‚                                                            â”‚
â”‚  Response:                                                 â”‚
â”‚  {                                                         â”‚
â”‚    "id": "ext_xxx",                                       â”‚
â”‚    "status": "completed|processing|failed",               â”‚
â”‚    "extractionResult": {...},                            â”‚
â”‚    "processingTime": 58000,                               â”‚
â”‚    "createdAt": 1700000000000                             â”‚
â”‚  }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ListUserCartolas (List Function)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LAMBDA: ListUserCartolas                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Configuration:                                            â”‚
â”‚  â”œâ”€ Runtime: Node.js 20.x                                 â”‚
â”‚  â”œâ”€ Memory: 512 MB                                        â”‚
â”‚  â”œâ”€ Timeout: 30 seconds                                   â”‚
â”‚  â””â”€ Concurrency: 100                                      â”‚
â”‚                                                            â”‚
â”‚  Flow:                                                     â”‚
â”‚  1. Parse event â†’ Extract userId, filters                 â”‚
â”‚  2. Query DynamoDB via userId-createdAt-index             â”‚
â”‚  3. Apply filters (status, dateRange)                     â”‚
â”‚  4. Paginate results (limit 50 default)                   â”‚
â”‚  5. Return items[]                                        â”‚
â”‚                                                            â”‚
â”‚  Query Optimization:                                       â”‚
â”‚  â”œâ”€ Use GSI for efficient queries                        â”‚
â”‚  â”œâ”€ DynamoDB pagination (LastEvaluatedKey)               â”‚
â”‚  â””â”€ Client-side filtering minimized                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **3. S3 Storage**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     S3 BUCKET                               â”‚
â”‚                nubox-cartola-uploads                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Bucket Structure:                                         â”‚
â”‚  s3://nubox-cartola-uploads/                              â”‚
â”‚    â”œâ”€ user-123/                   (per-user folders)       â”‚
â”‚    â”‚   â”œâ”€ cartola-oct-2024.pdf                            â”‚
â”‚    â”‚   â””â”€ cartola-nov-2024.pdf                            â”‚
â”‚    â”œâ”€ org-456/                    (per-org folders)        â”‚
â”‚    â”‚   â””â”€ statements/                                      â”‚
â”‚    â””â”€ temp/                       (temporary uploads)      â”‚
â”‚                                                            â”‚
â”‚  Encryption:                                               â”‚
â”‚  â”œâ”€ Server-side: AES-256 (SSE-S3)                         â”‚
â”‚  â”œâ”€ At rest: Automatic                                    â”‚
â”‚  â””â”€ In transit: TLS 1.2+                                  â”‚
â”‚                                                            â”‚
â”‚  Access Control:                                           â”‚
â”‚  â”œâ”€ Block all public access: âœ… ENABLED                   â”‚
â”‚  â”œâ”€ Bucket policy: Lambda role only                       â”‚
â”‚  â”œâ”€ Pre-signed URLs: 7 days expiration                    â”‚
â”‚  â””â”€ IAM roles: Least privilege                            â”‚
â”‚                                                            â”‚
â”‚  Lifecycle Policy:                                         â”‚
â”‚  â”œâ”€ Rule 1: Delete objects after 7 days                   â”‚
â”‚  â”‚   (Original PDFs - no longer needed)                   â”‚
â”‚  â”œâ”€ Rule 2: Transition to Glacier after 30 days           â”‚
â”‚  â”‚   (Archive copies if retention required)               â”‚
â”‚  â””â”€ Rule 3: Permanent delete after 90 days                â”‚
â”‚                                                            â”‚
â”‚  Versioning: DISABLED                                      â”‚
â”‚  (Not needed - single upload per statement)                â”‚
â”‚                                                            â”‚
â”‚  Monitoring:                                               â”‚
â”‚  â”œâ”€ S3 access logs â†’ CloudWatch                           â”‚
â”‚  â”œâ”€ Metrics: Object count, storage bytes                  â”‚
â”‚  â””â”€ Alarms: Storage > 100GB warning                       â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **4. DynamoDB Database**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DYNAMODB TABLE                            â”‚
â”‚                 cartola_extractions                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Primary Key:                                              â”‚
â”‚  â”œâ”€ Partition Key: id (String)                            â”‚
â”‚  â”‚   Example: "ext_1700000000000_abc123"                  â”‚
â”‚  â””â”€ No sort key (single-item lookup)                      â”‚
â”‚                                                            â”‚
â”‚  Attributes (Sample Record):                               â”‚
â”‚  {                                                         â”‚
â”‚    "id": "ext_1700000000000_abc123",                      â”‚
â”‚    "userId": "user-123",                                  â”‚
â”‚    "organizationId": "org-salfa-corp",                    â”‚
â”‚    "status": "completed",                                 â”‚
â”‚    "fileName": "cartola-banco-chile-oct-2024.pdf",        â”‚
â”‚    "fileSize": 524288,                                    â”‚
â”‚    "s3Key": "user-123/cartola-oct-2024.pdf",              â”‚
â”‚    "bankName": "Banco de Chile",                          â”‚
â”‚    "model": "gemini-2.5-flash",                           â”‚
â”‚    "extractionResult": {                                  â”‚
â”‚      "document_id": "doc_abc",                            â”‚
â”‚      "movements": [...],                                  â”‚
â”‚      "balance_validation": {...}                          â”‚
â”‚    },                                                      â”‚
â”‚    "processingTime": 58234,                               â”‚
â”‚    "inputTokens": 12500,                                  â”‚
â”‚    "outputTokens": 3200,                                  â”‚
â”‚    "cost": 0.0008,                                        â”‚
â”‚    "createdAt": 1700000000000,                            â”‚
â”‚    "updatedAt": 1700000058234,                            â”‚
â”‚    "completedAt": 1700000058234,                          â”‚
â”‚    "ttl": 1707776000                                      â”‚
â”‚  }                                                         â”‚
â”‚                                                            â”‚
â”‚  Global Secondary Indexes (GSI):                           â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ GSI 1: userId-createdAt-index              â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Partition: userId (String)                 â”‚           â”‚
â”‚  â”‚ Sort: createdAt (Number - epoch ms)        â”‚           â”‚
â”‚  â”‚ Projection: ALL                            â”‚           â”‚
â”‚  â”‚                                            â”‚           â”‚
â”‚  â”‚ Use Case: List user's extractions          â”‚           â”‚
â”‚  â”‚ Query: userId = "user-123"                 â”‚           â”‚
â”‚  â”‚ Sort: Most recent first                    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ GSI 2: organizationId-createdAt-index      â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Partition: organizationId (String)         â”‚           â”‚
â”‚  â”‚ Sort: createdAt (Number)                   â”‚           â”‚
â”‚  â”‚ Projection: ALL                            â”‚           â”‚
â”‚  â”‚                                            â”‚           â”‚
â”‚  â”‚ Use Case: Organization analytics           â”‚           â”‚
â”‚  â”‚ Query: organizationId = "org-salfa"        â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ GSI 3: status-createdAt-index              â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Partition: status (String)                 â”‚           â”‚
â”‚  â”‚ Sort: createdAt (Number)                   â”‚           â”‚
â”‚  â”‚ Projection: ALL                            â”‚           â”‚
â”‚  â”‚                                            â”‚           â”‚
â”‚  â”‚ Use Case: Admin monitoring                 â”‚           â”‚
â”‚  â”‚ Query: status = "failed"                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                            â”‚
â”‚  Capacity Mode: PAY_PER_REQUEST (On-Demand)               â”‚
â”‚  â”œâ”€ Auto-scaling to workload                              â”‚
â”‚  â”œâ”€ No capacity planning needed                           â”‚
â”‚  â””â”€ Cost: $1.25/million writes, $0.25/million reads       â”‚
â”‚                                                            â”‚
â”‚  Time to Live (TTL):                                       â”‚
â”‚  â”œâ”€ Attribute: ttl (Number - epoch seconds)               â”‚
â”‚  â”œâ”€ Retention: 90 days                                    â”‚
â”‚  â””â”€ Auto-deletion: DynamoDB manages                       â”‚
â”‚                                                            â”‚
â”‚  Point-in-Time Recovery: ENABLED                          â”‚
â”‚  â”œâ”€ Continuous backups                                    â”‚
â”‚  â””â”€ Restore to any point in last 35 days                  â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why DynamoDB?**
- âœ… Serverless (matches Lambda)
- âœ… Auto-scaling
- âœ… Single-digit ms latency
- âœ… Built-in TTL (auto-cleanup)
- âœ… Point-in-time recovery

---

### **5. Gemini AI Integration**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GEMINI AI API FLOW                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  GCP Version (Current):                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Cloud Run                                    â”‚         â”‚
â”‚  â”‚   â†“                                          â”‚         â”‚
â”‚  â”‚ Upload file to Cloud Storage                 â”‚         â”‚
â”‚  â”‚   â†“                                          â”‚         â”‚
â”‚  â”‚ Gemini AI Files API                          â”‚         â”‚
â”‚  â”‚   â”œâ”€ Upload via multipart/form-data          â”‚         â”‚
â”‚  â”‚   â”œâ”€ Get fileUri                             â”‚         â”‚
â”‚  â”‚   â””â”€ Reference in generateContent()          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  AWS Version (Target):                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Lambda Function                              â”‚         â”‚
â”‚  â”‚   â†“                                          â”‚         â”‚
â”‚  â”‚ Convert PDF to Base64 string                 â”‚         â”‚
â”‚  â”‚   â†“                                          â”‚         â”‚
â”‚  â”‚ Gemini AI Direct API                         â”‚         â”‚
â”‚  â”‚   â”œâ”€ Inline data (base64 in request)         â”‚         â”‚
â”‚  â”‚   â”œâ”€ No file upload needed                   â”‚         â”‚
â”‚  â”‚   â””â”€ Single API call                         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  API Call Structure:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ POST https://generativelanguage.              â”‚         â”‚
â”‚  â”‚      googleapis.com/v1/models/                â”‚         â”‚
â”‚  â”‚      gemini-2.5-flash:generateContent         â”‚         â”‚
â”‚  â”‚                                               â”‚         â”‚
â”‚  â”‚ Headers:                                      â”‚         â”‚
â”‚  â”‚ â”œâ”€ Content-Type: application/json             â”‚         â”‚
â”‚  â”‚ â””â”€ x-goog-api-key: $GEMINI_API_KEY            â”‚         â”‚
â”‚  â”‚                                               â”‚         â”‚
â”‚  â”‚ Body:                                         â”‚         â”‚
â”‚  â”‚ {                                             â”‚         â”‚
â”‚  â”‚   "contents": [{                              â”‚         â”‚
â”‚  â”‚     "parts": [                                â”‚         â”‚
â”‚  â”‚       {                                       â”‚         â”‚
â”‚  â”‚         "text": "Extract bank statement..."   â”‚         â”‚
â”‚  â”‚       },                                      â”‚         â”‚
â”‚  â”‚       {                                       â”‚         â”‚
â”‚  â”‚         "inlineData": {                       â”‚         â”‚
â”‚  â”‚           "mimeType": "application/pdf",      â”‚         â”‚
â”‚  â”‚           "data": "base64_string_here"        â”‚         â”‚
â”‚  â”‚         }                                     â”‚         â”‚
â”‚  â”‚       }                                       â”‚         â”‚
â”‚  â”‚     ]                                         â”‚         â”‚
â”‚  â”‚   }],                                         â”‚         â”‚
â”‚  â”‚   "generationConfig": {                       â”‚         â”‚
â”‚  â”‚     "temperature": 0.1,                       â”‚         â”‚
â”‚  â”‚     "maxOutputTokens": 4096,                  â”‚         â”‚
â”‚  â”‚     "responseMimeType": "application/json"    â”‚         â”‚
â”‚  â”‚   }                                           â”‚         â”‚
â”‚  â”‚ }                                             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Model Selection:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ gemini-2.5-flash (Default)                 â”‚           â”‚
â”‚  â”‚ â”œâ”€ Speed: 30-60 seconds                    â”‚           â”‚
â”‚  â”‚ â”œâ”€ Cost: $0.0008/extraction                â”‚           â”‚
â”‚  â”‚ â”œâ”€ Accuracy: 95%+                          â”‚           â”‚
â”‚  â”‚ â””â”€ Use: Standard statements                â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ gemini-2.5-pro (Advanced)                  â”‚           â”‚
â”‚  â”‚ â”œâ”€ Speed: 90-180 seconds                   â”‚           â”‚
â”‚  â”‚ â”œâ”€ Cost: $0.013/extraction                 â”‚           â”‚
â”‚  â”‚ â”œâ”€ Accuracy: 98%+                          â”‚           â”‚
â”‚  â”‚ â””â”€ Use: Complex/handwritten statements     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **6. CloudWatch Monitoring**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CLOUDWATCH MONITORING                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Log Groups:                                               â”‚
â”‚  â”œâ”€ /aws/lambda/ProcessCartolaExtraction                  â”‚
â”‚  â”‚   â”œâ”€ Retention: 30 days                                â”‚
â”‚  â”‚   â”œâ”€ Size: ~1MB per 1000 extractions                   â”‚
â”‚  â”‚   â””â”€ Format: JSON structured logs                      â”‚
â”‚  â”œâ”€ /aws/lambda/GetCartolaStatus                          â”‚
â”‚  â””â”€ /aws/lambda/ListUserCartolas                          â”‚
â”‚                                                            â”‚
â”‚  Metrics Dashboard:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ PERFORMANCE METRICS                          â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ â€¢ Invocations (count/min)                    â”‚         â”‚
â”‚  â”‚ â€¢ Duration (avg, p50, p95, p99)              â”‚         â”‚
â”‚  â”‚ â€¢ Errors (count, %)                          â”‚         â”‚
â”‚  â”‚ â€¢ Throttles (count)                          â”‚         â”‚
â”‚  â”‚ â€¢ Concurrent executions (gauge)              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ BUSINESS METRICS                             â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ â€¢ Extractions per day                        â”‚         â”‚
â”‚  â”‚ â€¢ Success rate (%)                           â”‚         â”‚
â”‚  â”‚ â€¢ Average processing time                    â”‚         â”‚
â”‚  â”‚ â€¢ Cost per extraction                        â”‚         â”‚
â”‚  â”‚ â€¢ Movements extracted (total)                â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Alarms (SNS notifications):                               â”‚
â”‚  â”œâ”€ High error rate (>5% in 5 min)                        â”‚
â”‚  â”œâ”€ Long duration (>120s avg)                             â”‚
â”‚  â”œâ”€ High cost (>$10/day)                                  â”‚
â”‚  â”œâ”€ DynamoDB throttling                                   â”‚
â”‚  â””â”€ S3 storage >100GB                                     â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### **Success Flow (Happy Path)**

```
TIME    USER              API GW         LAMBDA          S3       GEMINI      DYNAMO
  â”‚                                                                            
  â”‚ Upload PDF                                                                 
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                                     
  â”‚                      â”‚                                                     
  â”‚                      â”‚ POST /extract                                       
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                      
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚ 1. Create record                    
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   
  â”‚                      â”‚               â”‚                             (status:processing)
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚ 2. Download PDF                     
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                      
  â”‚                      â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      
  â”‚                      â”‚               â”‚ (PDF Buffer)                        
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚ 3. Extract                          
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶               
  â”‚                      â”‚               â”‚                (Base64 PDF)         
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚              (Processing 30-60s)    
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               
  â”‚                      â”‚               â”‚ (JSON result)                       
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚ 4. Validate                         
  â”‚                      â”‚               â”‚ (balance check)                     
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚               â”‚ 5. Save result                      
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   
  â”‚                      â”‚               â”‚                      (status:completed)
  â”‚                      â”‚               â”‚                                     
  â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 6. Return                           
  â”‚                      â”‚ { extractionId, result }                            
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     
  â”‚ { success: true }                                                          
  â”‚                                                                            
  â”‚ Get status                                                                 
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                                     
  â”‚                      â”‚ GET /{id}                                           
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                      
  â”‚                      â”‚               â”‚ Query by id                         
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   
  â”‚                      â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   
  â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ { status, result }                  
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     
  â”‚ Display results                                                            
  â”‚                                                                            
```

### **Error Flow (Failure Path)**

```
TIME    USER              API GW         LAMBDA          GEMINI      DYNAMO
  â”‚                                                                  
  â”‚ Upload invalid PDF                                              
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                                          
  â”‚                      â”‚ POST /extract                            
  â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                            
  â”‚                      â”‚               â”‚ 1. Create record          
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 
  â”‚                      â”‚               â”‚              (processing) 
  â”‚                      â”‚               â”‚                          
  â”‚                      â”‚               â”‚ 2. Extract               
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶     
  â”‚                      â”‚               â”‚          âŒ ERROR         
  â”‚                      â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     
  â”‚                      â”‚               â”‚ (Invalid PDF)            
  â”‚                      â”‚               â”‚                          
  â”‚                      â”‚               â”‚ 3. Handle error          
  â”‚                      â”‚               â”‚ - Log to CloudWatch      
  â”‚                      â”‚               â”‚ - Update DynamoDB        
  â”‚                      â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 
  â”‚                      â”‚               â”‚         (status:failed)  
  â”‚                      â”‚               â”‚         (error details)  
  â”‚                      â”‚               â”‚                          
  â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 4. Return error          
  â”‚                      â”‚ { success: false, error }                
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          
  â”‚ Display error                                                    
  â”‚ "Invalid PDF format"                                             
  â”‚                                                                  
```

---

## ğŸ—ºï¸ Service Comparison: GCP vs AWS

### **1. Compute: Cloud Run â†’ Lambda**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 COMPUTE SERVICE MAPPING                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   GCP: Cloud Run     â”‚   AWS: Lambda + API Gateway          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ HTTP Server          â”‚ Event-driven handler                 â”‚
â”‚ â”œâ”€ Express/Astro     â”‚ â”œâ”€ exports.handler = async (event)   â”‚
â”‚ â”œâ”€ app.listen(3000)  â”‚ â”œâ”€ Parse event.body                  â”‚
â”‚ â””â”€ Continuous run    â”‚ â””â”€ Return response object            â”‚
â”‚                      â”‚                                      â”‚
â”‚ Scaling              â”‚ Scaling                              â”‚
â”‚ â”œâ”€ Min instances: 1  â”‚ â”œâ”€ Min instances: 0                  â”‚
â”‚ â”œâ”€ Max instances: 10 â”‚ â”œâ”€ Max concurrent: 1000              â”‚
â”‚ â””â”€ CPU based         â”‚ â””â”€ Request based                     â”‚
â”‚                      â”‚                                      â”‚
â”‚ Billing              â”‚ Billing                              â”‚
â”‚ â”œâ”€ Per second        â”‚ â”œâ”€ Per 100ms                         â”‚
â”‚ â”œâ”€ Always running    â”‚ â”œâ”€ Only when invoked                 â”‚
â”‚ â””â”€ $25-50/month min  â”‚ â””â”€ $0 when idle                      â”‚
â”‚                      â”‚                                      â”‚
â”‚ Timeout              â”‚ Timeout                              â”‚
â”‚ â””â”€ 60 minutes        â”‚ â””â”€ 15 minutes max                    â”‚
â”‚                      â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CODE CHANGES:
â”œâ”€ Entry point: app.listen() â†’ exports.handler
â”œâ”€ Request: req.body â†’ JSON.parse(event.body)
â”œâ”€ Response: res.json() â†’ return { statusCode, body }
â””â”€ Middleware: None â†’ Manual auth/validation
```

### **2. Storage: Cloud Storage â†’ S3**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  STORAGE SERVICE MAPPING                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GCP: Cloud Storage   â”‚ AWS: S3                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ Upload                                                      â”‚
â”‚ const bucket =        â”‚ const s3 = new AWS.S3();            â”‚
â”‚   storage.bucket(     â”‚ await s3.putObject({                â”‚
â”‚     'bucket-name'     â”‚   Bucket: 'bucket-name',            â”‚
â”‚   );                  â”‚   Key: 'path/file.pdf',             â”‚
â”‚ await bucket          â”‚   Body: buffer,                     â”‚
â”‚   .file('path')       â”‚   ServerSideEncryption: 'AES256'    â”‚
â”‚   .save(buffer);      â”‚ }).promise();                       â”‚
â”‚                       â”‚                                     â”‚
â”‚ Download              â”‚                                     â”‚
â”‚ const [data] =        â”‚ const result =                      â”‚
â”‚   await bucket        â”‚   await s3.getObject({              â”‚
â”‚     .file('path')     â”‚     Bucket: 'bucket-name',          â”‚
â”‚     .download();      â”‚     Key: 'path/file.pdf'            â”‚
â”‚ const buffer = data;  â”‚   }).promise();                     â”‚
â”‚                       â”‚ const buffer = result.Body;         â”‚
â”‚                       â”‚                                     â”‚
â”‚ Signed URLs           â”‚                                     â”‚
â”‚ const [url] =         â”‚ const url = s3.getSignedUrl(        â”‚
â”‚   await bucket        â”‚   'getObject', {                    â”‚
â”‚     .file('path')     â”‚     Bucket: 'bucket-name',          â”‚
â”‚     .getSignedUrl({   â”‚     Key: 'path/file.pdf',           â”‚
â”‚       expires:        â”‚     Expires: 604800  // 7 days      â”‚
â”‚         Date.now() +  â”‚   }                                 â”‚
â”‚         7*24*60*60*ms â”‚ );                                  â”‚
â”‚     });               â”‚                                     â”‚
â”‚                       â”‚                                     â”‚
â”‚ Lifecycle             â”‚ Lifecycle                           â”‚
â”‚ â”œâ”€ Age: 7 days        â”‚ â”œâ”€ Expiration: 7 days               â”‚
â”‚ â””â”€ Action: Delete     â”‚ â””â”€ Action: Delete                   â”‚
â”‚                       â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CODE CHANGES:
â”œâ”€ Import: @google-cloud/storage â†’ aws-sdk (S3)
â”œâ”€ Init: new Storage() â†’ new AWS.S3()
â”œâ”€ Upload: .save() â†’ .putObject().promise()
â”œâ”€ Download: .download() â†’ .getObject().promise()
â””â”€ URLs: .getSignedUrl() â†’ .getSignedUrl('getObject')
```

### **3. Database: Firestore â†’ DynamoDB**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DATABASE SERVICE MAPPING                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GCP: Firestore       â”‚ AWS: DynamoDB                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ Create Document                                             â”‚
â”‚ const ref =           â”‚ const id = generateId();            â”‚
â”‚   firestore           â”‚ await dynamoDB.put({                â”‚
â”‚   .collection('extr') â”‚   TableName: 'extractions',         â”‚
â”‚   .doc();             â”‚   Item: {                           â”‚
â”‚ await ref.set({       â”‚     id: id,                         â”‚
â”‚   id: ref.id,         â”‚     userId: 'user-123',             â”‚
â”‚   userId: 'user-123', â”‚     status: 'pending',              â”‚
â”‚   status: 'pending',  â”‚     createdAt: Date.now(),          â”‚
â”‚   createdAt: new Date â”‚     ttl: Math.floor(Date.now()/1000)â”‚
â”‚ });                   â”‚       + (90*24*60*60)               â”‚
â”‚                       â”‚   }                                 â”‚
â”‚                       â”‚ }).promise();                       â”‚
â”‚                       â”‚                                     â”‚
â”‚ Query by Field        â”‚                                     â”‚
â”‚ const snapshot =      â”‚ const result =                      â”‚
â”‚   await firestore     â”‚   await dynamoDB.query({            â”‚
â”‚     .collection('ex') â”‚     TableName: 'extractions',       â”‚
â”‚     .where('userId',  â”‚     IndexName: 'userId-index',      â”‚
â”‚       '==', userId)   â”‚     KeyConditionExpression:         â”‚
â”‚     .orderBy(         â”‚       'userId = :userId',           â”‚
â”‚       'createdAt',    â”‚     ExpressionAttributeValues: {    â”‚
â”‚       'desc')         â”‚       ':userId': userId             â”‚
â”‚     .limit(50)        â”‚     },                              â”‚
â”‚     .get();           â”‚     ScanIndexForward: false,        â”‚
â”‚ const items =         â”‚     Limit: 50                       â”‚
â”‚   snapshot.docs.map(  â”‚   }).promise();                     â”‚
â”‚     doc => doc.data() â”‚ const items = result.Items;         â”‚
â”‚   );                  â”‚                                     â”‚
â”‚                       â”‚                                     â”‚
â”‚ Update Document       â”‚                                     â”‚
â”‚ await firestore       â”‚ await dynamoDB.update({             â”‚
â”‚   .collection('ex')   â”‚   TableName: 'extractions',         â”‚
â”‚   .doc(id)            â”‚   Key: { id: id },                  â”‚
â”‚   .update({           â”‚   UpdateExpression:                 â”‚
â”‚     status:           â”‚     'SET #status = :status',        â”‚
â”‚       'completed',    â”‚   ExpressionAttributeNames: {       â”‚
â”‚     result: data      â”‚     '#status': 'status'             â”‚
â”‚   });                 â”‚   },                                â”‚
â”‚                       â”‚   ExpressionAttributeValues: {      â”‚
â”‚                       â”‚     ':status': 'completed'          â”‚
â”‚                       â”‚   }                                 â”‚
â”‚                       â”‚ }).promise();                       â”‚
â”‚                       â”‚                                     â”‚
â”‚ Data Model            â”‚ Data Model                          â”‚
â”‚ â”œâ”€ Collections        â”‚ â”œâ”€ Tables                           â”‚
â”‚ â”œâ”€ Documents          â”‚ â”œâ”€ Items                            â”‚
â”‚ â”œâ”€ Timestamps (Date)  â”‚ â”œâ”€ Numbers (epoch ms)               â”‚
â”‚ â””â”€ Auto-indexing      â”‚ â””â”€ Manual indexes (GSI)             â”‚
â”‚                       â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CODE CHANGES:
â”œâ”€ Import: @google-cloud/firestore â†’ aws-sdk (DynamoDB)
â”œâ”€ Init: new Firestore() â†’ new AWS.DynamoDB.DocumentClient()
â”œâ”€ Create: .doc().set() â†’ .put({ Item })
â”œâ”€ Query: .where().get() â†’ .query({ KeyConditionExpression })
â”œâ”€ Update: .doc().update() â†’ .update({ Key, UpdateExpression })
â”œâ”€ Timestamps: Date objects â†’ Epoch milliseconds
â””â”€ Indexes: Auto â†’ Manual GSI creation required
```

---

## ğŸ” Security Architecture

### **Authentication & Authorization**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SECURITY LAYERS                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  Layer 1: API Gateway Authentication                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Option A: API Keys                           â”‚         â”‚
â”‚  â”‚ â”œâ”€ Usage Plan: 100 req/min                   â”‚         â”‚
â”‚  â”‚ â”œâ”€ Rotation: 90 days                         â”‚         â”‚
â”‚  â”‚ â””â”€ Per-client keys                           â”‚         â”‚
â”‚  â”‚                                              â”‚         â”‚
â”‚  â”‚ Option B: AWS Cognito                        â”‚         â”‚
â”‚  â”‚ â”œâ”€ User Pool                                 â”‚         â”‚
â”‚  â”‚ â”œâ”€ OAuth 2.0 / JWT                           â”‚         â”‚
â”‚  â”‚ â””â”€ Built-in user management                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Layer 2: Lambda Execution Role (IAM)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Permissions (Least Privilege):               â”‚         â”‚
â”‚  â”‚ â”œâ”€ S3: GetObject, PutObject on bucket only   â”‚         â”‚
â”‚  â”‚ â”œâ”€ DynamoDB: PutItem, GetItem, Query, Update â”‚         â”‚
â”‚  â”‚ â”œâ”€ CloudWatch: CreateLogGroup, PutLogEvents  â”‚         â”‚
â”‚  â”‚ â””â”€ NO admin or wildcard permissions          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Layer 3: Resource Policies                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ S3 Bucket Policy:                            â”‚         â”‚
â”‚  â”‚ â”œâ”€ Block all public access                   â”‚         â”‚
â”‚  â”‚ â”œâ”€ Allow Lambda role only                    â”‚         â”‚
â”‚  â”‚ â””â”€ Deny unencrypted uploads                  â”‚         â”‚
â”‚  â”‚                                              â”‚         â”‚
â”‚  â”‚ DynamoDB:                                    â”‚         â”‚
â”‚  â”‚ â”œâ”€ Fine-grained access control               â”‚         â”‚
â”‚  â”‚ â””â”€ Item-level permissions (future)           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Layer 4: Data Encryption                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ At Rest:                                     â”‚         â”‚
â”‚  â”‚ â”œâ”€ S3: AES-256 (SSE-S3)                      â”‚         â”‚
â”‚  â”‚ â”œâ”€ DynamoDB: AWS-managed KMS                 â”‚         â”‚
â”‚  â”‚ â””â”€ Lambda env vars: KMS encrypted            â”‚         â”‚
â”‚  â”‚                                              â”‚         â”‚
â”‚  â”‚ In Transit:                                  â”‚         â”‚
â”‚  â”‚ â”œâ”€ HTTPS only (TLS 1.2+)                     â”‚         â”‚
â”‚  â”‚ â”œâ”€ API Gateway enforces HTTPS                â”‚         â”‚
â”‚  â”‚ â””â”€ Gemini AI: HTTPS                          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  Layer 5: Audit & Compliance                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ CloudWatch Logs:                             â”‚         â”‚
â”‚  â”‚ â”œâ”€ All API calls logged                      â”‚         â”‚
â”‚  â”‚ â”œâ”€ Authentication events                     â”‚         â”‚
â”‚  â”‚ â”œâ”€ Error events                              â”‚         â”‚
â”‚  â”‚ â””â”€ Retention: 30 days                        â”‚         â”‚
â”‚  â”‚                                              â”‚         â”‚
â”‚  â”‚ CloudTrail:                                  â”‚         â”‚
â”‚  â”‚ â”œâ”€ AWS API calls tracked                     â”‚         â”‚
â”‚  â”‚ â”œâ”€ IAM changes logged                        â”‚         â”‚
â”‚  â”‚ â””â”€ Compliance reporting                      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Scalability & Performance

### **Auto-Scaling Behavior**

```
LOAD                    LAMBDA BEHAVIOR
  â”‚
100 req/s  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      â”‚ 100 concurrent executions       â”‚
  â”‚                      â”‚ (within limit)                  â”‚
  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚
10 req/s   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      â”‚ 10 concurrent executions        â”‚
  â”‚                      â”‚ (scaled down automatically)     â”‚
  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚
0 req/s    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                      â”‚ 0 running instances             â”‚
  â”‚                      â”‚ $0 cost (truly serverless)      â”‚
  â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
                                                        TIME

Cold Start Mitigation:
â”œâ”€ Provisioned concurrency (optional, $$$)
â”œâ”€ Pre-warmed containers (AWS manages)
â””â”€ Typical cold start: 1-3 seconds
```

### **Performance Benchmarks**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PERFORMANCE TARGETS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ METRIC           â”‚ TARGET       â”‚ ACTUAL (GCP Baseline)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Response     â”‚ <3s (p95)    â”‚ <2s (async pattern)       â”‚
â”‚ PDF Download     â”‚ <5s          â”‚ <3s (depends on size)     â”‚
â”‚ Gemini Extract   â”‚ <60s (Flash) â”‚ 30-60s âœ…                 â”‚
â”‚ JSON Validation  â”‚ <1s          â”‚ <500ms âœ…                 â”‚
â”‚ DB Write         â”‚ <100ms       â”‚ <50ms (DynamoDB)          â”‚
â”‚ Total E2E        â”‚ <120s (p95)  â”‚ 58s avg âœ…                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Throughput       â”‚ 100 req/min  â”‚ Unlimited (Lambda scales) â”‚
â”‚ Concurrent       â”‚ 100          â”‚ 100 (configurable)        â”‚
â”‚ Success Rate     â”‚ >99%         â”‚ 100% in tests âœ…          â”‚
â”‚ Accuracy         â”‚ >95%         â”‚ 95%+ âœ…                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Model

### **DynamoDB Schema**

```
Table: cartola_extractions
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Partition Key: id (String)                                 â”‚
â”‚ Example: "ext_1700000000000_abc123def456"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Sample Item:
{
  // Identity
  "id": "ext_1700000000000_abc123",
  "userId": "user-alec-123",
  "organizationId": "org-salfa-corp",
  
  // File metadata
  "fileName": "banco-chile-oct-2024.pdf",
  "fileSize": 524288,
  "s3Key": "user-alec-123/2024-10/banco-chile.pdf",
  "bankName": "Banco de Chile",
  
  // Processing
  "status": "completed",  // pending|processing|completed|failed
  "model": "gemini-2.5-flash",
  "processingTime": 58234,  // milliseconds
  
  // Results
  "extractionResult": {
    "document_id": "doc_abc123",
    "bank_name": "Banco de Chile",
    "account_number": "000484021004",
    "account_holder": "Gino Ramirez",
    "movements": [
      {
        "id": "mov_001",
        "amount": -50000,
        "description": "Transferencia",
        "balance": 2210904
      }
      // ... more movements
    ],
    "balance_validation": {
      "coincide": true,
      "diferencia": 0
    }
  },
  
  // Metrics
  "inputTokens": 12500,
  "outputTokens": 3200,
  "cost": 0.0008,
  
  // Timestamps (epoch milliseconds)
  "createdAt": 1700000000000,
  "updatedAt": 1700000058234,
  "completedAt": 1700000058234,
  
  // TTL (auto-deletion after 90 days)
  "ttl": 1707776000  // epoch seconds
}
```

### **Global Secondary Indexes**

```
GSI 1: userId-createdAt-index
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Partition Key: userId (String)                             â”‚
â”‚ Sort Key: createdAt (Number)                               â”‚
â”‚ Projection: ALL                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Use Case: "Get all extractions for user-123"
Query: userId = "user-123" ORDER BY createdAt DESC LIMIT 50

GSI 2: organizationId-createdAt-index
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Partition Key: organizationId (String)                     â”‚
â”‚ Sort Key: createdAt (Number)                               â”‚
â”‚ Projection: ALL                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Use Case: "Get all extractions for Salfa Corp"
Query: organizationId = "org-salfa-corp"

GSI 3: status-createdAt-index
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Partition Key: status (String)                             â”‚
â”‚ Sort Key: createdAt (Number)                               â”‚
â”‚ Projection: ALL                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Use Case: "Get all failed extractions"
Query: status = "failed" ORDER BY createdAt DESC
```

---

## ğŸŒŠ Detailed Flow Diagrams

### **Upload & Extraction Flow**

```
STEP 1: UPLOAD TO S3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client                                                     â”‚
â”‚   â”œâ”€ Select PDF file                                      â”‚
â”‚   â”œâ”€ Generate pre-signed POST URL (optional)              â”‚
â”‚   â””â”€ Upload to S3: user-123/cartola-oct-2024.pdf         â”‚
â”‚                                                            â”‚
â”‚ S3                                                         â”‚
â”‚   â”œâ”€ Receive file                                         â”‚
â”‚   â”œâ”€ Encrypt with AES-256                                 â”‚
â”‚   â”œâ”€ Store in bucket                                      â”‚
â”‚   â””â”€ Return success                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: TRIGGER EXTRACTION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client                                                     â”‚
â”‚   â””â”€ POST /cartola/extract                                â”‚
â”‚       Body: {                                              â”‚
â”‚         "s3Key": "user-123/cartola-oct-2024.pdf",         â”‚
â”‚         "userId": "user-123",                             â”‚
â”‚         "bankName": "Banco de Chile"                      â”‚
â”‚       }                                                    â”‚
â”‚                                                            â”‚
â”‚ API Gateway                                                â”‚
â”‚   â”œâ”€ Validate API key                                     â”‚
â”‚   â”œâ”€ Check rate limit                                     â”‚
â”‚   â”œâ”€ Validate request schema                              â”‚
â”‚   â””â”€ Invoke Lambda (async)                                â”‚
â”‚                                                            â”‚
â”‚ Lambda                                                     â”‚
â”‚   â”œâ”€ Parse event                                          â”‚
â”‚   â”œâ”€ Generate extractionId                                â”‚
â”‚   â””â”€ Return immediately:                                  â”‚
â”‚       { extractionId, status: "processing" }              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: ASYNC PROCESSING
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambda (background)                                        â”‚
â”‚   â”œâ”€ Create DynamoDB record (status: processing)          â”‚
â”‚   â”œâ”€ Download PDF from S3                                 â”‚
â”‚   â”œâ”€ Encode to Base64                                     â”‚
â”‚   â”œâ”€ Call Gemini AI                                       â”‚
â”‚   â”‚   â”œâ”€ Send PDF + extraction prompt                     â”‚
â”‚   â”‚   â””â”€ Wait for response (30-60s)                       â”‚
â”‚   â”œâ”€ Parse JSON response                                  â”‚
â”‚   â”œâ”€ Validate balance equation                            â”‚
â”‚   â”œâ”€ Calculate quality metrics                            â”‚
â”‚   â””â”€ Update DynamoDB (status: completed)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: POLL FOR RESULTS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client (polling every 5 seconds)                           â”‚
â”‚   â””â”€ GET /cartola/{extractionId}                          â”‚
â”‚                                                            â”‚
â”‚ Lambda: GetCartolaStatus                                   â”‚
â”‚   â”œâ”€ Query DynamoDB by id                                 â”‚
â”‚   â””â”€ Return current status + result (if complete)         â”‚
â”‚                                                            â”‚
â”‚ Client                                                     â”‚
â”‚   â”œâ”€ If status = "processing": Continue polling           â”‚
â”‚   â”œâ”€ If status = "completed": Display results             â”‚
â”‚   â””â”€ If status = "failed": Display error                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Deployment Architecture

### **Infrastructure as Code (Serverless Framework)**

```
serverless.yml
â”œâ”€ Service Definition
â”‚  â”œâ”€ name: nubox-cartola-extraction
â”‚  â”œâ”€ provider: aws
â”‚  â””â”€ runtime: nodejs20.x
â”‚
â”œâ”€ Functions
â”‚  â”œâ”€ processCartola
â”‚  â”‚  â”œâ”€ handler: lambda/handler.processCartola
â”‚  â”‚  â”œâ”€ events: [http POST /cartola/extract]
â”‚  â”‚  â”œâ”€ timeout: 900s
â”‚  â”‚  â””â”€ memory: 2048MB
â”‚  â”œâ”€ getStatus
â”‚  â”‚  â””â”€ events: [http GET /cartola/{id}]
â”‚  â””â”€ listCartolas
â”‚     â””â”€ events: [http GET /cartola/list]
â”‚
â”œâ”€ Resources (CloudFormation)
â”‚  â”œâ”€ S3 Bucket
â”‚  â”‚  â”œâ”€ BucketName: ${custom.s3Bucket}
â”‚  â”‚  â”œâ”€ Encryption: AES256
â”‚  â”‚  â””â”€ LifecycleConfiguration: 7 days
â”‚  â””â”€ DynamoDB Table
â”‚     â”œâ”€ TableName: ${custom.dynamoTable}
â”‚     â”œâ”€ BillingMode: PAY_PER_REQUEST
â”‚     â”œâ”€ GlobalSecondaryIndexes: [3 indexes]
â”‚     â””â”€ TimeToLiveSpecification: Enabled
â”‚
â””â”€ IAM Permissions
   â”œâ”€ S3: GetObject, PutObject
   â”œâ”€ DynamoDB: PutItem, Query, Update
   â””â”€ CloudWatch: Logs
```

### **Deployment Process**

```
DEVELOPER MACHINE
   â”‚
   â”‚ 1. serverless deploy --stage prod
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                         â”‚
   â–¼                                         â–¼
PACKAGE CODE                         CREATE CHANGE SET
â”œâ”€ npm install                       â”œâ”€ Parse serverless.yml
â”œâ”€ Zip function code                 â”œâ”€ Generate CloudFormation
â””â”€ Include node_modules              â””â”€ Validate template
   â”‚                                         â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                         â”‚
   â–¼                                         â–¼
UPLOAD TO S3                         DEPLOY STACK
â”œâ”€ Deployment bucket                 â”œâ”€ Create S3 bucket
â”œâ”€ function.zip                      â”œâ”€ Create DynamoDB table
â””â”€ template.json                     â”œâ”€ Create Lambda functions
   â”‚                                 â”œâ”€ Create API Gateway
   â”‚                                 â””â”€ Create IAM roles
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                         â”‚
   â–¼                                         â–¼
UPDATE LAMBDA                        CONFIGURE API GW
â”œâ”€ Upload new code                   â”œâ”€ Create resources
â”œâ”€ Update env vars                   â”œâ”€ Create methods
â””â”€ Publish version                   â”œâ”€ Deploy to stage
   â”‚                                 â””â”€ Get invoke URL
   â”‚                                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ DEPLOYMENT DONE â”‚
           â”‚ API URL ready   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° Cost Architecture

### **Cost Breakdown by Component**

```
PER 1,000 EXTRACTIONS/MONTH
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚  Lambda Execution (2GB, 60s avg)                          â”‚
â”‚  â”œâ”€ Requests: 1,000 Ã— $0.0000002 = $0.0002                â”‚
â”‚  â”œâ”€ Duration: 1,000 Ã— 2GB Ã— 60s = 120,000 GB-seconds      â”‚
â”‚  â”‚   Cost: 120,000 Ã— $0.0000166667 = $0.02                â”‚
â”‚  â””â”€ Subtotal: $0.02                                       â”‚
â”‚                                                            â”‚
â”‚  S3 Storage (7-day retention)                             â”‚
â”‚  â”œâ”€ Storage: ~500MB avg Ã— 7 days â‰ˆ 3.5GB-days            â”‚
â”‚  â”‚   Cost: 3.5GB Ã— $0.023/GB = $0.08                      â”‚
â”‚  â”œâ”€ PUT requests: 1,000 Ã— $0.000005 = $0.005              â”‚
â”‚  â”œâ”€ GET requests: 1,000 Ã— $0.0000004 = $0.0004            â”‚
â”‚  â””â”€ Subtotal: $0.09                                       â”‚
â”‚                                                            â”‚
â”‚  DynamoDB (On-Demand)                                      â”‚
â”‚  â”œâ”€ Writes: 2,000 Ã— $1.25/million = $0.0025               â”‚
â”‚  â”‚   (2 writes per extraction: create + update)           â”‚
â”‚  â”œâ”€ Reads: 1,000 Ã— $0.25/million = $0.00025               â”‚
â”‚  â”‚   (status checks)                                      â”‚
â”‚  â”œâ”€ Storage: ~10MB Ã— $0.25/GB = $0.0025                   â”‚
â”‚  â””â”€ Subtotal: $0.005                                      â”‚
â”‚                                                            â”‚
â”‚  Gemini AI (External)                                      â”‚
â”‚  â”œâ”€ Model: gemini-2.5-flash                               â”‚
â”‚  â”œâ”€ Input: ~12,500 tokens avg Ã— $0.075/1M = $0.0009       â”‚
â”‚  â”‚   (per extraction)                                     â”‚
â”‚  â”œâ”€ Output: ~3,200 tokens avg Ã— $0.30/1M = $0.001         â”‚
â”‚  â”‚   (per extraction)                                     â”‚
â”‚  â”œâ”€ Total per extraction: $0.002                          â”‚
â”‚  â””â”€ 1,000 extractions: $0.80                              â”‚
â”‚                                                            â”‚
â”‚  API Gateway                                               â”‚
â”‚  â”œâ”€ Requests: 1,000 Ã— $0.0000035 = $0.0035                â”‚
â”‚  â””â”€ Data transfer: Minimal (JSON responses)               â”‚
â”‚     Cost: <$0.01                                          â”‚
â”‚                                                            â”‚
â”‚  CloudWatch Logs                                           â”‚
â”‚  â”œâ”€ Ingestion: ~10MB Ã— $0.50/GB = $0.005                  â”‚
â”‚  â”œâ”€ Storage: 30 days retention â‰ˆ $0.01                    â”‚
â”‚  â””â”€ Subtotal: $0.015                                      â”‚
â”‚                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TOTAL COST PER 1,000 EXTRACTIONS: ~$0.93                 â”‚
â”‚                                                            â”‚
â”‚  Cost per extraction: $0.00093 â‰ˆ $0.001                   â”‚
â”‚                                                            â”‚
â”‚  (Gemini AI = 86% of total cost)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Comparison: GCP vs AWS**

```
COST COMPARISON (1,000 extractions/month)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVICE            â”‚  GCP COST    â”‚  AWS COST    â”‚ SAVINGS â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Compute (Fixed)    â”‚  $40-50      â”‚  $0          â”‚ $40-50  â”‚
â”‚ Compute (Variable) â”‚  $0.02       â”‚  $0.02       â”‚ $0      â”‚
â”‚ Storage            â”‚  $0.05       â”‚  $0.09       â”‚ -$0.04  â”‚
â”‚ Database           â”‚  $0.10       â”‚  $0.01       â”‚ $0.09   â”‚
â”‚ AI (Gemini)        â”‚  $0.80       â”‚  $0.80       â”‚ $0      â”‚
â”‚ Monitoring         â”‚  $0.02       â”‚  $0.02       â”‚ $0      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL              â”‚  $40-51      â”‚  $0.94       â”‚ $39-50  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MONTHLY SAVINGS: $39-50 (95% reduction)
BREAK-EVEN: Immediate (first month)
ROI: Infinite (no migration cost if using existing code)
```

---

## ğŸ”Œ Integration Points

### **1. Nubox Frontend Integration**

```javascript
// Upload PDF to S3 (pre-signed URL)
const uploadUrl = await fetch('/api/get-upload-url', {
  method: 'POST',
  body: JSON.stringify({ fileName: 'cartola.pdf' })
}).then(r => r.json());

await fetch(uploadUrl.url, {
  method: 'PUT',
  body: pdfFile,
  headers: { 'Content-Type': 'application/pdf' }
});

// Trigger extraction
const extraction = await fetch('https://api-url/cartola/extract', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': 'your-api-key'
  },
  body: JSON.stringify({
    s3Key: uploadUrl.key,
    userId: currentUser.id,
    bankName: 'Banco de Chile'
  })
}).then(r => r.json());

// Poll for results
const checkStatus = async (extractionId) => {
  const result = await fetch(`https://api-url/cartola/${extractionId}`, {
    headers: { 'x-api-key': 'your-api-key' }
  }).then(r => r.json());
  
  if (result.status === 'completed') {
    displayResults(result.extractionResult);
  } else if (result.status === 'processing') {
    setTimeout(() => checkStatus(extractionId), 5000); // Poll every 5s
  } else if (result.status === 'failed') {
    displayError(result.error);
  }
};

checkStatus(extraction.extractionId);
```

### **2. Webhook Integration (Optional)**

```
Lambda â†’ External System (when extraction completes)

POST https://your-app.com/webhook/cartola-complete
Headers:
  Content-Type: application/json
  X-Signature: HMAC-SHA256(payload, secret)

Body:
{
  "event": "extraction.completed",
  "extractionId": "ext_xxx",
  "userId": "user-123",
  "status": "completed",
  "result": {
    "movements": 10,
    "balanceValidated": true
  },
  "timestamp": "2024-11-27T10:00:00Z"
}
```

---

## ğŸ§ª Testing Architecture

### **Test Pyramid**

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   E2E TESTS         â”‚
                    â”‚   (AWS Deployed)    â”‚
                    â”‚   â€¢ Real PDFs       â”‚
                    â”‚   â€¢ Full flow       â”‚
                    â”‚   â€¢ 5 tests         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ (Slow, Expensive)
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   INTEGRATION TESTS            â”‚
              â”‚   (Local + AWS)                â”‚
              â”‚   â€¢ Lambda handlers            â”‚
              â”‚   â€¢ S3 operations              â”‚
              â”‚   â€¢ DynamoDB queries           â”‚
              â”‚   â€¢ 20 tests                   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ (Medium Speed/Cost)
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   UNIT TESTS                               â”‚
        â”‚   (Pure functions)                         â”‚
        â”‚   â€¢ JSON parsing                           â”‚
        â”‚   â€¢ Validation logic                       â”‚
        â”‚   â€¢ Balance calculations                   â”‚
        â”‚   â€¢ Prompt building                        â”‚
        â”‚   â€¢ 50+ tests                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ (Fast, Cheap)
```

### **Test Environments**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENVIRONMENT        â”‚ PURPOSE           â”‚ STACK              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Local              â”‚ Development       â”‚ Node.js only       â”‚
â”‚ â”œâ”€ No AWS          â”‚ Fast iteration    â”‚ Mock S3/DynamoDB   â”‚
â”‚ â””â”€ Real Gemini     â”‚ Test extraction   â”‚ Real API           â”‚
â”‚                    â”‚                   â”‚                    â”‚
â”‚ AWS Dev            â”‚ Integration test  â”‚ Full AWS stack     â”‚
â”‚ â”œâ”€ Dev account     â”‚ Team testing      â”‚ Separate resources â”‚
â”‚ â””â”€ Test data       â”‚ No production     â”‚ Auto-cleanup       â”‚
â”‚                    â”‚                   â”‚                    â”‚
â”‚ AWS Staging        â”‚ Pre-production    â”‚ Production-like    â”‚
â”‚ â”œâ”€ Isolated        â”‚ Final validation  â”‚ Same config        â”‚
â”‚ â””â”€ Real bank PDFs  â”‚ Performance test  â”‚ Lower limits       â”‚
â”‚                    â”‚                   â”‚                    â”‚
â”‚ AWS Production     â”‚ Live system       â”‚ Full production    â”‚
â”‚ â”œâ”€ Prod account    â”‚ Real users        â”‚ High availability  â”‚
â”‚ â””â”€ Real data       â”‚ SLA: 99.9%        â”‚ Monitoring         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Monitoring & Observability

### **CloudWatch Dashboard Layout**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              NUBOX CARTOLA OPERATIONS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ INVOCATIONS  â”‚  â”‚   ERRORS     â”‚  â”‚  DURATION    â”‚    â”‚
â”‚  â”‚   1,234      â”‚  â”‚    2 (0.1%)  â”‚  â”‚  58s avg     â”‚    â”‚
â”‚  â”‚  â†‘ 15%       â”‚  â”‚  âœ… Normal   â”‚  â”‚  âœ… On targetâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ INVOCATIONS GRAPH (Last 24h)                 â”‚         â”‚
â”‚  â”‚  100 â”¤                                        â”‚         â”‚
â”‚  â”‚   80 â”¤         â•­â”€â•®                            â”‚         â”‚
â”‚  â”‚   60 â”¤      â•­â”€â”€â•¯ â•°â”€â•®                          â”‚         â”‚
â”‚  â”‚   40 â”¤   â•­â”€â”€â•¯      â•°â”€â”€â•®                       â”‚         â”‚
â”‚  â”‚   20 â”¤â•­â”€â”€â•¯            â•°â”€â”€â”€â•®                   â”‚         â”‚
â”‚  â”‚    0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚         â”‚
â”‚  â”‚      0h    6h    12h   18h   24h              â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ DURATION PERCENTILES                         â”‚         â”‚
â”‚  â”‚  p50: 55s  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘            â”‚         â”‚
â”‚  â”‚  p90: 65s  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘          â”‚         â”‚
â”‚  â”‚  p95: 75s  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘           â”‚         â”‚
â”‚  â”‚  p99: 95s  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SUCCESS RATE        â”‚  â”‚ COST TODAY         â”‚          â”‚
â”‚  â”‚   99.8%             â”‚  â”‚   $0.94            â”‚          â”‚
â”‚  â”‚   âœ… Excellent      â”‚  â”‚   On budget        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¨ Error Handling & Resilience

### **Failure Scenarios**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SCENARIO               â”‚ DETECTION          â”‚ RECOVERY      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Invalid PDF            â”‚ Lambda validates   â”‚ Return 400    â”‚
â”‚                        â”‚ size/format        â”‚ User notified â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ Gemini API timeout     â”‚ Lambda timeout     â”‚ Retry once    â”‚
â”‚                        â”‚ (900s max)         â”‚ Then fail     â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ Gemini API quota       â”‚ 429 response       â”‚ Exponential   â”‚
â”‚ exceeded               â”‚                    â”‚ backoff       â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ S3 unavailable         â”‚ SDK error          â”‚ Lambda fails  â”‚
â”‚                        â”‚                    â”‚ CloudWatch    â”‚
â”‚                        â”‚                    â”‚ alarm         â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ DynamoDB throttling    â”‚ SDK error          â”‚ Auto-retry    â”‚
â”‚                        â”‚                    â”‚ (AWS SDK)     â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ Invalid JSON from AI   â”‚ JSON.parse error   â”‚ Log + fail    â”‚
â”‚                        â”‚                    â”‚ gracefully    â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ Balance mismatch       â”‚ Validation check   â”‚ Flag in       â”‚
â”‚                        â”‚                    â”‚ quality field â”‚
â”‚                        â”‚                    â”‚               â”‚
â”‚ Lambda out of memory   â”‚ Runtime crash      â”‚ Increase      â”‚
â”‚                        â”‚                    â”‚ memory to 3GB â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Retry Strategy:
â”œâ”€ Gemini API: 1 retry with 30s delay
â”œâ”€ S3: AWS SDK handles retries
â”œâ”€ DynamoDB: AWS SDK handles retries
â””â”€ Max total retries: 3
```

---

## ğŸ”„ Migration Strategy

### **Phase 1: Infrastructure Setup (Week 1)**

```
Day 1-2: AWS Account Setup
â”œâ”€ Create AWS account (or use existing)
â”œâ”€ Configure IAM users/roles
â”œâ”€ Set up billing alerts
â””â”€ Install AWS CLI

Day 3-4: Deploy Infrastructure
â”œâ”€ Create S3 bucket
â”œâ”€ Create DynamoDB table
â”œâ”€ Create Lambda functions (empty shells)
â”œâ”€ Create API Gateway
â””â”€ Verify infrastructure

Day 5: Testing Infrastructure
â”œâ”€ Upload test PDF to S3
â”œâ”€ Invoke Lambda manually
â”œâ”€ Query DynamoDB
â””â”€ Test API Gateway
```

### **Phase 2: Code Migration (Week 2)**

```
Day 1-2: Adapt Code
â”œâ”€ Copy extraction logic (100% reusable)
â”œâ”€ Adapt storage calls (GCS â†’ S3)
â”œâ”€ Adapt database calls (Firestore â†’ DynamoDB)
â””â”€ Create Lambda handlers

Day 3-4: Unit Testing
â”œâ”€ Test extraction logic
â”œâ”€ Test validation logic
â”œâ”€ Test error handling
â””â”€ Code coverage >80%

Day 5: Integration Testing
â”œâ”€ Deploy to AWS dev environment
â”œâ”€ Test with real PDFs
â”œâ”€ Verify results match GCP
â””â”€ Performance benchmarking
```

### **Phase 3: Production Deployment (Week 3)**

```
Day 1-2: Staging Validation
â”œâ”€ Deploy to AWS staging
â”œâ”€ Test with production-like data
â”œâ”€ Load testing
â””â”€ Security audit

Day 3: Production Deploy
â”œâ”€ Deploy to AWS production
â”œâ”€ Monitor closely (24h)
â”œâ”€ Compare with GCP baseline
â””â”€ Validate costs

Day 4-5: Parallel Operation
â”œâ”€ Run both GCP + AWS
â”œâ”€ Compare results
â”œâ”€ Migrate traffic gradually
â””â”€ Decommission GCP (after 7 days)
```

---

## ğŸ¯ Success Criteria

### **Functional Requirements**

```
âœ… Can upload PDF to S3
âœ… Lambda extracts all movements correctly (95%+ accuracy)
âœ… Balance validation passes (difference = 0)
âœ… Results saved to DynamoDB with proper TTL
âœ… API returns Nubox-compatible JSON
âœ… Handles 7+ Chilean bank formats
âœ… Error handling for all failure scenarios
âœ… Webhook notifications working (optional)
```

### **Performance Requirements**

```
âœ… Processing time < 120s (p95)
âœ… API response < 3s (async pattern)
âœ… Cold start < 5s
âœ… Concurrent executions: 100+
âœ… Throughput: 100 extractions/min
```

### **Cost Requirements**

```
âœ… Cost per extraction < $0.01
âœ… No fixed monthly costs
âœ… Total cost < $1 per 1,000 extractions
âœ… 95% cost savings vs GCP
```

### **Security Requirements**

```
âœ… All data encrypted at rest (S3, DynamoDB)
âœ… HTTPS only (TLS 1.2+)
âœ… User data isolation
âœ… API key authentication
âœ… Audit trail in CloudWatch
âœ… No public access to S3
```

---

## ğŸ“š Related Documentation

**In `/nubox-cartola` folder:**
- `README.md` - Quick start guide
- `ARCHITECTURE.md` - This document
- `REQUIREMENTS.md` - Functional requirements
- `API_SPECIFICATION.md` - API documentation
- `DEPLOYMENT_GUIDE.md` - Step-by-step deployment
- `TESTING_GUIDE.md` - Testing procedures
- `SECURITY.md` - Security specifications
- `MIGRATION_GUIDE.md` - GCP to AWS migration

**External:**
- AWS Lambda: https://docs.aws.amazon.com/lambda/
- DynamoDB: https://docs.aws.amazon.com/dynamodb/
- S3: https://docs.aws.amazon.com/s3/
- Gemini AI: https://ai.google.dev/api

---

**Last Updated:** November 27, 2025  
**Version:** 1.0.0  
**Status:** Production-Ready Design  
**Maintainer:** Nubox Development Team

