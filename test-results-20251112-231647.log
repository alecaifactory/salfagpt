ğŸŒ Environment: Local Development
ğŸ“¦ Project: salfagpt
ğŸ”§ Initializing Firestore client...
ğŸ“¦ Project ID: salfagpt
ğŸŒ Environment: local
ğŸ—ï¸  Node ENV: development
âœ… Firestore client initialized successfully
ğŸ’¡ Local dev: Ensure you have run "gcloud auth application-default login"
ğŸ’¡ Production: Uses Workload Identity automatically
ğŸ§ª END-TO-END SIMILARITY TESTING
====================================================================================================

ğŸ“‹ Test Suite: RAG Similarity & References
   Agent: KfoKcDrb6pMnduAiLlrD
   User: usr_uhwqffaqag1wrryd82tw
   Timestamp: 2025-11-13T02:16:48.739Z

====================================================================================================

ğŸ“Œ TEST 1: Verify BigQuery Chunks Exist
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ… PASS: Found 9765 chunks in BigQuery

ğŸ“Œ TEST 2: Verify User ID Migration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   âœ… PASS: Migration complete (old: 0, new: 9765)

ğŸ“Œ TEST 3: Calculate Real Similarities (Direct BigQuery)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Query: "Â¿CuÃ¡les son los pasos para cambiar el filtro de aire de un motor Cummins?"
ğŸ”‘ [Embeddings] Loaded API key from .env file
ğŸ§® [Gemini AI] Generating semantic embedding (Â¿CuÃ¡les son los pasos para cambiar el filtro de ai...)
âœ… [Gemini AI] Generated SEMANTIC embedding: 768 dimensions
   âœ… Generated embedding: 768 dims
   âœ… Retrieved 20 chunks with similarity â‰¥30%

   Top 10 Similarities:

       1.  70.9% ğŸŸ¢ - Chunk #1
       2.  70.8% ğŸŸ¢ - Chunk #5
       3.  70.7% ğŸŸ¢ - Chunk #8
       4.  70.6% ğŸŸ¢ - Chunk #9
       5.  70.4% ğŸŸ¢ - Chunk #1
       6.  70.2% ğŸŸ¢ - Chunk #8
       7.  70.2% ğŸŸ¢ - Chunk #8
       8.  69.9% ğŸŸ¡ - Chunk #1
       9.  69.8% ğŸŸ¡ - Chunk #6
      10.  69.6% ğŸŸ¡ - Chunk #2

   ğŸ“Š Statistics:
      Max: 70.9%
      Avg: 69.8%
      Min: 69.1%
      Range: 1.8%
      Chunks â‰¥70%: 7

   âœ… PASS: Similarities vary (69.1% to 70.9%)

ğŸ“Œ TEST 4: API Endpoint Returns Correct Data
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Sending request to /api/conversations/KfoKcDrb6pMnduAiLlrD/messages
   Query: "Â¿CuÃ¡les son los pasos para cambiar el filtro de aire de un motor Cummins?"

   ğŸ“Š API Response:
      RAG Enabled: true
      RAG Used: false
      Had Fallback: false
      References Count: 0

   â„¹ï¸  No references returned (similarity <70% threshold)
      This is expected for this query based on Test 3 results

âŒ FATAL ERROR: ReferenceError: test5_codeReview is not defined
    at runAllTests (/Users/alec/salfagpt/scripts/test-similarity-e2e.ts:72:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
