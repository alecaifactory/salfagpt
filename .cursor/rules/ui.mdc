# UI Architecture & Roadmap - Flow

## ğŸ¯ Vision General

Flow es una plataforma de chat AI con gestiÃ³n avanzada de contexto, workflows de procesamiento de documentos, y sistema de permisos granular para validaciÃ³n de contenido por expertos.

---

## ğŸ“ Estructura Actual de la UI

### Layout Principal (3 Paneles)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Header                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                            â”‚                     â”‚
â”‚   LEFT       â”‚      MAIN CHAT             â”‚     RIGHT          â”‚
â”‚   PANEL      â”‚       AREA                 â”‚     PANEL          â”‚
â”‚              â”‚                            â”‚                     â”‚
â”‚  - Historial â”‚  - Messages                â”‚  - Workflows       â”‚
â”‚  - Context   â”‚  - Context Button          â”‚  - Execution       â”‚
â”‚    Sources   â”‚  - Input Area              â”‚  - Status          â”‚
â”‚              â”‚                            â”‚                     â”‚
â”‚              â”‚                            â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ Componentes Implementados

### 1. **Panel Izquierdo (Left Sidebar)**

#### A) SecciÃ³n Superior: Historial de Agentes
- **BotÃ³n**: "Nuevo Agente" (+ icono)
  - Crea conversaciÃ³n en Firestore GCP
  - Genera ID permanente
  - Persiste entre sesiones
- **Lista de Conversaciones**:
  - Ordenadas por fecha (mÃ¡s reciente primero)
  - Click para cambiar de conversaciÃ³n
  - Highlight del agente activo
  - Scroll infinito para historial largo

#### B) SecciÃ³n Inferior: Fuentes de Contexto
**TÃ­tulo**: "Fuentes de Contexto"
- **BotÃ³n**: "+ Agregar" (abre AddSourceModal)
- **Lista de Context Sources**:
  - Tarjetas con:
    - Nombre del archivo
    - Tipo (PDF, CSV, Excel, etc.)
    - **Toggle switch** (verde activo / gris inactivo)
    - **BotÃ³n Settings** (âš™ï¸ - abre ContextSourceSettingsModal)
    - **Progress bar** (durante procesamiento)
    - **Error display** (si falla)
  - Click en tarjeta â†’ expande SourceDetailPanel

#### C) SecciÃ³n Expandible: Source Detail Panel
- Se muestra cuando se selecciona un context source
- **Contenido**:
  - Preview del contenido extraÃ­do
  - Metadata completa
  - BotÃ³n "Volver" para colapsar
- **CaracterÃ­sticas**:
  - Expande left panel hacia la derecha
  - Ocupa mÃ¡s espacio vertical
  - Deja espacio para historial arriba

#### D) User Menu (Bottom)
- Avatar + Nombre + Email del usuario
- MenÃº desplegable con:
  - **GestiÃ³n de Contexto** (nuevo)
    - Abre ContextManagementDashboard
    - Administra permisos de acceso
    - Grupos y reglas de contexto
  - **ConfiguraciÃ³n** (abre UserSettingsModal)
    - Modelo preferido (Flash/Pro)
    - System prompt personalizado
    - Idioma (ES/EN/PT)
  - **Cerrar SesiÃ³n**

---

### 2. **Panel Central (Main Chat Area)**

#### A) Messages Area
- **Scroll container** para mensajes
- **Message bubbles**:
  - Usuario: alineado derecha, azul
  - Asistente: alineado izquierda, gris
- **Loading indicator**: spinner durante respuesta
- **Auto-scroll** al Ãºltimo mensaje

#### B) Context Button (Arriba del Input)
**Display**:
```
Contexto: 0.5% â€¢ âœ¨ Gemini 2.5 Flash â€¢ 1 fuentes
```
- **Porcentaje de uso**: Verde < 50%, Amarillo 50-80%, Rojo > 80%
- **Icono Sparkles**: âœ¨
- **Nombre del modelo**: Flash o Pro
- **NÃºmero de fuentes activas**

**Click â†’ Expande Panel de Contexto**:
- **Header con estadÃ­sticas**:
  - Total tokens usados
  - Tokens disponibles
  - Capacidad del modelo (1M o 2M)
  - Badge de color segÃºn % de uso

- **Desglose detallado**:
  1. **System Prompt**:
     - Preview (150 chars)
     - Cuenta de tokens
  
  2. **Historial de ConversaciÃ³n**:
     - Ãšltimos 3 mensajes con preview
     - Total mensajes y tokens
     - ğŸ‘¤ Usuario vs ğŸ¤– Asistente (con colores)
  
  3. **Fuentes de Contexto**:
     - Lista de fuentes activas
     - Preview del contenido (100 chars)
     - Metadata (pÃ¡ginas, tamaÃ±o)
     - Fondo verde para destacar

#### C) Input Area
- **Textarea** para escribir mensaje
- **BotÃ³n Send** (icono enviar)
  - Deshabilitado si vacÃ­o o cargando
  - Loading spinner durante respuesta
- **Disclaimer**: "Flow puede cometer errores. Verifica la informaciÃ³n importante."

---

### 3. **Panel Derecho (Right Panel - Workflows)**

#### A) Header
- TÃ­tulo: "Workflows"
- Subtitle: "Procesa documentos y APIs"
- **BotÃ³n toggle** para ocultar/mostrar panel

#### B) Lista de Workflows
Cada workflow card muestra:
- **Icono** del tipo de documento
- **Nombre**: "Procesar PDF", "Procesar CSV", etc.
- **DescripciÃ³n**: Breve explicaciÃ³n
- **ConfiguraciÃ³n actual**:
  - Max file size (ej: 50 MB)
  - Modelo usado (Flash por defecto)
- **Status icon**:
  - â¸ï¸ Available (gris)
  - â³ Running (azul, animado)
  - âœ“ Completed (verde)
  - âœ— Failed (rojo)
- **Botones**:
  - **â–¶ Ejecutar**: Abre AddSourceModal con tipo pre-seleccionado
  - **âš™ï¸ Settings**: Abre WorkflowConfigModal

#### C) Workflows Disponibles
1. **Procesar PDF**:
   - ExtracciÃ³n automÃ¡tica: texto, tablas, imÃ¡genes (como texto)
   - Modelo: gemini-2.5-flash (default)
   - Max: 50 MB
   
2. **Procesar CSV**:
   - Lee y analiza CSV
   - Max: 20 MB
   
3. **Analizar Excel**:
   - Procesa hojas de cÃ¡lculo
   - Max: 50 MB
   
4. **Extraer Texto de Word**:
   - Lee documentos Microsoft Word
   - Max: 30 MB
   
5. **Indexar Carpeta**:
   - Procesa todos los archivos en una carpeta
   - Max: 200 MB

---

## ğŸ­ Modales Implementados

### 1. AddSourceModal
**FunciÃ³n**: Agregar nueva fuente de contexto

**Flujo**:
1. **Paso 1: Select Type** (si no viene pre-seleccionado)
   - Archivo (PDF, CSV, Excel, Word)
   - URL Web
   - API
   
2. **Paso 2: Configure**
   - Upload Ã¡rea (drag & drop o click)
   - Mostrar archivo seleccionado (nombre, tamaÃ±o)
   - Selector de modelo:
     - Gemini 2.5 Flash (recomendado, 94% mÃ¡s econÃ³mico)
     - Gemini 2.5 Pro (mayor precisiÃ³n)
   - Tooltip con costos y recomendaciones
   
3. **Paso 3: Processing**
   - Progress bar con porcentaje
   - Mensaje de estado
   - Indicador visual del modelo usado

**Features**:
- Pre-selecciÃ³n de tipo desde workflow
- Reset automÃ¡tico al abrir/cerrar
- Progress tracking en tiempo real
- Error handling con detalles

---

### 2. WorkflowConfigModal
**FunciÃ³n**: Configurar parÃ¡metros de workflow

**Contenido**:
- **Max File Size**: Input numÃ©rico (MB)
- **Max Output Length**: Input numÃ©rico (tokens)
- **Language**: Select (es, en, pt)
- **AI Model**: 
  - Gemini 2.5 Flash (default)
  - Gemini 2.5 Pro
  - Tooltip con info de costos

**CaracterÃ­sticas**:
- z-index: 999 (sobre todo)
- Reset al abrir
- Save guarda en state de workflows

---

### 3. UserSettingsModal
**FunciÃ³n**: ConfiguraciÃ³n personal del usuario

**Contenido**:
- **Header**: Muestra nombre y email del usuario

- **Modelo Preferido**:
  - Gemini 2.5 Flash (recomendado)
  - Gemini 2.5 Pro (avanzado)
  - Cards visuales con badges
  - Info de costos y casos de uso

- **System Prompt**:
  - Textarea personalizable
  - Default: "Eres un asistente Ãºtil y profesional..."
  - GuÃ­a las respuestas del asistente

- **Idioma**:
  - EspaÃ±ol (default)
  - English
  - PortuguÃªs

**Persistencia**: localStorage â†’ `flow_user_settings`

---

### 4. ContextSourceSettingsModal â­
**FunciÃ³n**: Ver detalles y re-configurar extracciÃ³n de contexto

**Layout**: 2 columnas compactas

#### Columna Izquierda:
1. **Fuente Original**:
   - ğŸ“„ Nombre del archivo
   - ğŸ“‹ Tipo (PDF, CSV, etc.)
   - ğŸ’¾ TamaÃ±o

2. **Detalles de ExtracciÃ³n**:
   - âœ¨ Modelo usado
   - â±ï¸ Tiempo de procesamiento
   - ğŸ“ Caracteres extraÃ­dos
   - ğŸ”¢ Tokens estimados

3. **Estado de ValidaciÃ³n** (NUEVO):
   - **Si validado** âœ…:
     - Badge verde "Validado"
     - Usuario que validÃ³
     - Fecha de validaciÃ³n
   - **Si pendiente** â³:
     - Badge amarillo "Pendiente"
     - Nota: "Debe ser validado por experto del dominio"
   - **Permisos para validar**:
     - admin
     - context_signoff
     - context_owner
     - context_reviewer

#### Columna Derecha:
1. **ConfiguraciÃ³n Actual**:
   - Max file size (input)
   - Max output length (input)
   - AI Model selector (con tooltip)

2. **Preview del Contenido**:
   - Primeros 500 caracteres
   - Scroll si es mÃ¡s largo

**BotÃ³n**: "Re-Extraer Contenido"
- Re-procesa con nueva configuraciÃ³n
- Muestra progreso en tiempo real
- Actualiza metadata

---

### 5. ContextManagementDashboard
**FunciÃ³n**: AdministraciÃ³n de acceso a contextos

**Contenido**:
- Overview de contextos del sistema
- AsignaciÃ³n de permisos por usuario/grupo
- Grupos disponibles:
  - Product Team
  - Tech Team
  - Compliance Team
  - Collections Team
  - Treasury Team
  - Ãrea de Compras
  - Ãrea de Ventas
  - Ãrea de Operaciones
  - Marketing
  - Finanzas
  - Cobranza
  - AdquisiciÃ³n
  - RetenciÃ³n
  - Gerencia

**Features**:
- Crear nuevos grupos
- Asignar reglas de acceso
- Fechas de expiraciÃ³n
- DuraciÃ³n de acceso

---

## ğŸ¨ Design System

### Colores
- **Primary**: Blue 600 (#2563eb)
- **Success**: Green 600 (#16a34a)
- **Warning**: Yellow 500 (#eab308)
- **Error**: Red 600 (#dc2626)
- **Text**: Slate 700, 600, 500
- **Background**: Slate 50, White

### Iconos (Lucide React)
- MessageSquare, Plus, Send, FileText
- Loader2, User, Settings, LogOut
- Play, CheckCircle, XCircle, Sparkles
- RefreshCw, Clock, HardDrive, Zap, Info

### Typography
- **Headers**: font-bold, text-lg/xl/2xl
- **Body**: text-sm/base
- **Small**: text-xs/[10px]

### Spacing
- Padding: p-2/3/4/6
- Gaps: gap-2/3/4
- Margins: mb-2/3/4

### Components
- **Rounded**: rounded-lg/xl/2xl
- **Shadows**: shadow-md/lg/xl/2xl
- **Borders**: border border-slate-200/300
- **Transitions**: transition-colors/all

---

## ğŸ”„ Flujo de Datos

### 1. Crear Nuevo Agente
```
Usuario â†’ Click "Nuevo Agente"
  â†“
POST /api/conversations
  Body: { userId, title: "Nuevo Agente" }
  â†“
Firestore â†’ Crea documento en collection conversations
  â†“
Response: { conversation: { id, title, createdAt, ... } }
  â†“
Frontend â†’ setConversations, setCurrentConversation
  â†“
âœ… ConversaciÃ³n persiste en GCP
```

### 2. Enviar Mensaje
```
Usuario â†’ Escribe mensaje â†’ Click Send
  â†“
POST /api/conversations/{id}/messages
  Body: { userId, message, model, contextSources }
  â†“
Backend:
  1. Obtiene contexto activo del usuario
  2. Construye prompt con context sources
  3. Llama a Gemini AI
  4. Guarda mensaje en Firestore
  â†“
Response: { message: { id, role, content, ... } }
  â†“
Frontend â†’ AÃ±ade mensaje a UI
  â†“
âœ… Mensaje guardado y mostrado
```

### 3. Agregar Context Source
```
Usuario â†’ Click "+ Agregar" o "â–¶ Ejecutar" en workflow
  â†“
AddSourceModal abre (con tipo pre-seleccionado si viene de workflow)
  â†“
Usuario selecciona archivo y modelo
  â†“
handleAddSource():
  1. Crea FormData con file y model
  2. POST /api/extract-document
  3. Update progress (0% â†’ 50% â†’ 100%)
  â†“
Backend:
  1. Recibe archivo
  2. Llama a Gemini AI para extracciÃ³n
  3. Retorna texto + metadata
  â†“
Frontend:
  1. Crea ContextSource con extractedData
  2. Guarda originalFile para re-extracciÃ³n
  3. AÃ±ade a contextSources state
  â†“
âœ… Context source disponible para activar
```

### 4. Activar/Desactivar Context
```
Usuario â†’ Toggle switch en context card
  â†“
toggleContext(sourceId)
  â†“
Update contextSources state (enabled: true/false)
  â†“
Si conversaciÃ³n existe:
  POST /api/conversations/{id}/context-sources
  Body: { activeContextSourceIds: [...] }
  â†“
Firestore â†’ Guarda IDs activos en conversaciÃ³n
  â†“
âœ… Context activo persiste por agente
```

### 5. Ver ConfiguraciÃ³n de Context
```
Usuario â†’ Click âš™ï¸ en context card
  â†“
handleSourceSettings(sourceId)
  â†“
Encuentra source en contextSources
  â†“
setSettingsSource(source)
  â†“
ContextSourceSettingsModal abre
  â†“
Muestra:
  - Info original
  - Detalles de extracciÃ³n
  - Estado de validaciÃ³n
  - ConfiguraciÃ³n actual
  - Preview del contenido
```

### 6. Re-Extraer Context
```
Usuario â†’ Cambia config en modal â†’ Click "Re-Extraer"
  â†“
handleReExtract(sourceId, newConfig)
  â†“
Update progress (procesando...)
  â†“
POST /api/extract-document
  FormData: { file: source.originalFile, model: newConfig.model }
  â†“
Backend â†’ Re-procesa con nuevo modelo
  â†“
Frontend â†’ Update source con nueva data y metadata
  â†“
âœ… Context actualizado con nueva extracciÃ³n
```

---

## âœ… Funcionalidades Completas

### GestiÃ³n de Conversaciones
- [x] Crear nuevo agente (persiste en Firestore)
- [x] Listar conversaciones por usuario
- [x] Cambiar entre conversaciones
- [x] Persistencia entre sesiones (GCP)
- [x] Historial completo con scroll

### Chat y Mensajes
- [x] Enviar mensajes
- [x] Recibir respuestas de AI (streaming potencial)
- [x] Mostrar historial de mensajes
- [x] Loading states
- [x] Error handling

### GestiÃ³n de Contexto
- [x] Agregar context sources (PDF, CSV, Excel, Word)
- [x] Ver lista de sources
- [x] Activar/desactivar sources (toggle)
- [x] Expandir source para ver detalles
- [x] Progress tracking durante extracciÃ³n
- [x] Error display con detalles
- [x] Context activo persiste por agente

### Workflows
- [x] Lista de workflows disponibles
- [x] Ejecutar workflow (abre modal con tipo pre-seleccionado)
- [x] Configurar workflow (modal de settings)
- [x] Status indicators (available, running, completed, failed)
- [x] ExtracciÃ³n automÃ¡tica con Gemini AI

### Modelos y ConfiguraciÃ³n
- [x] Selector de modelo (Flash vs Pro)
- [x] Tooltips informativos con costos
- [x] User settings (modelo, system prompt, idioma)
- [x] Settings persisten en localStorage
- [x] Context source settings modal

### CÃ¡lculo de Contexto
- [x] BotÃ³n con % de uso del context window
- [x] CÃ³digo de color (verde/amarillo/rojo)
- [x] Panel expandible con desglose detallado
- [x] Stats por secciÃ³n (system prompt, mensajes, sources)
- [x] Tokens estimados y disponibles

### UI/UX
- [x] Panel izquierdo resizable (drag & drop)
- [x] Panel derecho resizable (drag & drop)
- [x] Panel izquierdo expandible para source details
- [x] Toggle para ocultar/mostrar panel derecho
- [x] Smooth transitions y animaciones
- [x] Responsive design
- [x] Loading states en todos los procesos

### AutenticaciÃ³n
- [x] Google OAuth
- [x] JWT sessions
- [x] User menu con info (nombre, email)
- [x] Logout funcional

---

## ğŸš§ Funcionalidades Pendientes

### Alta Prioridad

#### 1. Sistema de ValidaciÃ³n de Contexto
- [ ] **BotÃ³n "Validar" en ContextSourceSettingsModal**
  - Solo visible para usuarios con permisos
  - Roles: admin, context_signoff, context_owner, context_reviewer
- [ ] **API endpoint para validaciÃ³n**
  - POST /api/context-sources/{id}/validate
  - Guarda: validated, validatedBy, validatedAt, validationNotes
- [ ] **Badge visual en context card**
  - âœ“ Verde si validado
  - â³ Amarillo si pendiente
- [ ] **Filtro de contexts validados**
  - Mostrar solo validados / todos
- [ ] **Logs de validaciÃ³n**
  - Historial de quiÃ©n validÃ³ quÃ© y cuÃ¡ndo

#### 2. Sistema de Permisos Granular
- [ ] **User roles en base de datos**
  - Tabla users con role field
  - admin, expert, user, context_signoff, etc.
- [ ] **Middleware de autorizaciÃ³n**
  - Verificar permisos antes de operaciones
  - 403 Forbidden si no autorizado
- [ ] **UI condicional por rol**
  - Mostrar/ocultar features segÃºn permisos
  - Botones deshabilitados si no autorizado
- [ ] **Admin panel**
  - Gestionar usuarios
  - Asignar roles
  - Ver logs de actividad

#### 3. Compartir Context Sources
- [ ] **BotÃ³n "Compartir" en SourceDetailPanel**
- [ ] **Modal de compartir**:
  - Seleccionar usuarios o grupos
  - Template de email auto-generado
  - Personalizar por job role / OKRs
  - Copy email subject & content
- [ ] **API de compartir**
  - POST /api/context-sources/{id}/share
  - Crea access rules en Firestore
- [ ] **Email generation con AI**
  - Prompt con job role y OKRs
  - Genera email personalizado
  - Preview antes de copiar

#### 4. GestiÃ³n de Context Management
- [ ] **Dashboard completo funcional**
  - Overview de todos los contexts
  - AsignaciÃ³n de permisos masiva
  - EstadÃ­sticas de uso
- [ ] **Grupos funcionales**
  - CRUD de grupos
  - Asignar usuarios a grupos
  - Asignar contexts a grupos
- [ ] **Access rules**
  - Fechas de expiraciÃ³n
  - DuraciÃ³n configurable
  - RenovaciÃ³n automÃ¡tica/manual
- [ ] **Notificaciones**
  - Email cuando se comparte contexto
  - Alerta cuando expira acceso
  - NotificaciÃ³n de validaciÃ³n requerida

### Media Prioridad

#### 5. Mejoras de ExtracciÃ³n
- [ ] **MÃ¡s tipos de archivos**
  - PowerPoint (.ppt, .pptx)
  - ImÃ¡genes (OCR con Vision API)
  - Audio (transcripciÃ³n)
  - Video (transcripciÃ³n + frames)
- [ ] **ExtracciÃ³n de URLs**
  - Scraping de web pages
  - ExtracciÃ³n de contenido principal
  - Seguir links internos
- [ ] **ExtracciÃ³n de APIs**
  - Configurar headers, auth
  - GET/POST requests
  - Parse JSON responses
- [ ] **Batch processing**
  - Subir carpeta completa
  - Procesar mÃºltiples archivos
  - Progress aggregado

#### 6. Folders y OrganizaciÃ³n
- [ ] **Crear folders para agentes**
  - UI para crear/editar/borrar
  - Drag & drop agentes a folders
- [ ] **Filtrar por folder**
  - Lista de folders en sidebar
  - Click para filtrar agentes
- [ ] **BÃºsqueda de agentes**
  - Input de bÃºsqueda
  - Filtrar por tÃ­tulo/contenido
  - Highlight de resultados

#### 7. Mejoras de Contexto
- [ ] **Priorizar sources**
  - Drag & drop para reordenar
  - Guardar orden en Firestore
  - AI usa en orden de prioridad
- [ ] **Snippets de context**
  - Seleccionar parte especÃ­fica del documento
  - Usar solo snippet en lugar de todo
  - Highlight en preview
- [ ] **Context templates**
  - Guardar combinaciÃ³n de sources como template
  - Aplicar template rÃ¡pidamente
  - Compartir templates

#### 8. AnÃ¡lisis y Reportes
- [ ] **Analytics dashboard**
  - Tokens usados por usuario/agente
  - Costos acumulados
  - Sources mÃ¡s usados
  - Modelos mÃ¡s usados
- [ ] **Exportar conversaciones**
  - PDF con formato
  - Markdown
  - JSON
- [ ] **Exportar contexts**
  - Descargar contenido extraÃ­do
  - Incluir metadata

### Baja Prioridad

#### 9. Features Avanzados
- [ ] **Streaming responses**
  - Ver respuesta mientras se genera
  - Cancelar generaciÃ³n a mitad
- [ ] **Voice input**
  - Grabar mensaje de voz
  - Transcribir con Whisper
  - Enviar como texto
- [ ] **ImÃ¡genes en chat**
  - Subir imagen en mensaje
  - Analizar con Gemini Vision
  - Ver en historial
- [ ] **Mentions**
  - @mention otros usuarios
  - NotificaciÃ³n push/email
- [ ] **Collaborative chat**
  - MÃºltiples usuarios en mismo agente
  - Ver quiÃ©n estÃ¡ escribiendo
  - Typing indicators

#### 10. Integraciones
- [ ] **Email service (Kit API v4)**
  - Enviar emails directamente
  - No solo copy-paste
- [ ] **Slack integration**
  - Compartir contexts a Slack
  - Mencionar en Slack
- [ ] **Google Drive**
  - Importar documentos
  - SincronizaciÃ³n automÃ¡tica
- [ ] **Dropbox, OneDrive**
  - Conectar cuentas
  - Importar archivos

---

## ğŸ“Š Performance & OptimizaciÃ³n

### Implementado
- [x] Lazy loading de mensajes (solo cargar Ãºltimos N)
- [x] Virtualized lists para historial largo
- [x] Debounce en inputs
- [x] Progress tracking granular
- [x] Error boundaries para crashes

### Pendiente
- [ ] **Pagination en historial**
  - Cargar mÃ¡s al scroll
  - Infinite scroll
- [ ] **Caching de context sources**
  - No re-fetch si no cambiaron
  - Cache en localStorage/IndexedDB
- [ ] **Optimistic updates**
  - Mostrar mensaje antes de confirmar
  - Revertir si falla
- [ ] **Service Worker**
  - Offline support bÃ¡sico
  - Cache de assets estÃ¡ticos
- [ ] **Code splitting**
  - Lazy load modales
  - Lazy load panel derecho

---

## ğŸ› Bugs Conocidos

### CrÃ­ticos
- Ninguno conocido actualmente âœ…

### Menores
- [ ] Al cambiar de agente muy rÃ¡pido, mensajes pueden mezclarse
- [ ] Progress bar a veces no resetea al 0% antes de empezar
- [ ] Tooltip de modelo a veces queda pegado al cambiar de modal

### Nice-to-fix
- [ ] Resize panels tiene min-width fijo, podrÃ­a ser mÃ¡s flexible
- [ ] Long file names no truncan bien en todas las vistas
- [ ] Modal de configuraciÃ³n podrÃ­a tener animaciÃ³n de entrada

---

## ğŸ“ Lecciones Aprendidas

### 1. Persistencia de Datos
**Aprendizaje**: Nunca confiar solo en estado React para datos crÃ­ticos.
- Conversaciones deben crearse inmediatamente en Firestore
- Context sources activos deben guardarse por agente
- User settings deben persistir (localStorage o DB)

### 2. Manejo de Archivos
**Aprendizaje**: Guardar `originalFile` en state para permitir re-extracciÃ³n.
- Permite cambiar modelo sin re-subir archivo
- Ãštil para debugging y validaciÃ³n
- Memoria razonable para archivos < 50MB

### 3. Progress Tracking
**Aprendizaje**: UI con progress feedback mejora UX dramÃ¡ticamente.
- Mostrar stages claros (uploading, processing, complete)
- Percentage + mensaje descriptivo
- Error details si falla

### 4. Modularidad
**Aprendizaje**: Componentes pequeÃ±os y focused son mÃ¡s mantenibles.
- Cada modal es independiente
- Props claros y tipados
- Handlers especÃ­ficos por funcionalidad

### 5. Tipos de TypeScript
**Aprendizaje**: Importar tipos centralizados evita conflictos.
- Definir interfaces en `src/types/*.ts`
- Nunca duplicar definiciones
- Usar tipos compartidos entre componentes

---

## ğŸš€ Roadmap de ImplementaciÃ³n

### Fase 1: Sistema de ValidaciÃ³n (1-2 semanas)
1. Implementar botÃ³n y modal de validaciÃ³n
2. API endpoint para validar contexts
3. Roles y permisos en base de datos
4. Logs de validaciÃ³n
5. Filtros por estado de validaciÃ³n

### Fase 2: Compartir y ColaboraciÃ³n (2-3 semanas)
1. Modal de compartir contexts
2. GeneraciÃ³n de emails con AI
3. Sistema de access rules
4. Notificaciones por email
5. Context Management Dashboard completo

### Fase 3: Mejoras de ExtracciÃ³n (2-3 semanas)
1. MÃ¡s tipos de archivos (PPT, imÃ¡genes, audio)
2. ExtracciÃ³n de URLs (web scraping)
3. Batch processing (carpetas completas)
4. ExtracciÃ³n de APIs (configuraciÃ³n avanzada)

### Fase 4: OrganizaciÃ³n y BÃºsqueda (1-2 semanas)
1. Sistema de folders
2. BÃºsqueda de agentes y mensajes
3. Tags y categorÃ­as
4. Snippets de context

### Fase 5: Analytics y Reportes (2 semanas)
1. Dashboard de analytics
2. MÃ©tricas de uso (tokens, costos)
3. Exportar conversaciones
4. Exportar contexts

### Fase 6: Features Avanzados (3-4 semanas)
1. Streaming responses
2. Voice input
3. ImÃ¡genes en chat
4. Collaborative chat

### Fase 7: Integraciones (2-3 semanas)
1. Email service (Kit API v4)
2. Slack integration
3. Google Drive
4. Dropbox, OneDrive

---

## ğŸ“ Notas de Desarrollo

### Convenciones de CÃ³digo
- **Componentes**: PascalCase (ej: `AddSourceModal.tsx`)
- **Functions**: camelCase (ej: `handleAddSource`)
- **Constants**: UPPER_SNAKE_CASE (ej: `DEFAULT_WORKFLOWS`)
- **Types**: PascalCase (ej: `ContextSource`)

### Estructura de Archivos
```
src/
â”œâ”€â”€ components/           # React components
â”‚   â”œâ”€â”€ ChatInterfaceWorking.tsx
â”‚   â”œâ”€â”€ ContextManager.tsx
â”‚   â”œâ”€â”€ AddSourceModal.tsx
â”‚   â”œâ”€â”€ ContextSourceSettingsModal.tsx
â”‚   â”œâ”€â”€ WorkflowConfigModal.tsx
â”‚   â”œâ”€â”€ UserSettingsModal.tsx
â”‚   â””â”€â”€ ...
â”œâ”€â”€ types/                # TypeScript types
â”‚   â”œâ”€â”€ context.ts
â”‚   â”œâ”€â”€ sharing.ts
â”‚   â””â”€â”€ contextAccess.ts
â”œâ”€â”€ lib/                  # Utilities & services
â”‚   â”œâ”€â”€ firestore.ts
â”‚   â”œâ”€â”€ gemini.ts
â”‚   â””â”€â”€ auth.ts
â”œâ”€â”€ pages/                # Astro pages
â”‚   â”œâ”€â”€ api/              # API routes
â”‚   â””â”€â”€ chat.astro
â””â”€â”€ styles/
    â””â”€â”€ global.css
```

### Git Workflow
- Branch por feature: `feat/feature-name-YYYY-MM-DD`
- Commits descriptivos con emojis
- PR a main con review
- Merge con `--no-ff`

### Testing Checklist
Antes de cada PR:
- [ ] `npm run type-check` pasa
- [ ] `npm run lint` pasa sin errores
- [ ] Manual testing en browser
- [ ] Verificar consola sin errores
- [ ] Probar en mobile (responsive)
- [ ] Probar flows completos end-to-end

---

## ğŸ¯ Objetivos de Producto

### Corto Plazo (1-3 meses)
- Sistema de validaciÃ³n completo y funcional
- Compartir contexts entre usuarios/grupos
- Context Management Dashboard operativo
- Analytics bÃ¡sico de uso

### Medio Plazo (3-6 meses)
- Integraciones con herramientas externas
- Features de colaboraciÃ³n
- Mejoras avanzadas de extracciÃ³n
- Mobile app (React Native)

### Largo Plazo (6-12 meses)
- AI-powered features avanzados
- Marketplace de contexts y workflows
- Enterprise features (SSO, compliance, etc.)
- White-label para clientes

---

## ğŸ† MÃ©tricas de Ã‰xito

### TÃ©cnicas
- Uptime: > 99.5%
- API response time: < 500ms p95
- Error rate: < 0.1%
- Test coverage: > 80%

### Producto
- MAU (Monthly Active Users): objetivo definir
- Mensajes por usuario/mes: objetivo definir
- Contexts creados por usuario: objetivo definir
- Retention rate: > 60% (mes 1 â†’ mes 2)

### Negocio
- Costo por usuario/mes: objetivo definir
- Revenue per user: objetivo definir
- Customer satisfaction: NPS > 50
- Time to value: < 5 minutos (primer mensaje Ãºtil)

---

**Ãšltima actualizaciÃ³n**: Octubre 12, 2025
**VersiÃ³n**: 1.0.0
**Mantenedor**: Flow Development Team
