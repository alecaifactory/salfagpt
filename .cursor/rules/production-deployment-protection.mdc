# Production Deployment Protection

**alwaysApply**: false
**requiresConfirmation**: true
**appliesTo**: Production environment deployments ONLY
**severity**: CRITICAL

## ğŸ”´ CRITICAL WARNING

This rule protects LIVE PRODUCTION environments serving real customers.

**ANY production operation requires**:
- User types "DEPLOY" (not "yes")
- Complete checklist verification
- Client approval documented
- Rollback plan stated

**This rule is NOT always applied** - it's loaded when AI detects production operations.

---

## ğŸ¯ Purpose

Ensures that NO production deployment or modification happens without:
1. Explicit user confirmation (typing "DEPLOY")
2. Complete pre-deployment checklist
3. Multiple safety verifications
4. Clear rollback plan

---

## ğŸ”´ Protected Environment

### Production Client (Client GCP)
- **Project**: [CLIENT-PRODUCTION-PROJECT-ID]
- **Service**: flow-production
- **URL**: https://flow.client-domain.com
- **Impact**: LIVE CUSTOMERS
- **Uptime SLA**: 99.9%
- **Data**: Production customer data

---

## ğŸš¨ MANDATORY Confirmation Process

### Step 1: Detect Production Operation

When user requests production deployment, AI must:

```
ğŸ”´ PRODUCTION ENVIRONMENT DETECTED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Operation: Deploy to production-client
Target Project: [CLIENT-PRODUCTION-PROJECT-ID]
Service: flow-production
URL: https://flow.client-domain.com

âš ï¸  This affects LIVE CUSTOMERS
âš ï¸  Downtime or errors impact real users
âš ï¸  Changes are immediately visible

Proceeding to complete checklist...
```

### Step 2: Complete Pre-Deployment Checklist

```
ğŸ“‹ PRODUCTION DEPLOYMENT CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

CODE QUALITY:
â–¡ npm run type-check â†’ PASSED
â–¡ npm run build â†’ SUCCESSFUL  
â–¡ No TypeScript errors
â–¡ No console.logs or debug code
â–¡ Code reviewed

TESTING:
â–¡ All features tested in staging-internal
â–¡ All features tested in staging-client
â–¡ No regressions detected
â–¡ Performance verified (< 2s response time)
â–¡ Security validated

STAGING VALIDATION:
â–¡ Staging-internal: DEPLOYED and TESTED
â–¡ Staging-client: DEPLOYED and TESTED
â–¡ Client UAT: COMPLETED
â–¡ Client approval: DOCUMENTED

APPROVALS:
â–¡ Client sign-off: RECEIVED (date: [DATE])
â–¡ Technical review: COMPLETED
â–¡ Security review: COMPLETED (if data changes)

SAFETY:
â–¡ Rollback plan: DOCUMENTED
â–¡ Monitoring: CONFIGURED
â–¡ Alerts: ENABLED
â–¡ Backup: COMPLETED (if data migration)

COMMUNICATION:
â–¡ Client notified of deployment window
â–¡ Downtime communicated (if any)
â–¡ Support team alerted

Have you verified ALL items above? (yes/no):
```

### Step 3: Rollback Plan

```
ğŸ”„ ROLLBACK PLAN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Current version: [version]
Target version: [new-version]
Previous revision: [revision-name]

If deployment fails:

Immediate Rollback (< 2 minutes):
  ./deployment/rollback-deployment.sh production-client [previous-revision]

Or manual:
  gcloud run services update-traffic flow-production \
    --to-revisions=[previous-revision]=100 \
    --region=us-central1

Rollback plan documented? (yes/no):
```

### Step 4: Final Confirmation

```
âš ï¸  FINAL CONFIRMATION REQUIRED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Deploying to PRODUCTION:
â€¢ Environment: production-client
â€¢ Project: [CLIENT-PRODUCTION-PROJECT-ID]
â€¢ Service: flow-production
â€¢ URL: https://flow.client-domain.com

âœ… Checklist complete
âœ… Client approval documented
âœ… Rollback plan ready

âš ï¸  Type 'DEPLOY' to proceed (must be uppercase):
```

**User must type exactly**: `DEPLOY`

Any other input (including "yes", "deploy", "Yes") will be rejected.

---

## ğŸš« Absolute Prohibitions

AI must NEVER do to production without "DEPLOY" confirmation:

### Forbidden Operations
- âŒ Execute deployment scripts
- âŒ Run `gcloud run deploy`
- âŒ Modify Firestore data
- âŒ Delete documents or collections
- âŒ Run database migrations
- âŒ Change environment variables
- âŒ Update secrets
- âŒ Modify OAuth configuration
- âŒ Delete resources

---

## âš¡ Emergency Override

For critical production fixes:

**User must state**:
```
EMERGENCY PRODUCTION FIX
Reason: [Critical bug affecting customers]
```

**AI still requires**:
```
ğŸš¨ EMERGENCY PRODUCTION DEPLOYMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Emergency reason: [stated reason]

Expedited checklist:
âœ… Fix tested locally
âœ… Fix verified in staging-client
âœ… Rollback: [previous-revision]

Even in emergencies, safety matters.

Type 'EMERGENCY-DEPLOY' to proceed:
```

**User must type**: `EMERGENCY-DEPLOY`

---

## ğŸ“Š Post-Deployment Verification

After deployment, AI must:

```
âœ… DEPLOYMENT SUCCESSFUL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Service: flow-production
Revision: flow-production-00124-xyz
URL: https://flow.client-domain.com

Monitoring (next 15 minutes):
ğŸ“Š View logs:
  gcloud run services logs read flow-production \
    --region=us-central1 \
    --limit=100 \
    --project=[PROJECT-ID]

ğŸ¥ Health monitoring:
  Watch: https://console.cloud.google.com/monitoring

ğŸ”” Alert if:
  â€¢ Error rate > 1%
  â€¢ Response time > 2s
  â€¢ Any 5xx errors

Rollback ready:
  ./deployment/rollback-deployment.sh production-client flow-production-00123-abc
```

---

## ğŸ¯ Success Metrics

Track these for production deployments:

- âœ… Zero deployments without "DEPLOY" confirmation
- âœ… 100% checklist completion
- âœ… Zero rollbacks needed
- âœ… < 2 production deployments per week
- âœ… Client satisfaction maintained

---

**Last Updated**: 2025-10-17  
**Version**: 1.0.0  
**Status**: âœ… Active (requires confirmation)  
**alwaysApply**: false âš ï¸  
**severity**: CRITICAL ğŸ”´  
**Backward Compatible**: Yes

---

**Remember**: Production is sacred. Every deployment is a risk. Always confirm. Always have a plan. The customer's trust depends on it.
