# Panel de Prueba Interactiva de Documentos
**Date:** October 19, 2025  
**Feature:** Test directo de chunks y validaci√≥n de referencias  
**Status:** ‚úÖ Implementado

---

## üéØ ¬øQu√© Es Esto?

Un panel de prueba integrado que te permite:

1. **Ver todos los chunks** del documento lado a lado
2. **Seleccionar un chunk espec√≠fico** como objetivo
3. **Hacer preguntas** sobre ese chunk
4. **Verificar autom√°ticamente** si el AI referenci√≥ el chunk correcto
5. **Ver las referencias** con scores de similitud
6. **Probar la calidad** del RAG sin salir del modal

---

## üöÄ C√≥mo Usarlo

### Paso 1: Abrir el Panel

1. **Abre** la configuraci√≥n de un documento (settings ‚öôÔ∏è)
2. **Scroll** hasta "Indexaci√≥n RAG"
3. **Busca** el bot√≥n morado/p√∫rpura:
   ```
   üéØ Probar Documento Interactivamente ‚ú®
   ```
4. **Click** ‚Üí Se abre panel fullscreen dividido en 2

### Paso 2: Seleccionar un Chunk

**Panel Izquierdo - Lista de Chunks:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìÑ Chunks del Documento (3)       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                    ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ Chunk #0        P√°gina 1-2  ‚îÇ   ‚îÇ
‚îÇ ‚îÇ 450 tokens                   ‚îÇ   ‚îÇ
‚îÇ ‚îÇ                              ‚îÇ   ‚îÇ
‚îÇ ‚îÇ La Circular DDU-ESPEC√çFICA   ‚îÇ   ‚îÇ
‚îÇ ‚îÇ N¬∫ 75 establece que para     ‚îÇ   ‚îÇ
‚îÇ ‚îÇ el c√°lculo de la superficie  ‚îÇ   ‚îÇ
‚îÇ ‚îÇ edificada de escaleras...    ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ ‚îÇ Chunk #1        P√°gina 3-4  ‚îÇ   ‚îÇ
‚îÇ ‚îÇ 380 tokens                   ‚îÇ   ‚îÇ
‚îÇ ‚îÇ ...                          ‚îÇ   ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Click en cualquier chunk** ‚Üí Se selecciona (fondo azul)

**Opcional:** Selecciona texto dentro del chunk con el mouse ‚Üí Genera preguntas sugeridas

### Paso 3: Hacer una Pregunta

**Panel Derecho - Chat de Prueba:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí¨ Chat de Prueba                 ‚îÇ
‚îÇ Chunk #0 seleccionado como objetivo‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                    ‚îÇ
‚îÇ [√Årea de mensajes vac√≠a]           ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ ‚ú® Selecciona un chunk y haz una  ‚îÇ
‚îÇ    pregunta                        ‚îÇ
‚îÇ                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üí° Preguntas sugeridas:            ‚îÇ
‚îÇ ‚Ä¢ ¬øQu√© dice sobre escaleras?       ‚îÇ
‚îÇ ‚Ä¢ ¬øC√≥mo se calcula la superficie?  ‚îÇ
‚îÇ ‚Ä¢ Resume este fragmento            ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ ‚îÇ Pregunta aqu√≠...   ‚îÇProbar‚îÇ      ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ üéØ Chunk #0 seleccionado           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Opciones:**
- Click en una pregunta sugerida ‚Üí Se llena autom√°ticamente
- Escribe tu propia pregunta
- Presiona Enter o click "Probar"

### Paso 4: Ver el Resultado

**El AI responde mostrando:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Usuario:                           ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ ‚îÇ ¬øC√≥mo se calcula la        ‚îÇ     ‚îÇ
‚îÇ ‚îÇ superficie de escaleras?   ‚îÇ     ‚îÇ
‚îÇ ‚îÇ üéØ Objetivo: Chunk #0      ‚îÇ     ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ Respuesta de Prueba                ‚îÇ
‚îÇ ‚úì Chunk objetivo referenciado      ‚îÇ ‚Üê Indicador de √©xito!
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ ‚îÇ Seg√∫n la Circular [1], el  ‚îÇ     ‚îÇ
‚îÇ ‚îÇ c√°lculo debe considerar... ‚îÇ     ‚îÇ
‚îÇ ‚îÇ                            ‚îÇ     ‚îÇ
‚îÇ ‚îÇ ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ     ‚îÇ
‚îÇ ‚îÇ üìö Referencias utilizadas   ‚îÇ     ‚îÇ
‚îÇ ‚îÇ                            ‚îÇ     ‚îÇ
‚îÇ ‚îÇ [1] DDU-ESP-075-07.pdf     ‚îÇ     ‚îÇ
‚îÇ ‚îÇ     87.3% similar          ‚îÇ     ‚îÇ
‚îÇ ‚îÇ     Chunk #0 ‚Üê ¬°MATCH! ‚úÖ  ‚îÇ     ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Indicadores Autom√°ticos:**

- **Verde "‚úì Chunk objetivo referenciado"** ‚Üí El AI us√≥ el chunk que seleccionaste ‚úÖ
- **Naranja "‚ö† Chunk objetivo NO usado"** ‚Üí El AI us√≥ otros chunks ‚ö†Ô∏è

### Paso 5: Validar Calidad

**En la consola del navegador (F12), ver√°s:**

```javascript
üéØ Test Result: ‚úÖ MATCHED
   Target: 0
   Referenced: [0, 1]
```

O si no coincide:

```javascript
üéØ Test Result: ‚ùå NOT MATCHED
   Target: 0
   Referenced: [1, 2]  // Us√≥ otros chunks
```

---

## üé® Caracter√≠sticas del Panel

### Panel Izquierdo (Chunks)

**Features:**
- ‚úÖ Lista completa de chunks del documento
- ‚úÖ Muestra texto completo de cada chunk
- ‚úÖ N√∫mero de chunk y p√°ginas
- ‚úÖ Token count
- ‚úÖ Click para seleccionar
- ‚úÖ Selecci√≥n visual (fondo azul cuando activo)
- ‚úÖ Scrolleable (si hay muchos chunks)

**Interaction:**
- Click en chunk ‚Üí Selecciona como objetivo
- Selecciona texto dentro del chunk ‚Üí Genera preguntas sugeridas

### Panel Derecho (Chat)

**Features:**
- ‚úÖ Chat de prueba aislado (no afecta historial principal)
- ‚úÖ Preguntas sugeridas basadas en contenido
- ‚úÖ Input directo con Enter para enviar
- ‚úÖ Muestra indicador "üéØ Chunk #X seleccionado"
- ‚úÖ Respuestas con referencias completas
- ‚úÖ Validaci√≥n autom√°tica (verde/naranja)
- ‚úÖ MessageRenderer completo (markdown, badges, footer)

**Validation:**
- Badge verde si chunk objetivo fue referenciado
- Badge naranja si AI us√≥ otros chunks
- Logs en consola con detalles exactos

---

## üî¨ Casos de Uso

### Caso 1: Validar Cobertura de Chunks

**Objetivo:** ¬øTodos los chunks son √∫tiles o hay chunks que nunca se usan?

**Proceso:**
1. Selecciona Chunk #0
2. Pregunta: "¬øQu√© dice sobre escaleras?"
3. Verifica si [1] apunta a Chunk #0
4. Selecciona Chunk #1
5. Pregunta: "¬øQu√© dice sobre superficie?"
6. Verifica referencias
7. Repite para cada chunk

**Resultado:** Identificas qu√© chunks son "descubiertos" vs "hu√©rfanos"

### Caso 2: Probar Precisi√≥n del RAG

**Objetivo:** ¬øEl RAG selecciona el chunk correcto basado en la pregunta?

**Proceso:**
1. Lee Chunk #1 (habla sobre "m√©todos de c√°lculo")
2. Pregunta: "¬øCu√°les son los m√©todos de c√°lculo?"
3. Espera que [1] referencie Chunk #1
4. Verifica score de similitud (deber√≠a ser >80%)

**Resultado:** Validas que RAG funciona correctamente

### Caso 3: Ajustar Threshold

**Objetivo:** Encontrar el threshold √≥ptimo de similitud

**Proceso:**
1. Selecciona Chunk #2 (contenido espec√≠fico)
2. Haz pregunta muy espec√≠fica sobre ese contenido
3. Observa % de similitud reportado
4. Si es <60% pero a√∫n correcto ‚Üí Threshold puede ser m√°s bajo
5. Ajusta en configuraci√≥n RAG

**Resultado:** Optimizas configuraci√≥n del sistema

### Caso 4: Debugging de Respuestas

**Objetivo:** Entender por qu√© AI respondi√≥ de cierta manera

**Proceso:**
1. AI dio respuesta inesperada en chat principal
2. Abre documento en panel de prueba
3. Lee cada chunk para encontrar de d√≥nde vino
4. Haz pregunta similar
5. Ve qu√© chunk selecciona RAG
6. Compara con chunk esperado

**Resultado:** Identificas si problema es chunking, RAG, o prompt

---

## üí° Tips de Uso

### Preguntas Efectivas

**‚úÖ Buenas preguntas:**
- "¬øQu√© dice sobre [tema espec√≠fico del chunk]?"
- "Explica el [concepto mencionado en el chunk]"
- "Resume esta secci√≥n"
- Preguntas que SOLO pueden responderse con ese chunk

**‚ùå Preguntas muy gen√©ricas:**
- "¬øDe qu√© trata el documento?" (puede usar cualquier chunk)
- "Resume todo" (usar√° m√∫ltiples chunks)
- "¬øQu√© dice?" (demasiado vago)

### Interpretar Resultados

**Scenario A: Match Perfecto ‚úÖ**
```
Pregunta sobre Chunk #0
Referencias: [1] Chunk #0, 87% similar
Badge: ‚úì Chunk objetivo referenciado
```
**Interpretaci√≥n:** RAG funcionando perfectamente

**Scenario B: Match Parcial ‚ö†Ô∏è**
```
Pregunta sobre Chunk #0
Referencias: [1] Chunk #0 (85%), [2] Chunk #1 (72%)
Badge: ‚úì Chunk objetivo referenciado
```
**Interpretaci√≥n:** Encontr√≥ el objetivo + contexto adicional (normal)

**Scenario C: No Match ‚ùå**
```
Pregunta sobre Chunk #0
Referencias: [1] Chunk #1 (78%), [2] Chunk #2 (65%)
Badge: ‚ö† Chunk objetivo NO usado
```
**Interpretaci√≥n:**
- Pregunta no fue lo suficientemente espec√≠fica, O
- Chunk #1 y #2 tienen contenido m√°s relevante, O
- Threshold demasiado alto (bajar a 0.3)

---

## üß™ Ejemplo de Sesi√≥n de Prueba

### Documento: DDU-ESP-075-07.pdf (3 chunks)

**Chunk #0:**
```
La Circular DDU-ESPEC√çFICA N¬∫ 75 / 2007 establece que, para escaleras 
que no forman parte de una v√≠a de evacuaci√≥n, se debe calcular el 100% 
de su superficie en cada piso.
```

**Chunk #1:**
```
Se presentan dos m√©todos para realizar este c√°lculo del 100% de la 
superficie edificada: M√©todo 1 calcula hasta el descanso en el primer 
piso...
```

**Chunk #2:**
```
M√©todo 2 considera toda la superficie de la escalera en cada piso, como 
si se abatiera la escalera hacia el primer piso...
```

### Test 1: Pregunta sobre Chunk #0

**Selecciono:** Chunk #0  
**Pregunta:** "¬øQu√© porcentaje de la superficie de escaleras se debe calcular?"  
**Respuesta:** "Seg√∫n la circular [1], se debe calcular el 100% de la superficie..."  
**Referencias:** [1] Chunk #0, 89.2% similar  
**Resultado:** ‚úÖ MATCH - RAG seleccion√≥ el chunk correcto

### Test 2: Pregunta sobre Chunk #1

**Selecciono:** Chunk #1  
**Pregunta:** "¬øCu√°les son los m√©todos de c√°lculo mencionados?"  
**Respuesta:** "Existen dos m√©todos [1][2]. El M√©todo 1 calcula hasta el descanso..."  
**Referencias:**  
  - [1] Chunk #1, 85.7% similar  
  - [2] Chunk #2, 71.3% similar  
**Resultado:** ‚úÖ MATCH - Chunk objetivo est√° en [1]

### Test 3: Pregunta Gen√©rica (Multi-chunk)

**Selecciono:** Chunk #0  
**Pregunta:** "Resume el documento completo"  
**Respuesta:** "La circular [1] establece el c√°lculo [2] usando dos m√©todos [3]..."  
**Referencias:**  
  - [1] Chunk #0, 45.2%  
  - [2] Chunk #1, 52.8%  
  - [3] Chunk #2, 48.5%  
**Resultado:** ‚ö†Ô∏è NO MATCH - Pregunta muy amplia, us√≥ todos los chunks (esperado)

---

## üé® Interfaz

### Layout

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üéØ Prueba Interactiva de Documento                       [X]‚îÇ
‚îÇ DDU-ESP-075-07.pdf                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ ‚îÇ üìÑ Chunks (3)        ‚îÇ üí¨ Chat de Prueba                ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ Chunk #0 seleccionado            ‚îÇ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ ‚îÇ                      ‚îÇ                                  ‚îÇ‚îÇ
‚îÇ ‚îÇ [Chunk #0] ‚Üê Activo  ‚îÇ [Mensajes de prueba]             ‚îÇ‚îÇ
‚îÇ ‚îÇ Texto completo...    ‚îÇ                                  ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ Usuario: ¬øQu√© dice sobre...?     ‚îÇ‚îÇ
‚îÇ ‚îÇ [Chunk #1]           ‚îÇ                                  ‚îÇ‚îÇ
‚îÇ ‚îÇ Texto completo...    ‚îÇ AI: Seg√∫n [1], el c√°lculo...     ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ    ‚úì Chunk objetivo referenciado ‚îÇ‚îÇ
‚îÇ ‚îÇ [Chunk #2]           ‚îÇ    üìö Referencias:               ‚îÇ‚îÇ
‚îÇ ‚îÇ Texto completo...    ‚îÇ    [1] 87% - Chunk #0 ‚úÖ         ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ                                  ‚îÇ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÇ
‚îÇ ‚îÇ                      ‚îÇ üí° Preguntas sugeridas           ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ ‚Ä¢ ¬øQu√© dice sobre escaleras?     ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ                                  ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ [Escribe pregunta...] [Probar]   ‚îÇ‚îÇ
‚îÇ ‚îÇ                      ‚îÇ üéØ Chunk #0 seleccionado         ‚îÇ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Colores y Estados

**Chunks:**
- Seleccionado: Fondo azul claro, borde azul
- No seleccionado: Fondo blanco, borde gris
- Hover: Fondo gris muy claro

**Badges de Validaci√≥n:**
- Verde "‚úì Chunk objetivo referenciado" ‚Üí √âxito
- Naranja "‚ö† Chunk objetivo NO usado" ‚Üí No coincide

**Referencias:**
- Verde: ‚â•80% similitud
- Amarillo: 60-80% similitud
- Naranja: <60% similitud

---

## üîß Technical Details

### API Call

**Endpoint usado:**
```
POST /api/conversations/temp-test/messages
```

**Body:**
```json
{
  "userId": "...",
  "message": "¬øQu√© dice sobre escaleras?",
  "model": "gemini-2.5-flash",
  "systemPrompt": "Eres un asistente experto...",
  "contextSources": [{
    "id": "sourceId",
    "name": "DDU.pdf",
    "type": "pdf",
    "content": "Chunk #0\n\nChunk #1\n\nChunk #2..."
  }],
  "ragEnabled": true,
  "ragTopK": 3,
  "ragMinSimilarity": 0.3
}
```

**Response:**
```json
{
  "assistantMessage": {
    "content": {
      "text": "Seg√∫n [1], el c√°lculo..."
    }
  },
  "references": [
    {
      "id": 1,
      "sourceId": "...",
      "sourceName": "DDU.pdf",
      "chunkIndex": 0,
      "similarity": 0.873,
      "fullText": "..."
    }
  ]
}
```

### Validation Logic

```typescript
if (selectedChunkIndex !== null && references.length > 0) {
  const referencedChunks = references.map(r => r.chunkIndex);
  const matched = referencedChunks.includes(selectedChunkIndex);
  
  console.log(`üéØ Target: ${selectedChunkIndex}`);
  console.log(`üìö Referenced: [${referencedChunks.join(', ')}]`);
  console.log(`‚úÖ Match: ${matched ? 'YES' : 'NO'}`);
}
```

---

## üìä What You Can Learn

### 1. Chunk Quality

**Preguntas:**
- ¬øCada chunk es auto-contenido?
- ¬øSe puede responder preguntas con un solo chunk?
- ¬øHay chunks que nunca se usan?

**Acci√≥n:** Re-chunk con tama√±o diferente si hay problemas

### 2. RAG Performance

**Preguntas:**
- ¬øLos scores de similitud son altos (>70%)?
- ¬øRAG selecciona los chunks correctos?
- ¬øThreshold de 0.5 es apropiado?

**Acci√≥n:** Ajustar threshold o modelo de embeddings

### 3. Document Coverage

**Preguntas:**
- ¬øTodos los chunks son accesibles v√≠a preguntas?
- ¬øHay secciones que nunca se referencian?
- ¬øEl documento est√° bien estructurado?

**Acci√≥n:** Mejorar estructura del documento original

---

## ‚úÖ Pr√≥ximos Pasos

### Ahora Que Tienes el Panel:

1. **Cerrar** el modal de configuraci√≥n
2. **Volver a abrir** (settings del documento DDU)
3. **Scroll** hasta "Indexaci√≥n RAG"
4. **Buscar** bot√≥n morado "Probar Documento Interactivamente"
5. **Click** ‚Üí Panel se abre
6. **Seleccionar** Chunk #0
7. **Click** en pregunta sugerida o escribe una
8. **Presionar** "Probar"
9. **Observar** si el badge verde "‚úì Chunk objetivo referenciado" aparece
10. **Ver** referencias en el footer con similitud

---

## üêõ Troubleshooting

### "No veo el bot√≥n de Probar Documento"

**Causas:**
- Documento no tiene chunks indexados
- `chunksData` est√° null

**Soluci√≥n:**
- Re-indexar el documento primero
- Esperar a que complete
- Cerrar y reabrir modal

### "Referencias no coinciden con chunk seleccionado"

**Esto es NORMAL si:**
- Pregunta es muy gen√©rica
- Otros chunks son m√°s relevantes
- Pregunta menciona conceptos de m√∫ltiples chunks

**Esto es PROBLEMA si:**
- Pregunta es MUY espec√≠fica del chunk
- Similitud del chunk objetivo es baja (<50%)
- Nunca coincide incluso con preguntas directas

**Soluci√≥n:** Bajar threshold a 0.2 temporalmente para testing

---

## üìù Ejemplo Completo de Testing

```
1. Abrir modal de documento DDU-ESP-075-07.pdf
2. Click "Probar Documento Interactivamente"
3. Ver 3 chunks en panel izquierdo
4. Click en Chunk #0
5. Ver preguntas sugeridas en panel derecho
6. Click "¬øQu√© dice sobre escaleras?"
7. Click "Probar"
8. Ver pasos animados: Pensando ‚Üí Buscando ‚Üí Seleccionando ‚Üí Generando
9. Ver respuesta streaming
10. Ver badge: "‚úì Chunk objetivo referenciado" (verde) ‚úÖ
11. Scroll en respuesta ‚Üí Ver footer "üìö Referencias utilizadas (1)"
12. Ver: [1] DDU.pdf - 87.3% similar - Chunk #0 ‚Üê ¬°MATCH!
13. Click en [1] ‚Üí Panel derecho se abre con texto completo del chunk
14. Verificar que es el mismo texto que viste en Chunk #0
15. ‚úÖ VALIDACI√ìN COMPLETA - RAG funciona correctamente!
```

---

**Status:** ‚úÖ Listo para usar

**Comando para probar:**
```
1. Abre http://localhost:3000/chat
2. Settings del documento DDU-ESP-075-07.pdf
3. Scroll a "Indexaci√≥n RAG"
4. Click bot√≥n morado "Probar Documento Interactivamente"
5. ¬°A probar! üöÄ
```

**Expected result:** Panel fullscreen con chunks a la izquierda y chat de prueba a la derecha, con validaci√≥n autom√°tica de referencias.

