# Flow AI Platform CLI

**Version**: 0.1.0  
**Status**: âœ… Production Ready (Read-Only)

Secure command-line interface for Flow AI Platform administrators and developers.

## ğŸ¯ Purpose

This CLI provides **read-only** access to Flow platform analytics and usage statistics. It's designed for:

- **SuperAdmins**: Create and manage API keys for domain admins
- **Domain Admins**: View usage statistics for their domain
- **Developers**: Integrate platform analytics into tools and dashboards

## ğŸ”’ Security Model

### API Key Authentication

- **API keys** are generated by SuperAdmins in the Flow platform
- Keys are **hashed** (SHA-256) before storage
- Keys can have **expiration dates** for security
- All requests are **logged and auditable**

### Permission Model (v0.1.0)

Current release supports **read-only** access:
- âœ… `canReadUsageStats`: View domain usage statistics
- ğŸ”œ Future: Write operations, agent management, etc.

## ğŸ“¦ Installation

### NPM (Global)
```bash
npm install -g @flow-ai/cli
```

### NPX (No install)
```bash
npx @flow-ai/cli usage-stats @mydomain.com
```

## ğŸš€ Quick Start

### 1. Get Your API Key

**SuperAdmins** create API keys in the Flow platform:
1. Login to Flow platform: https://flow.getaifactory.com
2. Navigate to SuperAdmin â†’ API Keys
3. Click "Create New API Key"
4. Assign to an admin email and domain
5. Copy the generated key (shown only once!)

### 2. Login with CLI

```bash
# Production
flow login <your-api-key>

# Localhost (development)
flow login <your-api-key> --endpoint http://localhost:3000
```

**Example:**
```bash
flow login <REDACTED_API_KEY>REDACTED
```

### 3. View Usage Stats

```bash
# View stats for your domain (last 7 days)
flow usage-stats @mydomain.com

# Specify time range (last 30 days)
flow usage-stats @mydomain.com --days 30

# Export as JSON
flow usage-stats @mydomain.com --format json > stats.json
```

## ğŸ“Š Available Commands

### `flow login <api-key>`

Authenticate the CLI with your Flow API key.

**Options:**
- `-e, --endpoint <url>`: API endpoint (default: http://localhost:3000)

**Example:**
```bash
flow login <REDACTED_API_KEY>REDACTED --endpoint https://flow.getaifactory.com
```

### `flow usage-stats <domain>`

View domain usage statistics (read-only).

**Arguments:**
- `<domain>`: Domain to query (e.g., @mydomain.com)

**Options:**
- `-d, --days <number>`: Number of days to analyze (default: 7)
- `-f, --format <format>`: Output format: table (default) or json

**Example:**
```bash
flow usage-stats @salfacorp.com --days 30
```

**Output:**
```
ğŸ“Š Usage Statistics: @salfacorp.com
Period: Last 30 days (Oct 1, 2025 - Oct 30, 2025)

ğŸ‘¥ Users
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric      â”‚ Value â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total Users â”‚ 45    â”‚
â”‚ Active Usersâ”‚ 32 (71.1%) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¤– Agents & Conversations
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric                   â”‚ Value  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total Agents             â”‚ 120    â”‚
â”‚ Conversations            â”‚ 340    â”‚
â”‚ Messages                 â”‚ 2,450  â”‚
â”‚ Avg Messages/Conversationâ”‚ 7.2    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš¡ Model Usage
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model â”‚ Requests â”‚ Tokens   â”‚ Cost (USD) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Flash â”‚ 2,100    â”‚ 1,250,000â”‚ $0.1875    â”‚
â”‚ Pro   â”‚ 350      â”‚ 450,000  â”‚ $2.8125    â”‚
â”‚ Total â”‚ 2,450    â”‚ 1,700,000â”‚ $3.0000    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’° Cost Summary
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Metric            â”‚ Value    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total Cost        â”‚ $3.00    â”‚
â”‚ Cost per User     â”‚ $0.0667  â”‚
â”‚ Cost per Message  â”‚ $0.0012  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### `flow status`

Show current authentication status.

**Example:**
```bash
flow status
```

**Output:**
```
ğŸ” Flow CLI Status

âœ… Authenticated
User: admin@mydomain.com
Role: admin
Endpoint: https://flow.getaifactory.com

Config: ~/.flow-cli/config.json
```

### `flow logout`

Clear stored credentials.

**Example:**
```bash
flow logout
```

### `flow config`

Show configuration file location and settings.

**Example:**
```bash
flow config
```

## ğŸ”§ Configuration

Configuration is stored in `~/.flow-cli/config.json`:

```json
{
  "apiKey": "<REDACTED_API_KEY>REDACTED",
  "apiEndpoint": "https://flow.getaifactory.com",
  "userEmail": "admin@mydomain.com",
  "userRole": "admin",
  "lastUpdated": "2025-10-30T10:00:00.000Z"
}
```

**Security:**
- File permissions: `0600` (owner read/write only)
- API key is stored encrypted
- Never committed to git
- Never shared between users

## ğŸ›¡ï¸ Security Best Practices

### For SuperAdmins

1. **Rotate API keys regularly** (every 90 days)
2. **Set expiration dates** when creating keys
3. **Revoke unused keys** immediately
4. **Monitor API key usage** in the platform
5. **One key per admin** (never share)

### For Admins

1. **Store API key securely** (password manager)
2. **Never commit API key** to git
3. **Never share API key** with others
4. **Use environment-specific keys** (dev vs prod)
5. **Report compromised keys** immediately to SuperAdmin

## ğŸ” Troubleshooting

### "Not authenticated"

**Problem:** CLI shows "Not authenticated" when running commands.

**Solution:**
```bash
# 1. Check authentication status
flow status

# 2. Login again
flow login <your-api-key>

# 3. Test connection
flow status
```

### "Invalid API key"

**Problem:** API key not recognized.

**Possible causes:**
1. API key was revoked
2. API key has expired
3. Wrong API key (typo)
4. Wrong endpoint (localhost vs production)

**Solution:**
```bash
# Verify with SuperAdmin
# Request new API key if needed
flow login <new-api-key>
```

### "Cannot access other domains"

**Problem:** Trying to query a domain you don't have access to.

**Solution:**
```bash
# You can only access YOUR assigned domain
# Check your domain assignment with SuperAdmin
flow status  # Shows your domain
```

### "Network error"

**Problem:** Cannot connect to API endpoint.

**Solution:**
```bash
# Check endpoint
flow config

# Update endpoint if needed
flow login <your-api-key> --endpoint https://correct-url.com

# Verify endpoint is accessible
curl https://your-endpoint.com/api/cli/auth/verify
```

## ğŸ“š API Reference

### Authentication Flow

```
1. User runs: flow login <api-key>
2. CLI hashes API key
3. CLI sends hashed key to /api/cli/auth/verify
4. Server verifies hash against Firestore
5. Server checks expiration
6. Server returns user info
7. CLI caches user info locally
8. All subsequent commands include API key header
```

### Request Headers

```
X-API-Key: <your-api-key>
Content-Type: application/json
```

### Response Format

All API responses follow this structure:

```json
{
  "success": true,
  "data": { ... },
  "timestamp": "2025-10-30T10:00:00.000Z"
}
```

Error responses:

```json
{
  "success": false,
  "error": "Error message",
  "timestamp": "2025-10-30T10:00:00.000Z"
}
```

## ğŸš€ Development

### Build from Source

```bash
# Clone repository
git clone https://github.com/getaifactory/flow-platform.git
cd flow-platform/packages/flow-cli

# Install dependencies
npm install

# Build
npm run build

# Link locally
npm link

# Test
flow --help
```

### Run in Dev Mode

```bash
# Watch mode
npm run dev

# In another terminal
node dist/index.js usage-stats @test.com
```

## ğŸ“‹ Changelog

### v0.1.0 (2025-10-30)

**Initial Release - Read-Only SuperAdmin CLI**

**Features:**
- âœ… API key authentication
- âœ… SuperAdmin API key management
- âœ… Domain usage statistics (read-only)
- âœ… Beautiful terminal output with tables
- âœ… JSON export format
- âœ… Secure configuration storage
- âœ… API key expiration support

**Commands:**
- `flow login` - Authenticate
- `flow logout` - Clear credentials
- `flow status` - Check auth status
- `flow usage-stats` - View domain stats
- `flow config` - Show configuration

**Permissions:**
- âœ… `canReadUsageStats`: View usage data

**Limitations:**
- Read-only (no write operations)
- SuperAdmin only for API key creation
- Single domain per API key
- No admin self-service (yet)

## ğŸ”® Roadmap

### v0.2.0 (Planned)

- [ ] Admin self-service API key rotation
- [ ] Multiple domains per API key
- [ ] Agent management commands
- [ ] Context management commands
- [ ] Bulk operations

### v0.3.0 (Planned)

- [ ] Agent deployment via CLI
- [ ] Context upload via CLI
- [ ] Evaluation submission
- [ ] Custom report generation

## ğŸ“ Support

**Issues:** https://github.com/getaifactory/flow-platform/issues  
**Email:** hello@getaifactory.com  
**Documentation:** https://docs.flow.getaifactory.com

## ğŸ“„ License

MIT License - see LICENSE file for details

---

**Built with â¤ï¸ by the Flow AI team**










