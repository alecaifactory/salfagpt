<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Dashboard - Flow</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 32px;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .header p {
      color: #666;
      font-size: 16px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }
    
    .stat-card .value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-card .value.good { color: #10b981; }
    .stat-card .value.warn { color: #f59e0b; }
    .stat-card .value.bad { color: #ef4444; }
    
    .stat-card .label {
      font-size: 12px;
      color: #999;
    }
    
    .section {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .section h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #667eea;
    }
    
    .metric-row {
      display: flex;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #f0f0f0;
      transition: background 0.2s;
    }
    
    .metric-row:hover {
      background: #f9fafb;
    }
    
    .metric-row:last-child {
      border-bottom: none;
    }
    
    .metric-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-right: 15px;
    }
    
    .metric-icon.good { background: #d1fae5; }
    .metric-icon.warn { background: #fef3c7; }
    .metric-icon.bad { background: #fee2e2; }
    
    .metric-info {
      flex: 1;
    }
    
    .metric-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .metric-category {
      font-size: 12px;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .metric-duration {
      font-size: 24px;
      font-weight: bold;
      margin-right: 20px;
    }
    
    .metric-duration.good { color: #10b981; }
    .metric-duration.warn { color: #f59e0b; }
    .metric-duration.bad { color: #ef4444; }
    
    .chart-container {
      margin-top: 20px;
      height: 300px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #f0f0f0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress-fill {
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .progress-fill.good { background: #10b981; }
    .progress-fill.warn { background: #f59e0b; }
    .progress-fill.bad { background: #ef4444; }
    
    .recommendations {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
    }
    
    .recommendations h3 {
      font-size: 18px;
      color: #92400e;
      margin-bottom: 15px;
    }
    
    .recommendations ul {
      list-style: none;
    }
    
    .recommendations li {
      padding: 10px 0;
      color: #78350f;
      display: flex;
      align-items: center;
    }
    
    .recommendations li:before {
      content: "‚Üí";
      margin-right: 10px;
      font-weight: bold;
    }
    
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 10px 20px;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
    }
    
    .filter-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }
    
    .filter-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    
    .loading {
      text-align: center;
      padding: 60px;
      color: #999;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f0f0f0;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .refresh-btn {
      background: #667eea;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: background 0.2s;
      float: right;
    }
    
    .refresh-btn:hover {
      background: #5568d3;
    }
    
    .refresh-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üöÄ Performance Dashboard</h1>
      <p>Real-time performance monitoring for Flow platform - Target: &lt;100ms per operation</p>
      <button class="refresh-btn" onclick="runAudit()">üîÑ Run Audit</button>
    </div>
    
    <!-- Loading State -->
    <div id="loading" class="loading" style="display: none;">
      <div class="loading-spinner"></div>
      <p>Running performance audit...</p>
    </div>
    
    <!-- Stats Grid -->
    <div class="stats-grid" id="statsGrid"></div>
    
    <!-- Category Filters -->
    <div class="section">
      <h2>üìä Detailed Metrics</h2>
      <div class="filters" id="filters"></div>
      <div id="metricsContainer"></div>
    </div>
    
    <!-- Recommendations -->
    <div class="recommendations" id="recommendations" style="display: none;">
      <h3>üí° Optimization Recommendations</h3>
      <ul id="recommendationsList"></ul>
    </div>
  </div>
  
  <script>
    let currentData = null;
    let currentFilter = 'all';
    
    // Load data from JSON file (generated by performance-audit.ts)
    async function loadData() {
      try {
        // In production, this would load from /api/analytics/performance
        // For now, we'll use demo data
        const demoData = generateDemoData();
        return demoData;
      } catch (error) {
        console.error('Failed to load data:', error);
        return null;
      }
    }
    
    // Generate demo data
    function generateDemoData() {
      const categories = ['Frontend', 'API', 'Database', 'Component', 'Critical Flow', 'UI', 'Search', 'Admin'];
      const results = [];
      
      categories.forEach(category => {
        const count = Math.floor(Math.random() * 5) + 3;
        for (let i = 0; i < count; i++) {
          const duration = Math.random() * 200;
          results.push({
            name: `${category} Operation ${i + 1}`,
            category,
            duration: Math.round(duration),
            status: duration < 50 ? 'pass' : duration < 100 ? 'warn' : 'fail',
            timestamp: new Date().toISOString(),
          });
        }
      });
      
      return {
        timestamp: new Date().toISOString(),
        threshold: 100,
        results,
        summary: {
          total: results.length,
          passed: results.filter(r => r.status === 'pass').length,
          warned: results.filter(r => r.status === 'warn').length,
          failed: results.filter(r => r.status === 'fail').length,
          avgDuration: results.reduce((sum, r) => sum + r.duration, 0) / results.length,
        },
      };
    }
    
    // Render stats grid
    function renderStats(data) {
      const { summary } = data;
      const statsGrid = document.getElementById('statsGrid');
      
      const passRate = (summary.passed / summary.total * 100).toFixed(1);
      const avgStatus = summary.avgDuration < 50 ? 'good' : summary.avgDuration < 100 ? 'warn' : 'bad';
      
      statsGrid.innerHTML = `
        <div class="stat-card">
          <h3>Total Tests</h3>
          <div class="value">${summary.total}</div>
          <div class="label">Operations measured</div>
        </div>
        
        <div class="stat-card">
          <h3>Passed</h3>
          <div class="value good">${summary.passed}</div>
          <div class="label">&lt;50ms (${passRate}%)</div>
        </div>
        
        <div class="stat-card">
          <h3>Warnings</h3>
          <div class="value warn">${summary.warned}</div>
          <div class="label">50-100ms</div>
        </div>
        
        <div class="stat-card">
          <h3>Failed</h3>
          <div class="value bad">${summary.failed}</div>
          <div class="label">&gt;100ms (needs optimization)</div>
        </div>
        
        <div class="stat-card">
          <h3>Average Duration</h3>
          <div class="value ${avgStatus}">${summary.avgDuration.toFixed(1)}ms</div>
          <div class="label">Across all operations</div>
        </div>
      `;
    }
    
    // Render filters
    function renderFilters(data) {
      const categories = ['all', ...new Set(data.results.map(r => r.category))];
      const filtersContainer = document.getElementById('filters');
      
      filtersContainer.innerHTML = categories.map(cat => `
        <button 
          class="filter-btn ${cat === currentFilter ? 'active' : ''}"
          onclick="setFilter('${cat}')"
        >
          ${cat === 'all' ? 'üìä All' : cat}
        </button>
      `).join('');
    }
    
    // Render metrics
    function renderMetrics(data) {
      const filtered = currentFilter === 'all' 
        ? data.results 
        : data.results.filter(r => r.category === currentFilter);
      
      const sorted = filtered.sort((a, b) => b.duration - a.duration);
      
      const metricsContainer = document.getElementById('metricsContainer');
      
      metricsContainer.innerHTML = sorted.map(metric => {
        const icon = metric.status === 'pass' ? '‚úÖ' : metric.status === 'warn' ? '‚ö†Ô∏è' : '‚ùå';
        const statusClass = metric.status === 'pass' ? 'good' : metric.status === 'warn' ? 'warn' : 'bad';
        const percentage = (metric.duration / 200) * 100;
        
        return `
          <div class="metric-row">
            <div class="metric-icon ${statusClass}">
              ${icon}
            </div>
            <div class="metric-info">
              <div class="metric-name">${metric.name}</div>
              <div class="metric-category">${metric.category}</div>
              <div class="progress-bar">
                <div class="progress-fill ${statusClass}" style="width: ${percentage}%"></div>
              </div>
            </div>
            <div class="metric-duration ${statusClass}">
              ${metric.duration}ms
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Render recommendations
    function renderRecommendations(data) {
      const failed = data.results
        .filter(r => r.status === 'fail')
        .sort((a, b) => b.duration - a.duration)
        .slice(0, 5);
      
      if (failed.length === 0) {
        document.getElementById('recommendations').style.display = 'none';
        return;
      }
      
      document.getElementById('recommendations').style.display = 'block';
      
      const recommendations = failed.map(metric => {
        const tips = getOptimizationTips(metric);
        return `
          <li>
            <strong>${metric.name}</strong> (${metric.duration}ms) - ${tips}
          </li>
        `;
      });
      
      document.getElementById('recommendationsList').innerHTML = recommendations.join('');
    }
    
    // Get optimization tips
    function getOptimizationTips(metric) {
      const tips = {
        'API': 'Add caching, optimize query, reduce payload size',
        'Database': 'Create index, use pagination, denormalize data',
        'Component': 'Use React.memo(), virtualize lists, lazy load',
        'Critical Flow': 'Parallelize operations, add optimistic UI',
        'Frontend': 'Code splitting, lazy loading, tree shaking',
        'UI': 'Debounce inputs, optimize renders, reduce re-renders',
        'Search': 'Add search index, debounce input, limit results',
        'Admin': 'Pagination, lazy loading, background processing',
      };
      
      return tips[metric.category] || 'Profile and optimize bottlenecks';
    }
    
    // Set filter
    function setFilter(category) {
      currentFilter = category;
      renderFilters(currentData);
      renderMetrics(currentData);
    }
    
    // Run audit
    async function runAudit() {
      const loadingEl = document.getElementById('loading');
      const refreshBtn = document.querySelector('.refresh-btn');
      
      loadingEl.style.display = 'block';
      refreshBtn.disabled = true;
      
      // Simulate running audit
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      const data = await loadData();
      
      if (data) {
        currentData = data;
        renderStats(data);
        renderFilters(data);
        renderMetrics(data);
        renderRecommendations(data);
      }
      
      loadingEl.style.display = 'none';
      refreshBtn.disabled = false;
    }
    
    // Initialize
    runAudit();
  </script>
</body>
</html>

