# üìã M3-v2 Document Upload Plan - November 25, 2025

## üéØ **OBJECTIVE**

Update documents for agent **GOP GPT (M3-v2)** with new PDFs from Portal Edificaci√≥n.

**Agent Details:**
- **Agent ID:** `vStojK73ZKbjNsEnqANJ`
- **Agent Name:** GOP GPT (M3-v2)
- **Owner ID:** `usr_uhwqffaqag1wrryd82tw` (alec@getaifactory.com)

---

## üìä **CURRENT STATE (BEFORE)**

### Documents Currently Assigned to M3-v2

**Total:** 1 document

1. **GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF**
   - ID: `1EnH6gTnM6a33W4aUeNp`
   - RAG Enabled: Yes
   - Chunks: 3
   - Status: Active

---

## üì• **NEW DOCUMENTS TO UPLOAD**

### Source Folder
```
/Users/alec/salfagpt/upload-queue/M3-v2-20251125/
```

### Document Count
**Total PDFs:** 62 files

### Document Categories

#### Primera carga de documentacion (29 PDFs):

**1. PLANIFICACI√ìN INICIAL DE LA OBRA (1 PDF):**
1. GOP-D-PI-1.PLANIFICACION INICIAL DE OBRA-(V.1) (1).PDF

**2. PLAN DE CALIDAD Y OPERACI√ìN DE OBRA (18 PDFs):**

2.1. CALIDAD Y OPERACI√ìN DE OBRA (13 PDFs):
2. 6.5 MAQ-LOG-CBO-P-001 GESTION DE BODEGAS DE OBRAS REV.07.PDF
3. CONTRATACION DE SUBCONTRATISTAS.PDF
4. GOP-P-PCO-2.1.ANEXO RESUMEN REVISIONES MITO-(V.0).PDF
5. GOP-P-PCO-2.1.DETECCION DE HALLAZGOS Y NO CONFORMIDADES-(V.5).PDF
6. GOP-P-PCO-2.1.EVALUACION SUBCONTRATOS-(V.0).PDF
7. GOP-P-PCO-2.1.INSTRUCTIVO CALCULO DE STOCK CRITICO-(V.0).PDF
8. GOP-P-PCO-2.1.INSTRUCTIVO MODULADOR DE BODEGAS-(V.0).PDF
9. GOP-P-PCO-2.1.MATRIZ DE OBJETIVOS DE CONTROL DE OBRA-(V.0).PDF
10. GOP-P-PCO-2.1.PROCEDIMIENTO DE GESTION DE CONSTRUCCION EN OBRA-(V.2).PDF
11. GOP-P-PCO-2.1.PROCEDIMIENTO ENTREGA OBRA A POST VENTA-(V.0).PDF
12. GOP-P-PCO-2.1.PROCEDIMIENTO INICIO DE OBRAS DE EDIFICACION-(V.0).PDF
13. RESUMEN Y PREGUNTAS.docx.pdf

2.2. CONTROL MATERIALES Y ENSAYOS (3 PDFs):
14. GOP-P-PCO-2.2.PROCEDIMIENTO ELABORACION Y CONTROL CH-(V.0).PDF
15. GOP-P-PCO-2.2.TRAZABILIDAD, CERTIFICADOS Y ENSAYOS-(V.4)(1).PDF
16. GOP-P-PCO-2.2.TRAZABILIDAD, CERTIFICADOS Y ENSAYOS-(V.4).PDF

2.4. CONTROL DE DOCUMENTOS (1 PDF):
17. GOP-R-PCO-2.4.MINUTA_DE_REUNION-(V.0).DOCX.pdf

2.5. CONTROL PORTERIA OBRA (1 PDF):
18. GOP-P-PCO-2.5.RESPONSABILIDADES EN PORTERIA-(V.0).PDF

Root (2 PDFs):
19. GOP-D-PCO-2.PLAN DE CALIDAD Y OPERACION-(V.1).PDF
20. GOP-P-PCO-2.ELABORACION DE DOCUMENTOS-(V.0).PDF

**3. PANEL FINANCIERO (6 PDFs):**

3.1. ANEXOS PF (4 PDFs):
21. GOP-P-PF-3.1.ANEXO 1 MANO DE OBRA-(V.0).PDF
22. GOP-P-PF-3.1.ANEXO 2 MANO DE OBRA-(V.0).PDF
23. GOP-P-PF-3.1.ANEXO 3 EQUIPOS-(V.0).PDF
24. GOP-P-PF-3.1.ANEXO 4 EQUIPOS-(V.0).PDF

Root (2 PDFs):
25. GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1) (1).PDF ‚≠ê **VERSION MATCH**
26. GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS EXENTOS-(V.1) (1).PDF

**4. ENTORNO VECINO (1 PDF):**
27. GOP-P-EV-4.ENTORNO VECINOS Y RELACIONAMIENTO COMUNITARIO-(V.4).PDF

**5. CONTROL DE ETAPA (1 PDF):**
28. GOP-P-CE-5.PROCEDIMIENTO CONTROL DE ETAPA DS49-(V.0).PDF

**Root duplicates (2 PDFs):**
29. GOP-D-PCO-2.PLAN DE CALIDAD Y OPERACION-(V.1).PDF (duplicate)
30. GOP-P-PCO-2.ELABORACION DE DOCUMENTOS-(V.0).PDF (duplicate)

#### Segunda carga de documentacion 19-11 (33 PDFs):

**1. PLANIFICACION INICIAL DE OBRA (1 PDF):**
31. GOP-D-PI-1.PLANIFICACION INICIAL DE OBRA-(V.2).pdf ‚≠ê **VERSION UPDATE V1‚ÜíV2**

**2. PLAN DE CALIDAD Y OPERACION DE OBRA (17 PDFs):**

2.1. CALIDAD Y OPERACION DE OBRA (9 PDFs):
32. 6.5 MAQ-LOG-CBO-P-001 Gesti√≥n de Bodegas de Obras Rev.07.pdf
33. CONTRATACION DE SUBCONTRATISTAS.pdf
34. GOP-P-PCO-2.1.ANEXO RESUMEN REVISIONES MITO-(V.0).pdf
35. GOP-P-PCO-2.1.EVALUACION SUBCONTRATOS-(V.0).pdf
36. GOP-P-PCO-2.1.INSTRUCTIVO CALCULO DE STOCK CRITICO-(V.0).pdf
37. GOP-P-PCO-2.1.INSTRUCTIVO MODULADOR DE BODEGAS-(V.0).pdf
38. GOP-P-PCO-2.1.MATRIZ DE OBJETIVOS DE CONTROL DE OBRA-(V.0).pdf
39. GOP-P-PCO-2.1.MATRIZ DE RIESGOS Y OPORTUNIDADES.pdf ‚≠ê **NEW**
40. GOP-P-PCO-2.1.PROCEDIMIENTO ENTREGA OBRA A POST VENTA-(V.0).pdf

2.2. CONTROL MATERIALES Y ENSAYOS (2 PDFs):
41. GOP-P-PCO-2.2.PROCEDIMIENTO ELABORACION Y CONTROL CH-(V.0).pdf
42. GOP-P-PCO-2.2.TRAZABILIDAD, CERTIFICADOS Y ENSAYOS-(V.4).pdf

2.5. CONTROL PORTERIA OBRA (1 PDF):
43. GOP-P-PCO-2.5.RESPONSABILIDADES EN PORTERIA-(V.0).PDF

2.6. POLITICAS CALIDAD (5 PDFs): ‚≠ê **ALL NEW**
44. GOP-P-PCO-2.6.BRISAS DE BATUCO-(V.1).pdf
45. GOP-P-PCO-2.6.GEOMAR V-(V.1).pdf
46. GOP-P-PCO-2.6.NOVAL-(V.1).pdf
47. GOP-P-PCO-2.6.NOVATEC EDIFICIOS-(V.1).pdf
48. GOP-P-PCO-2.6.NOVATEC-(V.1).pdf

Root (1 PDF):
49. GOP-D-PCO-2.PLAN DE CALIDAD Y OPERACION-(V.1).pdf

**3. PANEL FINANCIERO (8 PDFs):**

Extra root (1 PDF):
50. 20240222-BODEGA NEWS! NUEVO Paso a Paso MAQ-LOG-CBO-PP-019 MANEJO DE STOCK CR√çTICO-PEP NIVEL 4 (1).pdf ‚≠ê **NEW**

3.1. ANEXOS PF (4 PDFs):
51. GOP-P-PF-3.1.ANEXO 1 MANO DE OBRA-(V.0).pdf
52. GOP-P-PF-3.1.ANEXO 2 MANO DE OBRA-(V.0).pdf
53. GOP-P-PF-3.1.ANEXO 3 EQUIPOS-(V.0).pdf
54. GOP-P-PF-3.1.ANEXO 4 EQUIPOS-(V.0).pdf

Root (2 PDFs):
55. GOP-D-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS-(V.1).pdf
56. GOP-D-PF-3.PROCESO PANEL FINANCIERO PROYECTOS EXENTOS-(V.1).pdf

**4. ENTORNO VECINO (2 PDFs):**
57. GOP-P-EV-4.ENTORNO VECINOS Y RELACIONAMIENTO COMUNITARIO-(V.4).pdf
58. Presentacion Manual Relacionamiento Comunitario 2024 13-08.pdf ‚≠ê **NEW**

**5. CONTROL DE ETAPA (1 PDF):**
59. GOP-P-CE-5.PROCEDIMIENTO CONTROL DE ETAPA DS49-(V.0).pdf

**6. AFE LOGISTICA (1 PDF):** ‚≠ê **NEW CATEGORY**
60. AFE Log y adm de bodega Rev 5.2.pdf

**Root files (2 PDFs):**
61. GOP-P-PCO-2.1.INSTRUCTIVO MODULADOR DE BODEGAS-(V.0) (2) (1) (1).pdf
62. MAQ-LOG-CBO-PP-019 Manejo de Stock Cr√≠tico-PEP Nivel 4.pdf

---

## üîÑ **ANALYSIS**

### Documents That Will Be Updated

**Criteria:** Same base filename but potentially different versions or duplicates

Matching by filename similarity:

1. **GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS** (currently exists, will be updated)
   - Current version has " (1)" suffix
   - New version also has " (1)" or no suffix

### New Documents to Add

**Total New:** Approximately **61 new documents** (62 total - 1 existing match)

**New Categories:**
- Section 2.6: POLITICAS CALIDAD (5 documents)
- Section 6: AFE LOGISTICA (1 document)
- New presentations and additional procedures

---

## üìç **AFTER UPLOAD**

### Expected Final State

**Total documents assigned to M3-v2:** 
- **Current:** 1 document
- **To add:** 62 documents
- **Expected final:** **63 documents** (assuming we keep the existing one)

### Chunking Estimate

Assuming average 5-10 chunks per document:
- **Current chunks:** 3
- **Expected new chunks:** ~310-620 (62 docs √ó 5-10 chunks)
- **Total chunks after:** ~313-623 chunks

---

## üöÄ **EXECUTION PLAN**

### Requirements

1. ‚úÖ **GCS Bucket:** `salfagpt-context-documents` in `us-east4`
2. ‚úÖ **Firestore:** `us-central1` (metadata storage)
3. ‚úÖ **BigQuery:** `flow_analytics_east4` in `us-east4` (RAG embeddings)
4. ‚úÖ **Agent ID:** `vStojK73ZKbjNsEnqANJ`
5. ‚úÖ **Owner ID:** `usr_uhwqffaqag1wrryd82tw`

### Upload Pipeline Steps

For each PDF:

**1. Upload to GCS (us-east4)**
```
gs://salfagpt-context-documents/usr_uhwqffaqag1wrryd82tw/vStojK73ZKbjNsEnqANJ/{filename}
```

**2. Extract with Gemini**
- Model: `gemini-2.5-flash` (cost-effective)
- Extract: Full text, tables, images

**3. Save to Firestore (us-central1)**
- Collection: `context_sources`
- Fields:
  - `userId`: `usr_uhwqffaqag1wrryd82tw`
  - `name`: filename
  - `type`: `'pdf'`
  - `assignedToAgents`: `['vStojK73ZKbjNsEnqANJ']`
  - `tags`: `['M3-v2-20251125']`
  - `ragEnabled`: `true`
  - `status`: `'active'`
  - `extractedData`: full text
  - `originalFileUrl`: GCS path
  - `metadata`: extraction details

**4. Chunk & Embed**
- Chunk size: ~1000 tokens
- Embedding model: `text-embedding-004`
- Store in: `document_chunks` collection

**5. Index in BigQuery (us-east4)**
- Dataset: `flow_analytics_east4`
- Table: `document_embeddings`
- Vector index: COSINE similarity

**6. Activate in Agent**
- Add source ID to agent's `activeContextSourceIds`
- Document becomes available for RAG search

---

## üîç **DEDUPLICATION STRATEGY**

### Files That May Be Duplicates/Updates

Based on filename analysis:

1. **GOP-P-PF-3.PROCESO PANEL FINANCIERO PROYECTOS AFECTOS**
   - Current: `(V.1) (1).PDF`
   - New 1: `(V.1) (1).PDF` (Primera carga)
   - New 2: `(V.1).pdf` (Segunda carga)
   - **Action:** Upload all versions with unique tags to track source

2. **Several documents appear in both cargas**
   - **Action:** Tag with source folder for traceability
   - Primera carga: `M3-v2-primera-carga`
   - Segunda carga: `M3-v2-segunda-carga-19-11`

---

## üí∞ **COST ESTIMATE**

### Per Document (Average)
- **Extraction:** ~$0.001-0.005 (Flash model)
- **Embeddings:** ~$0.0001-0.0005 (text-embedding-004)
- **Total per doc:** ~$0.0011-0.0055

### Total for 62 Documents
- **Extraction:** ~$0.062-0.310
- **Embeddings:** ~$0.006-0.031
- **Total estimated:** **~$0.07-0.34**

---

## ‚è±Ô∏è **TIME ESTIMATE**

### Per Document
- Upload to GCS: ~2-5s
- Gemini extraction: ~10-30s (depends on size)
- Firestore save: ~1-2s
- Chunking: ~2-5s
- Embeddings: ~5-10s per chunk (batch optimized)
- BigQuery index: ~1-2s
- **Total per doc:** ~30-60s

### Total for 62 Documents
- Sequential: ~31-62 minutes
- With delays: ~40-70 minutes

---

## üè∑Ô∏è **TAGGING STRATEGY**

### Tag Format
```typescript
tags: [
  'M3-v2-20251125',           // Upload batch identifier
  'portal-edificacion',       // Category
  'primera-carga' | 'segunda-carga-19-11'  // Source folder
]
```

### Benefits
- Track upload batches
- Identify document versions
- Filter by category
- Trace source folder

---

## ‚úÖ **VERIFICATION CHECKLIST**

### After Upload

- [ ] All 62 PDFs uploaded to GCS
- [ ] All 62 documents in Firestore `context_sources`
- [ ] All 62 assigned to agent `vStojK73ZKbjNsEnqANJ`
- [ ] RAG enabled for all documents
- [ ] Total chunks: ~310-620
- [ ] All embeddings in BigQuery `flow_analytics_east4`
- [ ] Agent activeContextSourceIds updated
- [ ] Test query returns relevant results
- [ ] UI shows all documents in agent

### Quality Checks

- [ ] No extraction errors
- [ ] No duplicate chunks
- [ ] Embeddings have correct dimensions (768)
- [ ] BigQuery vector index working
- [ ] Search latency < 2s
- [ ] Source metadata complete in UI

---

## üéØ **EXPECTED FINAL STATE**

### Documents Assigned to M3-v2

**Before:** 1 document (3 chunks)
**After:** 63 documents (~313-623 chunks)

**Increase:** 
- **+62 documents** (6,200% increase)
- **+310-620 chunks** (~10,333% increase)

### Agent Capabilities

The agent will have comprehensive coverage of:
- ‚úÖ Planning procedures (Planificaci√≥n Inicial)
- ‚úÖ Quality & operations (Plan de Calidad)
- ‚úÖ Materials control (Control Materiales)
- ‚úÖ Financial panel (Panel Financiero)
- ‚úÖ Community relations (Entorno Vecino)
- ‚úÖ Stage control (Control de Etapa)
- ‚úÖ Logistics (AFE Log√≠stica)
- ‚úÖ Quality policies (Pol√≠ticas Calidad)

---

## üîÑ **ROLLBACK PLAN**

If issues arise:

### Emergency Rollback

```bash
# Remove all newly added documents
# Tag filter: M3-v2-20251125
DELETE FROM context_sources WHERE 'M3-v2-20251125' IN tags;

# Remove chunks
DELETE FROM document_chunks WHERE sourceId IN (
  SELECT id FROM context_sources WHERE 'M3-v2-20251125' IN tags
);

# Remove BigQuery embeddings
DELETE FROM flow_analytics_east4.document_embeddings 
WHERE source_id IN (SELECT id FROM context_sources WHERE 'M3-v2-20251125' IN tags);
```

### Partial Rollback

Remove specific documents by ID if problematic.

---

## üìù **EXECUTION COMMAND**

```bash
npx tsx cli/commands/upload.ts \
  --folder=/Users/alec/salfagpt/upload-queue/M3-v2-20251125 \
  --tag=M3-v2-20251125 \
  --agent=vStojK73ZKbjNsEnqANJ \
  --user=usr_uhwqffaqag1wrryd82tw \
  --email=alec@getaifactory.com \
  --model=gemini-2.5-flash \
  --skip-existing
```

**Parameters:**
- `--folder`: Source folder with PDFs
- `--tag`: Batch identifier for tracking
- `--agent`: M3-v2 agent ID
- `--user`: Owner hash ID
- `--email`: Owner email
- `--model`: Flash (cost-effective)
- `--skip-existing`: Don't re-upload existing files

---

## üìä **SUCCESS METRICS**

- ‚úÖ 100% upload success rate (0 failures)
- ‚úÖ All documents RAG-enabled
- ‚úÖ Average chunks per document: 5-10
- ‚úÖ Search latency: <2s
- ‚úÖ Total cost: <$0.50
- ‚úÖ Completion time: <90 minutes

---

**Created:** 2025-11-25  
**Agent:** GOP GPT (M3-v2)  
**Batch:** M3-v2-20251125  
**Status:** Ready for execution


